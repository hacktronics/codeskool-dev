const a0_0x2ae111=a0_0x1fa3;(function(_0x4f91a4,_0x1e797c){const _0xce2112=a0_0x1fa3,_0x5e973=_0x4f91a4();while(!![]){try{const _0x3a2b3c=parseInt(_0xce2112(0xd4))/0x1+-parseInt(_0xce2112(0xc5))/0x2+parseInt(_0xce2112(0xc7))/0x3+parseInt(_0xce2112(0xd6))/0x4+parseInt(_0xce2112(0xe4))/0x5*(-parseInt(_0xce2112(0xc3))/0x6)+parseInt(_0xce2112(0xe3))/0x7+-parseInt(_0xce2112(0xd8))/0x8;if(_0x3a2b3c===_0x1e797c)break;else _0x5e973['push'](_0x5e973['shift']());}catch(_0x2a2701){_0x5e973['push'](_0x5e973['shift']());}}}(a0_0x432e,0x66841));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x16ba7e=a0_0x1fa3;try{return(await navigator[_0x16ba7e(0xe5)][_0x16ba7e(0xe7)]())['features'][_0x16ba7e(0xc6)](_0x16ba7e(0xdf));}catch(_0xc6076b){return!0x1;}}class Florence2Singleton{static [a0_0x2ae111(0xcb)]='onnx-community/Florence-2-base-ft';static async[a0_0x2ae111(0xe0)](_0x29538e=null){const _0x26fea3=a0_0x2ae111;return this[_0x26fea3(0xca)]??=AutoProcessor[_0x26fea3(0xc9)](this[_0x26fea3(0xcb)]),this[_0x26fea3(0xd0)]??=AutoTokenizer['from_pretrained'](this[_0x26fea3(0xcb)]),this[_0x26fea3(0xd2)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x26fea3(0xc9)](this[_0x26fea3(0xcb)],{'dtype':{'embed_tokens':this[_0x26fea3(0xd2)]?_0x26fea3(0xe1):_0x26fea3(0xd7),'vision_encoder':this[_0x26fea3(0xd2)]?'fp16':_0x26fea3(0xd7),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x26fea3(0xd9),'progress_callback':_0x29538e}),Promise['all']([this[_0x26fea3(0xce)],this[_0x26fea3(0xd0)],this[_0x26fea3(0xca)]]);}}async function load(){const _0x6fd1ad=a0_0x2ae111;self['postMessage']({'status':_0x6fd1ad(0xd5),'data':'Loading\x20model...'});const [_0x2b707a,_0x52c1b3,_0x52de2d]=await Florence2Singleton[_0x6fd1ad(0xe0)](_0x11f324=>{const _0x1a0dc0=_0x6fd1ad;self[_0x1a0dc0(0xda)](_0x11f324);});self[_0x6fd1ad(0xda)]({'status':_0x6fd1ad(0xd5),'data':_0x6fd1ad(0xc4)});const _0x267808=_0x52c1b3('a'),_0x24a0f8=full([0x1,0x3,0x300,0x300],0x0);await _0x2b707a['generate']({..._0x267808,'pixel_values':_0x24a0f8,'max_new_tokens':0x1}),self[_0x6fd1ad(0xda)]({'status':_0x6fd1ad(0xe6)});}function a0_0x432e(){const _0x10d008=['fromURL','from_pretrained','processor','model_id','message','complete','model','load','tokenizer','run','supports_fp16','includes','632303bNRBNT','loading','1485668rnAkoa','fp32','5215824Vmbmss','webgpu','postMessage','reset','now','size','addEventListener','shader-f16','getInstance','fp16','batch_decode','2838976CpJYab','35SDDygZ','gpu','ready','requestAdapter','90786CfHXTC','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','648018rGHkgs','has','277563UrUKrr'];a0_0x432e=function(){return _0x10d008;};return a0_0x432e();}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];function a0_0x1fa3(_0x4b66f7,_0xc18a2d){const _0x432e17=a0_0x432e();return a0_0x1fa3=function(_0x1fa323,_0x2efbe5){_0x1fa323=_0x1fa323-0xc3;let _0x5e7979=_0x432e17[_0x1fa323];return _0x5e7979;},a0_0x1fa3(_0x4b66f7,_0xc18a2d);}let vision_inputs,image_size;async function run({text:_0x4aba5b,url:_0x567f9d,task:_0x1b6913}){const _0x432709=a0_0x2ae111,[_0x476be8,_0x2de62a,_0x4ec192]=await Florence2Singleton['getInstance'](),_0x5c5c3d=performance[_0x432709(0xdc)]();if(!vision_inputs){const _0x422967=await RawImage[_0x432709(0xc8)](_0x567f9d);image_size=_0x422967[_0x432709(0xdd)],vision_inputs=await _0x4ec192(_0x422967);}let _0x3346a5=_0x1b6913;TASKS_WITH_INPUTS[_0x432709(0xd3)](_0x1b6913)&&_0x4aba5b&&(_0x3346a5+=_0x4aba5b);const _0x149ade=_0x2de62a(_0x4ec192['construct_prompts'](_0x3346a5)),_0x1937d9=await _0x476be8['generate']({..._0x149ade,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x30204d=_0x2de62a[_0x432709(0xe2)](_0x1937d9,{'skip_special_tokens':!0x1})[0x0],_0xfb00b9=_0x4ec192['post_process_generation'](_0x30204d,_0x1b6913,image_size),_0xc27925=performance[_0x432709(0xdc)]();self['postMessage']({'status':_0x432709(0xcd),'result':_0xfb00b9,'time':_0xc27925-_0x5c5c3d});}self[a0_0x2ae111(0xde)](a0_0x2ae111(0xcc),async _0x2fcc65=>{const _0x5a2c6f=a0_0x2ae111,{type:_0x5e4b4e,data:_0x1530c0}=_0x2fcc65['data'];switch(_0x5e4b4e){case _0x5a2c6f(0xcf):load();break;case _0x5a2c6f(0xd1):run(_0x1530c0);break;case _0x5a2c6f(0xdb):vision_inputs=image_size=null;}});