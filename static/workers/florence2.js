const a0_0x29d0f6=a0_0x4e2a;(function(_0xc90d3a,_0xca462c){const _0x5991c4=a0_0x4e2a,_0xc0a09a=_0xc90d3a();while(!![]){try{const _0x19ede5=-parseInt(_0x5991c4(0xd7))/0x1+-parseInt(_0x5991c4(0xcb))/0x2*(parseInt(_0x5991c4(0xe4))/0x3)+parseInt(_0x5991c4(0xcc))/0x4+-parseInt(_0x5991c4(0xce))/0x5+-parseInt(_0x5991c4(0xcf))/0x6+-parseInt(_0x5991c4(0xd3))/0x7+parseInt(_0x5991c4(0xdc))/0x8;if(_0x19ede5===_0xca462c)break;else _0xc0a09a['push'](_0xc0a09a['shift']());}catch(_0x1c5ef2){_0xc0a09a['push'](_0xc0a09a['shift']());}}}(a0_0xafde,0xbdbbf));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x57c94d=a0_0x4e2a;try{return(await navigator[_0x57c94d(0xe9)][_0x57c94d(0xdb)]())[_0x57c94d(0xd0)][_0x57c94d(0xca)]('shader-f16');}catch(_0x59ada7){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x29d0f6(0xe2);static async[a0_0x29d0f6(0xe1)](_0x1d2d9f=null){const _0x5480c2=a0_0x29d0f6;return this['processor']??=AutoProcessor['from_pretrained'](this[_0x5480c2(0xdd)]),this[_0x5480c2(0xd1)]??=AutoTokenizer[_0x5480c2(0xd4)](this['model_id']),this['supports_fp16']??=await hasFp16(),this[_0x5480c2(0xd5)]??=Florence2ForConditionalGeneration[_0x5480c2(0xd4)](this['model_id'],{'dtype':{'embed_tokens':this['supports_fp16']?_0x5480c2(0xc9):'fp32','vision_encoder':this[_0x5480c2(0xc6)]?_0x5480c2(0xc9):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5480c2(0xd2),'progress_callback':_0x1d2d9f}),Promise[_0x5480c2(0xc8)]([this['model'],this[_0x5480c2(0xd1)],this[_0x5480c2(0xe5)]]);}}async function load(){const _0x4aac85=a0_0x29d0f6;self[_0x4aac85(0xcd)]({'status':_0x4aac85(0xea),'data':_0x4aac85(0xd9)});const [_0x1ec3ce,_0x15fbd6,_0x28f5fd]=await Florence2Singleton[_0x4aac85(0xe1)](_0x430f1d=>{self['postMessage'](_0x430f1d);});self[_0x4aac85(0xcd)]({'status':_0x4aac85(0xea),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x36436f=_0x15fbd6('a'),_0x360de0=full([0x1,0x3,0x300,0x300],0x0);await _0x1ec3ce[_0x4aac85(0xde)]({..._0x36436f,'pixel_values':_0x360de0,'max_new_tokens':0x1}),self[_0x4aac85(0xcd)]({'status':_0x4aac85(0xe6)});}function a0_0x4e2a(_0x57c83e,_0x3c39b8){const _0xafde6=a0_0xafde();return a0_0x4e2a=function(_0x4e2af5,_0x4d243f){_0x4e2af5=_0x4e2af5-0xc6;let _0xcbf66c=_0xafde6[_0x4e2af5];return _0xcbf66c;},a0_0x4e2a(_0x57c83e,_0x3c39b8);}const TASKS_WITH_INPUTS=[a0_0x29d0f6(0xd8)];let vision_inputs,image_size;function a0_0xafde(){const _0x2c9e6d=['ready','data','includes','gpu','loading','post_process_generation','supports_fp16','construct_prompts','all','fp16','has','18oCrKOU','5032124egiZyW','postMessage','4125600ogxuIe','5034408YlruTx','features','tokenizer','webgpu','5912354ePdyte','from_pretrained','model','fromURL','746608Mrmckc','<CAPTION_TO_PHRASE_GROUNDING>','Loading\x20model...','now','requestAdapter','23749560hhlumj','model_id','generate','size','message','getInstance','onnx-community/Florence-2-base-ft','run','64719pgTXxT','processor'];a0_0xafde=function(){return _0x2c9e6d;};return a0_0xafde();}async function run({text:_0x1fbfa,url:_0x4041bb,task:_0x3be343}){const _0x5b00a4=a0_0x29d0f6,[_0xd0926,_0x53f52f,_0x2611bb]=await Florence2Singleton[_0x5b00a4(0xe1)](),_0x4f8ff2=performance[_0x5b00a4(0xda)]();if(!vision_inputs){const _0x24bb59=await RawImage[_0x5b00a4(0xd6)](_0x4041bb);image_size=_0x24bb59[_0x5b00a4(0xdf)],vision_inputs=await _0x2611bb(_0x24bb59);}let _0x571fcb=_0x3be343;TASKS_WITH_INPUTS[_0x5b00a4(0xe8)](_0x3be343)&&_0x1fbfa&&(_0x571fcb+=_0x1fbfa);const _0x185315=_0x53f52f(_0x2611bb[_0x5b00a4(0xc7)](_0x571fcb)),_0x5225ef=await _0xd0926[_0x5b00a4(0xde)]({..._0x185315,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1f5ced=_0x53f52f['batch_decode'](_0x5225ef,{'skip_special_tokens':!0x1})[0x0],_0x3e2469=_0x2611bb[_0x5b00a4(0xeb)](_0x1f5ced,_0x3be343,image_size),_0x18c3a7=performance[_0x5b00a4(0xda)]();self[_0x5b00a4(0xcd)]({'status':'complete','result':_0x3e2469,'time':_0x18c3a7-_0x4f8ff2});}self['addEventListener'](a0_0x29d0f6(0xe0),async _0x306414=>{const _0x2bb5b0=a0_0x29d0f6,{type:_0x5019bb,data:_0x5a0b2a}=_0x306414[_0x2bb5b0(0xe7)];switch(_0x5019bb){case'load':load();break;case _0x2bb5b0(0xe3):run(_0x5a0b2a);break;case'reset':vision_inputs=image_size=null;}});