const a0_0x347b85=a0_0x923e;(function(_0x2cfa64,_0x21239e){const _0x501d6e=a0_0x923e,_0x3e6287=_0x2cfa64();while(!![]){try{const _0x335b5a=parseInt(_0x501d6e(0x179))/0x1*(parseInt(_0x501d6e(0x17a))/0x2)+-parseInt(_0x501d6e(0x186))/0x3*(-parseInt(_0x501d6e(0x172))/0x4)+parseInt(_0x501d6e(0x169))/0x5+-parseInt(_0x501d6e(0x15f))/0x6+parseInt(_0x501d6e(0x16e))/0x7*(-parseInt(_0x501d6e(0x174))/0x8)+-parseInt(_0x501d6e(0x163))/0x9+parseInt(_0x501d6e(0x164))/0xa*(parseInt(_0x501d6e(0x161))/0xb);if(_0x335b5a===_0x21239e)break;else _0x3e6287['push'](_0x3e6287['shift']());}catch(_0x592a45){_0x3e6287['push'](_0x3e6287['shift']());}}}(a0_0x3627,0xcc368));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x34a2b4=a0_0x923e;try{return(await navigator[_0x34a2b4(0x184)]['requestAdapter']())[_0x34a2b4(0x187)][_0x34a2b4(0x170)](_0x34a2b4(0x16d));}catch(_0x2db70c){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x347b85(0x182);static async[a0_0x347b85(0x178)](_0x4def19=null){const _0x4ae6fc=a0_0x347b85;return this[_0x4ae6fc(0x17d)]??=AutoProcessor[_0x4ae6fc(0x15e)](this[_0x4ae6fc(0x165)]),this[_0x4ae6fc(0x177)]??=AutoTokenizer[_0x4ae6fc(0x15e)](this[_0x4ae6fc(0x165)]),this[_0x4ae6fc(0x171)]??=await hasFp16(),this[_0x4ae6fc(0x185)]??=Florence2ForConditionalGeneration[_0x4ae6fc(0x15e)](this[_0x4ae6fc(0x165)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':_0x4ae6fc(0x17f),'vision_encoder':this[_0x4ae6fc(0x171)]?_0x4ae6fc(0x16b):_0x4ae6fc(0x17f),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x4ae6fc(0x17e),'progress_callback':_0x4def19}),Promise[_0x4ae6fc(0x173)]([this['model'],this['tokenizer'],this['processor']]);}}async function load(){const _0x4e8e14=a0_0x347b85;self['postMessage']({'status':_0x4e8e14(0x188),'data':_0x4e8e14(0x17b)});const [_0x13dd6c,_0x2a97a7,_0x1ee9ad]=await Florence2Singleton[_0x4e8e14(0x178)](_0x45c49b=>{self['postMessage'](_0x45c49b);});self[_0x4e8e14(0x180)]({'status':_0x4e8e14(0x188),'data':_0x4e8e14(0x167)});const _0x6d798a=_0x2a97a7('a'),_0x5d1bff=full([0x1,0x3,0x300,0x300],0x0);await _0x13dd6c[_0x4e8e14(0x17c)]({..._0x6d798a,'pixel_values':_0x5d1bff,'max_new_tokens':0x1}),self[_0x4e8e14(0x180)]({'status':_0x4e8e14(0x160)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];function a0_0x923e(_0x52cf98,_0x48c328){const _0x362751=a0_0x3627();return a0_0x923e=function(_0x923e6e,_0x1052c2){_0x923e6e=_0x923e6e-0x15d;let _0x1bc1d7=_0x362751[_0x923e6e];return _0x1bc1d7;},a0_0x923e(_0x52cf98,_0x48c328);}function a0_0x3627(){const _0x19ef69=['loading','includes','from_pretrained','7983588ykDdPU','ready','7624507hOWnFd','batch_decode','11221470hJvyhG','40GVyDtK','model_id','construct_prompts','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','now','4222580KamemR','message','fp16','load','shader-f16','14pBElry','addEventListener','has','supports_fp16','28fYMWir','all','4755368RZPfmg','data','post_process_generation','tokenizer','getInstance','53rMMteZ','1550qFRnAD','Loading\x20model...','generate','processor','webgpu','fp32','postMessage','fromURL','onnx-community/Florence-2-base-ft','run','gpu','model','404823JpIqbc','features'];a0_0x3627=function(){return _0x19ef69;};return a0_0x3627();}let vision_inputs,image_size;async function run({text:_0x315ab3,url:_0x1875c0,task:_0x20d914}){const _0x1df788=a0_0x347b85,[_0xc4709e,_0x58e527,_0x59e52e]=await Florence2Singleton[_0x1df788(0x178)](),_0x326854=performance[_0x1df788(0x168)]();if(!vision_inputs){const _0xdb1666=await RawImage[_0x1df788(0x181)](_0x1875c0);image_size=_0xdb1666['size'],vision_inputs=await _0x59e52e(_0xdb1666);}let _0x830573=_0x20d914;TASKS_WITH_INPUTS[_0x1df788(0x15d)](_0x20d914)&&_0x315ab3&&(_0x830573+=_0x315ab3);const _0xe2a54d=_0x58e527(_0x59e52e[_0x1df788(0x166)](_0x830573)),_0xca0c3f=await _0xc4709e['generate']({..._0xe2a54d,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x160472=_0x58e527[_0x1df788(0x162)](_0xca0c3f,{'skip_special_tokens':!0x1})[0x0],_0x3ea4ca=_0x59e52e[_0x1df788(0x176)](_0x160472,_0x20d914,image_size),_0x815fdd=performance[_0x1df788(0x168)]();self[_0x1df788(0x180)]({'status':'complete','result':_0x3ea4ca,'time':_0x815fdd-_0x326854});}self[a0_0x347b85(0x16f)](a0_0x347b85(0x16a),async _0x5473a5=>{const _0x3dca3d=a0_0x347b85,{type:_0x591816,data:_0x5b1cab}=_0x5473a5[_0x3dca3d(0x175)];switch(_0x591816){case _0x3dca3d(0x16c):load();break;case _0x3dca3d(0x183):run(_0x5b1cab);break;case'reset':vision_inputs=image_size=null;}});