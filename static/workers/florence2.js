const a0_0x49ac48=a0_0x5def;(function(_0xc4c853,_0x1a46ac){const _0x28c2c5=a0_0x5def,_0x536c3c=_0xc4c853();while(!![]){try{const _0x4a13ed=parseInt(_0x28c2c5(0x1ae))/0x1*(-parseInt(_0x28c2c5(0x1a9))/0x2)+-parseInt(_0x28c2c5(0x18f))/0x3+-parseInt(_0x28c2c5(0x1b4))/0x4*(parseInt(_0x28c2c5(0x19f))/0x5)+parseInt(_0x28c2c5(0x191))/0x6*(-parseInt(_0x28c2c5(0x1b3))/0x7)+parseInt(_0x28c2c5(0x192))/0x8*(-parseInt(_0x28c2c5(0x19b))/0x9)+-parseInt(_0x28c2c5(0x190))/0xa+parseInt(_0x28c2c5(0x193))/0xb;if(_0x4a13ed===_0x1a46ac)break;else _0x536c3c['push'](_0x536c3c['shift']());}catch(_0x2ada25){_0x536c3c['push'](_0x536c3c['shift']());}}}(a0_0x2241,0x7e3a9));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3/dist/transformers.min.js';function a0_0x2241(){const _0x19bf6c=['230qdQGfV','fp32','batch_decode','data','shader-f16','1277WGoMbb','model','reset','post_process_generation','includes','1051057svTJOs','22516Hvfopa','fromURL','webgpu','loading','run','requestAdapter','gpu','postMessage','generate','1295625RPtehq','5533560WpSDkO','12VZawUP','2510632XksicD','29168161AxLGxh','construct_prompts','model_id','addEventListener','tokenizer','supports_fp16','from_pretrained','features','9snxAec','now','onnx-community/Florence-2-base-ft','size','345TQgfbt','message','<CAPTION_TO_PHRASE_GROUNDING>','ready','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','has','all','fp16','getInstance','processor'];a0_0x2241=function(){return _0x19bf6c;};return a0_0x2241();}async function hasFp16(){const _0x34634d=a0_0x5def;try{return(await navigator[_0x34634d(0x1ba)][_0x34634d(0x1b9)]())[_0x34634d(0x19a)][_0x34634d(0x1a4)](_0x34634d(0x1ad));}catch(_0x5986cd){return!0x1;}}class Florence2Singleton{static [a0_0x49ac48(0x195)]=a0_0x49ac48(0x19d);static async['getInstance'](_0x12a01b=null){const _0x4de0af=a0_0x49ac48;return this[_0x4de0af(0x1a8)]??=AutoProcessor[_0x4de0af(0x199)](this[_0x4de0af(0x195)]),this[_0x4de0af(0x197)]??=AutoTokenizer[_0x4de0af(0x199)](this[_0x4de0af(0x195)]),this[_0x4de0af(0x198)]??=await hasFp16(),this[_0x4de0af(0x1af)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x4de0af(0x195)],{'dtype':{'embed_tokens':this[_0x4de0af(0x198)]?'fp16':_0x4de0af(0x1aa),'vision_encoder':this[_0x4de0af(0x198)]?_0x4de0af(0x1a6):_0x4de0af(0x1aa),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x4de0af(0x1b6),'progress_callback':_0x12a01b}),Promise[_0x4de0af(0x1a5)]([this[_0x4de0af(0x1af)],this[_0x4de0af(0x197)],this['processor']]);}}async function load(){const _0x5945f7=a0_0x49ac48;self[_0x5945f7(0x1bb)]({'status':_0x5945f7(0x1b7),'data':'Loading\x20model...'});const [_0x17ed25,_0x436f2d,_0x503454]=await Florence2Singleton[_0x5945f7(0x1a7)](_0x29f516=>{const _0x54a2ba=_0x5945f7;self[_0x54a2ba(0x1bb)](_0x29f516);});self['postMessage']({'status':'loading','data':_0x5945f7(0x1a3)});const _0x9aa9bf=_0x436f2d('a'),_0x164b16=full([0x1,0x3,0x300,0x300],0x0);await _0x17ed25[_0x5945f7(0x18e)]({..._0x9aa9bf,'pixel_values':_0x164b16,'max_new_tokens':0x1}),self['postMessage']({'status':_0x5945f7(0x1a2)});}const TASKS_WITH_INPUTS=[a0_0x49ac48(0x1a1)];let vision_inputs,image_size;function a0_0x5def(_0x1196ee,_0x37e4cd){const _0x224122=a0_0x2241();return a0_0x5def=function(_0x5defc8,_0x1feac9){_0x5defc8=_0x5defc8-0x18e;let _0x11c428=_0x224122[_0x5defc8];return _0x11c428;},a0_0x5def(_0x1196ee,_0x37e4cd);}async function run({text:_0x3a768e,url:_0x1183f3,task:_0x184ab0}){const _0x5d7816=a0_0x49ac48,[_0x15c711,_0x464a9e,_0x2e076a]=await Florence2Singleton[_0x5d7816(0x1a7)](),_0x5f226f=performance[_0x5d7816(0x19c)]();if(!vision_inputs){const _0x1f04b8=await RawImage[_0x5d7816(0x1b5)](_0x1183f3);image_size=_0x1f04b8[_0x5d7816(0x19e)],vision_inputs=await _0x2e076a(_0x1f04b8);}let _0x57ea1e=_0x184ab0;TASKS_WITH_INPUTS[_0x5d7816(0x1b2)](_0x184ab0)&&_0x3a768e&&(_0x57ea1e+=_0x3a768e);const _0x794686=_0x464a9e(_0x2e076a[_0x5d7816(0x194)](_0x57ea1e)),_0x2f1d64=await _0x15c711[_0x5d7816(0x18e)]({..._0x794686,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x472814=_0x464a9e[_0x5d7816(0x1ab)](_0x2f1d64,{'skip_special_tokens':!0x1})[0x0],_0x54d7f5=_0x2e076a[_0x5d7816(0x1b1)](_0x472814,_0x184ab0,image_size),_0x3124cd=performance['now']();self[_0x5d7816(0x1bb)]({'status':'complete','result':_0x54d7f5,'time':_0x3124cd-_0x5f226f});}self[a0_0x49ac48(0x196)](a0_0x49ac48(0x1a0),async _0xb97120=>{const _0x8c15fb=a0_0x49ac48,{type:_0x57312e,data:_0x25c21c}=_0xb97120[_0x8c15fb(0x1ac)];switch(_0x57312e){case'load':load();break;case _0x8c15fb(0x1b8):run(_0x25c21c);break;case _0x8c15fb(0x1b0):vision_inputs=image_size=null;}});