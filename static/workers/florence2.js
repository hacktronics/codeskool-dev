const a0_0x58829d=a0_0x51c3;(function(_0xe031d7,_0xdf2c52){const _0x3e7e74=a0_0x51c3,_0x3e70f9=_0xe031d7();while(!![]){try{const _0x59ec6f=-parseInt(_0x3e7e74(0x12e))/0x1+-parseInt(_0x3e7e74(0x149))/0x2*(parseInt(_0x3e7e74(0x135))/0x3)+parseInt(_0x3e7e74(0x141))/0x4+-parseInt(_0x3e7e74(0x127))/0x5*(-parseInt(_0x3e7e74(0x122))/0x6)+parseInt(_0x3e7e74(0x121))/0x7*(parseInt(_0x3e7e74(0x142))/0x8)+-parseInt(_0x3e7e74(0x13c))/0x9+parseInt(_0x3e7e74(0x13a))/0xa;if(_0x59ec6f===_0xdf2c52)break;else _0x3e70f9['push'](_0x3e70f9['shift']());}catch(_0x41376f){_0x3e70f9['push'](_0x3e70f9['shift']());}}}(a0_0x2dcc,0x2bd02));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x2bcd34=a0_0x51c3;try{return(await navigator[_0x2bcd34(0x147)]['requestAdapter']())['features'][_0x2bcd34(0x143)](_0x2bcd34(0x12d));}catch(_0x171dae){return!0x1;}}class Florence2Singleton{static ['model_id']='onnx-community/Florence-2-base-ft';static async[a0_0x58829d(0x138)](_0x4ea3aa=null){const _0x1098d8=a0_0x58829d;return this[_0x1098d8(0x129)]??=AutoProcessor[_0x1098d8(0x12a)](this[_0x1098d8(0x144)]),this['tokenizer']??=AutoTokenizer['from_pretrained'](this[_0x1098d8(0x144)]),this[_0x1098d8(0x124)]??=await hasFp16(),this[_0x1098d8(0x140)]??=Florence2ForConditionalGeneration[_0x1098d8(0x12a)](this[_0x1098d8(0x144)],{'dtype':{'embed_tokens':this[_0x1098d8(0x124)]?_0x1098d8(0x132):'fp32','vision_encoder':this[_0x1098d8(0x124)]?_0x1098d8(0x132):_0x1098d8(0x136),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x1098d8(0x13e),'progress_callback':_0x4ea3aa}),Promise[_0x1098d8(0x146)]([this['model'],this[_0x1098d8(0x139)],this[_0x1098d8(0x129)]]);}}async function load(){const _0x4cd3d3=a0_0x58829d;self[_0x4cd3d3(0x123)]({'status':_0x4cd3d3(0x125),'data':'Loading\x20model...'});const [_0x54ade5,_0x3e60d9,_0x15e87b]=await Florence2Singleton[_0x4cd3d3(0x138)](_0x2b1209=>{self['postMessage'](_0x2b1209);});self['postMessage']({'status':_0x4cd3d3(0x125),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x3b3d5c=_0x3e60d9('a'),_0x5a4b66=full([0x1,0x3,0x300,0x300],0x0);await _0x54ade5[_0x4cd3d3(0x12f)]({..._0x3b3d5c,'pixel_values':_0x5a4b66,'max_new_tokens':0x1}),self[_0x4cd3d3(0x123)]({'status':_0x4cd3d3(0x137)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;function a0_0x2dcc(){const _0x11726b=['tokenizer','2536730OmcVrZ','fromURL','492291lAxtWa','now','webgpu','load','model','620804faewJn','40ebiPVQ','has','model_id','message','all','gpu','reset','8wzXlHk','64673eHsPTo','6MQLskZ','postMessage','supports_fp16','loading','construct_prompts','960155ZhqMTF','batch_decode','processor','from_pretrained','complete','size','shader-f16','121387klBHeB','generate','addEventListener','includes','fp16','data','post_process_generation','218667hNbkEg','fp32','ready','getInstance'];a0_0x2dcc=function(){return _0x11726b;};return a0_0x2dcc();}async function run({text:_0xa04390,url:_0x393efd,task:_0x501588}){const _0x5b98a0=a0_0x58829d,[_0x1698e2,_0x2b5523,_0x1a9370]=await Florence2Singleton['getInstance'](),_0x1663c6=performance['now']();if(!vision_inputs){const _0x28d647=await RawImage[_0x5b98a0(0x13b)](_0x393efd);image_size=_0x28d647[_0x5b98a0(0x12c)],vision_inputs=await _0x1a9370(_0x28d647);}let _0x4ecfdf=_0x501588;TASKS_WITH_INPUTS[_0x5b98a0(0x131)](_0x501588)&&_0xa04390&&(_0x4ecfdf+=_0xa04390);const _0x5ab679=_0x2b5523(_0x1a9370[_0x5b98a0(0x126)](_0x4ecfdf)),_0x2eb0aa=await _0x1698e2[_0x5b98a0(0x12f)]({..._0x5ab679,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x337fe3=_0x2b5523[_0x5b98a0(0x128)](_0x2eb0aa,{'skip_special_tokens':!0x1})[0x0],_0x280c92=_0x1a9370[_0x5b98a0(0x134)](_0x337fe3,_0x501588,image_size),_0x10e034=performance[_0x5b98a0(0x13d)]();self['postMessage']({'status':_0x5b98a0(0x12b),'result':_0x280c92,'time':_0x10e034-_0x1663c6});}function a0_0x51c3(_0x15649a,_0x42b7a6){const _0x2dcc04=a0_0x2dcc();return a0_0x51c3=function(_0x51c370,_0x23b3aa){_0x51c370=_0x51c370-0x121;let _0xfe9214=_0x2dcc04[_0x51c370];return _0xfe9214;},a0_0x51c3(_0x15649a,_0x42b7a6);}self[a0_0x58829d(0x130)](a0_0x58829d(0x145),async _0x50b10f=>{const _0x396b1a=a0_0x58829d,{type:_0x133a34,data:_0x32d1e2}=_0x50b10f[_0x396b1a(0x133)];switch(_0x133a34){case _0x396b1a(0x13f):load();break;case'run':run(_0x32d1e2);break;case _0x396b1a(0x148):vision_inputs=image_size=null;}});