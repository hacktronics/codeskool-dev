const a0_0x30faa6=a0_0x1d78;(function(_0x598f49,_0x3c406a){const _0x34edc1=a0_0x1d78,_0x1ea923=_0x598f49();while(!![]){try{const _0x5c3b75=-parseInt(_0x34edc1(0xd1))/0x1*(-parseInt(_0x34edc1(0xdc))/0x2)+-parseInt(_0x34edc1(0xd9))/0x3*(-parseInt(_0x34edc1(0xea))/0x4)+parseInt(_0x34edc1(0xd6))/0x5+-parseInt(_0x34edc1(0xe5))/0x6*(parseInt(_0x34edc1(0xcf))/0x7)+-parseInt(_0x34edc1(0xc7))/0x8*(parseInt(_0x34edc1(0xcc))/0x9)+-parseInt(_0x34edc1(0xe3))/0xa*(parseInt(_0x34edc1(0xd7))/0xb)+-parseInt(_0x34edc1(0xd5))/0xc;if(_0x5c3b75===_0x3c406a)break;else _0x1ea923['push'](_0x1ea923['shift']());}catch(_0x3d5f03){_0x1ea923['push'](_0x1ea923['shift']());}}}(a0_0x260d,0xdac2c));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x4e14f3=a0_0x1d78;try{return(await navigator[_0x4e14f3(0xc9)][_0x4e14f3(0xc8)]())['features']['has'](_0x4e14f3(0xd8));}catch(_0x25d147){return!0x1;}}class Florence2Singleton{static [a0_0x30faa6(0xca)]=a0_0x30faa6(0xc6);static async[a0_0x30faa6(0xeb)](_0x2ded1b=null){const _0x1f5de7=a0_0x30faa6;return this['processor']??=AutoProcessor[_0x1f5de7(0xe4)](this[_0x1f5de7(0xca)]),this[_0x1f5de7(0xd4)]??=AutoTokenizer[_0x1f5de7(0xe4)](this[_0x1f5de7(0xca)]),this[_0x1f5de7(0xee)]??=await hasFp16(),this[_0x1f5de7(0xf1)]??=Florence2ForConditionalGeneration[_0x1f5de7(0xe4)](this['model_id'],{'dtype':{'embed_tokens':this[_0x1f5de7(0xee)]?_0x1f5de7(0xde):_0x1f5de7(0xdb),'vision_encoder':this['supports_fp16']?_0x1f5de7(0xde):_0x1f5de7(0xdb),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x2ded1b}),Promise[_0x1f5de7(0xd3)]([this[_0x1f5de7(0xf1)],this[_0x1f5de7(0xd4)],this[_0x1f5de7(0xce)]]);}}async function load(){const _0x3186ae=a0_0x30faa6;self[_0x3186ae(0xe7)]({'status':_0x3186ae(0xe2),'data':_0x3186ae(0xec)});const [_0x6a14c8,_0x2b5b5c,_0x439593]=await Florence2Singleton['getInstance'](_0x397f1e=>{const _0x36ee13=_0x3186ae;self[_0x36ee13(0xe7)](_0x397f1e);});self[_0x3186ae(0xe7)]({'status':'loading','data':_0x3186ae(0xe8)});const _0x560f41=_0x2b5b5c('a'),_0x281430=full([0x1,0x3,0x300,0x300],0x0);await _0x6a14c8[_0x3186ae(0xe1)]({..._0x560f41,'pixel_values':_0x281430,'max_new_tokens':0x1}),self[_0x3186ae(0xe7)]({'status':_0x3186ae(0xd2)});}const TASKS_WITH_INPUTS=[a0_0x30faa6(0xef)];let vision_inputs,image_size;function a0_0x1d78(_0x8b3f3,_0x180757){const _0x260d3b=a0_0x260d();return a0_0x1d78=function(_0x1d7851,_0x2bb5c2){_0x1d7851=_0x1d7851-0xc6;let _0x605201=_0x260d3b[_0x1d7851];return _0x605201;},a0_0x1d78(_0x8b3f3,_0x180757);}function a0_0x260d(){const _0x4a731f=['model_id','fromURL','36dYuuOs','message','processor','35jrOZvK','reset','36235hYsRiI','ready','all','tokenizer','4321284pxjXDa','2539175PrdiIi','1477707qhExam','shader-f16','2073ofMgve','batch_decode','fp32','78WOBtic','size','fp16','load','addEventListener','generate','loading','10cwINoV','from_pretrained','338586ACKoJq','complete','postMessage','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','includes','1108klZeBO','getInstance','Loading\x20model...','construct_prompts','supports_fp16','<CAPTION_TO_PHRASE_GROUNDING>','data','model','now','onnx-community/Florence-2-base-ft','879528ZTsgqx','requestAdapter','gpu'];a0_0x260d=function(){return _0x4a731f;};return a0_0x260d();}async function run({text:_0x3b6a98,url:_0x20f63a,task:_0x2451e6}){const _0xff4f04=a0_0x30faa6,[_0x398968,_0x211f19,_0x58f492]=await Florence2Singleton['getInstance'](),_0xed2fa5=performance[_0xff4f04(0xf2)]();if(!vision_inputs){const _0x38b0b4=await RawImage[_0xff4f04(0xcb)](_0x20f63a);image_size=_0x38b0b4[_0xff4f04(0xdd)],vision_inputs=await _0x58f492(_0x38b0b4);}let _0x4749fb=_0x2451e6;TASKS_WITH_INPUTS[_0xff4f04(0xe9)](_0x2451e6)&&_0x3b6a98&&(_0x4749fb+=_0x3b6a98);const _0x5b442e=_0x211f19(_0x58f492[_0xff4f04(0xed)](_0x4749fb)),_0x2fca40=await _0x398968[_0xff4f04(0xe1)]({..._0x5b442e,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3dc9da=_0x211f19[_0xff4f04(0xda)](_0x2fca40,{'skip_special_tokens':!0x1})[0x0],_0x361fde=_0x58f492['post_process_generation'](_0x3dc9da,_0x2451e6,image_size),_0x5c0abd=performance['now']();self[_0xff4f04(0xe7)]({'status':_0xff4f04(0xe6),'result':_0x361fde,'time':_0x5c0abd-_0xed2fa5});}self[a0_0x30faa6(0xe0)](a0_0x30faa6(0xcd),async _0x51c343=>{const _0x3b6f9c=a0_0x30faa6,{type:_0xb0c461,data:_0x53a455}=_0x51c343[_0x3b6f9c(0xf0)];switch(_0xb0c461){case _0x3b6f9c(0xdf):load();break;case'run':run(_0x53a455);break;case _0x3b6f9c(0xd0):vision_inputs=image_size=null;}});