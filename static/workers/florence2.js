const a0_0x32f2bf=a0_0x44bb;(function(_0x2cee1e,_0x5bf267){const _0x346ec3=a0_0x44bb,_0x226305=_0x2cee1e();while(!![]){try{const _0x2fa30a=parseInt(_0x346ec3(0x167))/0x1+parseInt(_0x346ec3(0x15f))/0x2*(-parseInt(_0x346ec3(0x15a))/0x3)+-parseInt(_0x346ec3(0x149))/0x4*(parseInt(_0x346ec3(0x150))/0x5)+parseInt(_0x346ec3(0x16a))/0x6+parseInt(_0x346ec3(0x16d))/0x7+-parseInt(_0x346ec3(0x157))/0x8+parseInt(_0x346ec3(0x16e))/0x9;if(_0x2fa30a===_0x5bf267)break;else _0x226305['push'](_0x226305['shift']());}catch(_0xef9c08){_0x226305['push'](_0x226305['shift']());}}}(a0_0x2060,0xd6a35));function a0_0x44bb(_0x5dc785,_0x1eba39){const _0x206080=a0_0x2060();return a0_0x44bb=function(_0x44bb7f,_0x3462af){_0x44bb7f=_0x44bb7f-0x144;let _0x39d4d0=_0x206080[_0x44bb7f];return _0x39d4d0;},a0_0x44bb(_0x5dc785,_0x1eba39);}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x2b6647=a0_0x44bb;try{return(await navigator[_0x2b6647(0x166)][_0x2b6647(0x14d)]())[_0x2b6647(0x154)][_0x2b6647(0x159)](_0x2b6647(0x155));}catch(_0x29d1dc){return!0x1;}}class Florence2Singleton{static [a0_0x32f2bf(0x158)]=a0_0x32f2bf(0x145);static async['getInstance'](_0x278c2e=null){const _0x27dd08=a0_0x32f2bf;return this[_0x27dd08(0x153)]??=AutoProcessor[_0x27dd08(0x14f)](this[_0x27dd08(0x158)]),this[_0x27dd08(0x165)]??=AutoTokenizer['from_pretrained'](this[_0x27dd08(0x158)]),this[_0x27dd08(0x15b)]??=await hasFp16(),this[_0x27dd08(0x147)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x27dd08(0x158)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x27dd08(0x14a):_0x27dd08(0x15d),'vision_encoder':this[_0x27dd08(0x15b)]?_0x27dd08(0x14a):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x27dd08(0x146),'progress_callback':_0x278c2e}),Promise['all']([this['model'],this['tokenizer'],this[_0x27dd08(0x153)]]);}}async function load(){const _0x565706=a0_0x32f2bf;self[_0x565706(0x151)]({'status':_0x565706(0x16c),'data':_0x565706(0x169)});const [_0x446917,_0x3c9315,_0x1e7315]=await Florence2Singleton[_0x565706(0x15c)](_0x212f34=>{const _0xe637e8=_0x565706;self[_0xe637e8(0x151)](_0x212f34);});self[_0x565706(0x151)]({'status':_0x565706(0x16c),'data':_0x565706(0x160)});const _0x3e8ef1=_0x3c9315('a'),_0x1bc07f=full([0x1,0x3,0x300,0x300],0x0);await _0x446917['generate']({..._0x3e8ef1,'pixel_values':_0x1bc07f,'max_new_tokens':0x1}),self[_0x565706(0x151)]({'status':_0x565706(0x161)});}const TASKS_WITH_INPUTS=[a0_0x32f2bf(0x14c)];let vision_inputs,image_size;async function run({text:_0x34d79a,url:_0x418c6f,task:_0x37ad01}){const _0x25014e=a0_0x32f2bf,[_0x487bd3,_0x1c9091,_0x4d2b19]=await Florence2Singleton[_0x25014e(0x15c)](),_0x3ccfca=performance['now']();if(!vision_inputs){const _0x2a6a95=await RawImage[_0x25014e(0x148)](_0x418c6f);image_size=_0x2a6a95[_0x25014e(0x164)],vision_inputs=await _0x4d2b19(_0x2a6a95);}let _0x402b76=_0x37ad01;TASKS_WITH_INPUTS[_0x25014e(0x162)](_0x37ad01)&&_0x34d79a&&(_0x402b76+=_0x34d79a);const _0x38efc6=_0x1c9091(_0x4d2b19['construct_prompts'](_0x402b76)),_0x10200d=await _0x487bd3[_0x25014e(0x152)]({..._0x38efc6,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1fb44a=_0x1c9091['batch_decode'](_0x10200d,{'skip_special_tokens':!0x1})[0x0],_0x170ae6=_0x4d2b19[_0x25014e(0x144)](_0x1fb44a,_0x37ad01,image_size),_0x17df80=performance[_0x25014e(0x14b)]();self['postMessage']({'status':'complete','result':_0x170ae6,'time':_0x17df80-_0x3ccfca});}function a0_0x2060(){const _0x4522a3=['522588kayPgR','load','loading','7184772kzRrfo','24922017IeMjTp','post_process_generation','onnx-community/Florence-2-base-ft','webgpu','model','fromURL','812QPBzCE','fp16','now','<CAPTION_TO_PHRASE_GROUNDING>','requestAdapter','run','from_pretrained','29410mfEXFt','postMessage','generate','processor','features','shader-f16','message','4373744ACkpZC','model_id','has','3rhNREK','supports_fp16','getInstance','fp32','data','3418528XZpHSB','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','ready','includes','addEventListener','size','tokenizer','gpu','446578JlSLkN','reset','Loading\x20model...'];a0_0x2060=function(){return _0x4522a3;};return a0_0x2060();}self[a0_0x32f2bf(0x163)](a0_0x32f2bf(0x156),async _0x29fe75=>{const _0x2d84a7=a0_0x32f2bf,{type:_0x3db9bc,data:_0x4f9ac9}=_0x29fe75[_0x2d84a7(0x15e)];switch(_0x3db9bc){case _0x2d84a7(0x16b):load();break;case _0x2d84a7(0x14e):run(_0x4f9ac9);break;case _0x2d84a7(0x168):vision_inputs=image_size=null;}});