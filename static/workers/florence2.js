const a0_0x385b9a=a0_0x3f99;(function(_0xb033dd,_0x225eb1){const _0x457458=a0_0x3f99,_0x3ce7df=_0xb033dd();while(!![]){try{const _0x4db9bf=parseInt(_0x457458(0xf9))/0x1*(-parseInt(_0x457458(0xeb))/0x2)+parseInt(_0x457458(0x10e))/0x3+-parseInt(_0x457458(0xe9))/0x4+parseInt(_0x457458(0x105))/0x5*(-parseInt(_0x457458(0x104))/0x6)+-parseInt(_0x457458(0xf8))/0x7*(-parseInt(_0x457458(0xf3))/0x8)+parseInt(_0x457458(0xed))/0x9+parseInt(_0x457458(0xfd))/0xa*(parseInt(_0x457458(0x111))/0xb);if(_0x4db9bf===_0x225eb1)break;else _0x3ce7df['push'](_0x3ce7df['shift']());}catch(_0x132383){_0x3ce7df['push'](_0x3ce7df['shift']());}}}(a0_0x54bc,0x34350));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x3f99(_0x1cf691,_0xa458ef){const _0x54bca8=a0_0x54bc();return a0_0x3f99=function(_0x3f9970,_0x47f3ea){_0x3f9970=_0x3f9970-0xe8;let _0x57a2ae=_0x54bca8[_0x3f9970];return _0x57a2ae;},a0_0x3f99(_0x1cf691,_0xa458ef);}async function hasFp16(){const _0x44cf17=a0_0x3f99;try{return(await navigator[_0x44cf17(0x10a)][_0x44cf17(0x106)]())['features'][_0x44cf17(0xfc)](_0x44cf17(0x10f));}catch(_0x556102){return!0x1;}}class Florence2Singleton{static [a0_0x385b9a(0x10b)]='onnx-community/Florence-2-base-ft';static async[a0_0x385b9a(0x100)](_0x4ab933=null){const _0x28a549=a0_0x385b9a;return this[_0x28a549(0x109)]??=AutoProcessor[_0x28a549(0xf0)](this[_0x28a549(0x10b)]),this[_0x28a549(0x107)]??=AutoTokenizer[_0x28a549(0xf0)](this[_0x28a549(0x10b)]),this['supports_fp16']??=await hasFp16(),this[_0x28a549(0xfe)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x28a549(0x10b)],{'dtype':{'embed_tokens':this[_0x28a549(0xea)]?_0x28a549(0xf1):_0x28a549(0xfb),'vision_encoder':this[_0x28a549(0xea)]?_0x28a549(0xf1):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x4ab933}),Promise[_0x28a549(0xe8)]([this[_0x28a549(0xfe)],this['tokenizer'],this['processor']]);}}async function load(){const _0x552c56=a0_0x385b9a;self[_0x552c56(0x110)]({'status':_0x552c56(0xee),'data':'Loading\x20model...'});const [_0x23ab28,_0x3c06a5,_0x1e8f5]=await Florence2Singleton[_0x552c56(0x100)](_0xc89787=>{const _0x5b17a4=_0x552c56;self[_0x5b17a4(0x110)](_0xc89787);});self[_0x552c56(0x110)]({'status':_0x552c56(0xee),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x559914=_0x3c06a5('a'),_0x5af1b7=full([0x1,0x3,0x300,0x300],0x0);await _0x23ab28[_0x552c56(0x10c)]({..._0x559914,'pixel_values':_0x5af1b7,'max_new_tokens':0x1}),self[_0x552c56(0x110)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x385b9a(0xf7)];let vision_inputs,image_size;async function run({text:_0x42501c,url:_0x313c30,task:_0x5d74fd}){const _0x351dbb=a0_0x385b9a,[_0x59814c,_0x96ecbf,_0x570d71]=await Florence2Singleton[_0x351dbb(0x100)](),_0xd76af1=performance[_0x351dbb(0xfa)]();if(!vision_inputs){const _0x4842a8=await RawImage[_0x351dbb(0xec)](_0x313c30);image_size=_0x4842a8['size'],vision_inputs=await _0x570d71(_0x4842a8);}let _0x42d75b=_0x5d74fd;TASKS_WITH_INPUTS[_0x351dbb(0x108)](_0x5d74fd)&&_0x42501c&&(_0x42d75b+=_0x42501c);const _0x32c602=_0x96ecbf(_0x570d71[_0x351dbb(0xf5)](_0x42d75b)),_0x56d1e0=await _0x59814c[_0x351dbb(0x10c)]({..._0x32c602,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x12e60b=_0x96ecbf[_0x351dbb(0x103)](_0x56d1e0,{'skip_special_tokens':!0x1})[0x0],_0x2acb8f=_0x570d71[_0x351dbb(0xf6)](_0x12e60b,_0x5d74fd,image_size),_0x2196bc=performance[_0x351dbb(0xfa)]();self['postMessage']({'status':_0x351dbb(0x101),'result':_0x2acb8f,'time':_0x2196bc-_0xd76af1});}function a0_0x54bc(){const _0x599353=['load','getInstance','complete','reset','batch_decode','6EPrtUS','882470DPFdcY','requestAdapter','tokenizer','includes','processor','gpu','model_id','generate','data','907821TeYYFI','shader-f16','postMessage','5615192Kalwps','all','1066608VppWJA','supports_fp16','126380SEtkor','fromURL','160218vLXril','loading','addEventListener','from_pretrained','fp16','run','109464PawDlD','message','construct_prompts','post_process_generation','<CAPTION_TO_PHRASE_GROUNDING>','105SRFROZ','6DrFIoq','now','fp32','has','10ExgUif','model'];a0_0x54bc=function(){return _0x599353;};return a0_0x54bc();}self[a0_0x385b9a(0xef)](a0_0x385b9a(0xf4),async _0x2915d8=>{const _0x4c7740=a0_0x385b9a,{type:_0x5b75a8,data:_0x22fe6a}=_0x2915d8[_0x4c7740(0x10d)];switch(_0x5b75a8){case _0x4c7740(0xff):load();break;case _0x4c7740(0xf2):run(_0x22fe6a);break;case _0x4c7740(0x102):vision_inputs=image_size=null;}});