const a0_0x53e726=a0_0x257d;(function(_0x411950,_0x1d032d){const _0x459b8a=a0_0x257d,_0x5c49b4=_0x411950();while(!![]){try{const _0x363714=parseInt(_0x459b8a(0x11b))/0x1+parseInt(_0x459b8a(0x111))/0x2*(parseInt(_0x459b8a(0x120))/0x3)+parseInt(_0x459b8a(0x12e))/0x4+-parseInt(_0x459b8a(0x110))/0x5+-parseInt(_0x459b8a(0x107))/0x6*(parseInt(_0x459b8a(0x129))/0x7)+-parseInt(_0x459b8a(0x118))/0x8*(-parseInt(_0x459b8a(0x11d))/0x9)+-parseInt(_0x459b8a(0x126))/0xa;if(_0x363714===_0x1d032d)break;else _0x5c49b4['push'](_0x5c49b4['shift']());}catch(_0x26f111){_0x5c49b4['push'](_0x5c49b4['shift']());}}}(a0_0xc101,0x6286d));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x19afaf=a0_0x257d;try{return(await navigator[_0x19afaf(0x12c)][_0x19afaf(0x127)]())[_0x19afaf(0x117)][_0x19afaf(0x106)](_0x19afaf(0x10c));}catch(_0x44209f){return!0x1;}}class Florence2Singleton{static [a0_0x53e726(0x128)]='onnx-community/Florence-2-base-ft';static async['getInstance'](_0x1b9fc5=null){const _0x888e20=a0_0x53e726;return this[_0x888e20(0x10f)]??=AutoProcessor[_0x888e20(0x12b)](this[_0x888e20(0x128)]),this[_0x888e20(0x115)]??=AutoTokenizer[_0x888e20(0x12b)](this[_0x888e20(0x128)]),this[_0x888e20(0x125)]??=await hasFp16(),this[_0x888e20(0x119)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x888e20(0x128)],{'dtype':{'embed_tokens':this[_0x888e20(0x125)]?'fp16':_0x888e20(0x11e),'vision_encoder':this[_0x888e20(0x125)]?_0x888e20(0x12a):_0x888e20(0x11e),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x1b9fc5}),Promise[_0x888e20(0x10b)]([this['model'],this['tokenizer'],this[_0x888e20(0x10f)]]);}}async function load(){const _0x22bb17=a0_0x53e726;self['postMessage']({'status':_0x22bb17(0x11c),'data':_0x22bb17(0x108)});const [_0x501f53,_0x2fc9c4,_0x3c4274]=await Florence2Singleton[_0x22bb17(0x116)](_0x374821=>{self['postMessage'](_0x374821);});self[_0x22bb17(0x123)]({'status':_0x22bb17(0x11c),'data':_0x22bb17(0x113)});const _0xc6e266=_0x2fc9c4('a'),_0x1ad37a=full([0x1,0x3,0x300,0x300],0x0);await _0x501f53[_0x22bb17(0x10e)]({..._0xc6e266,'pixel_values':_0x1ad37a,'max_new_tokens':0x1}),self[_0x22bb17(0x123)]({'status':_0x22bb17(0x12d)});}function a0_0x257d(_0x7a7935,_0x143f13){const _0xc101fb=a0_0xc101();return a0_0x257d=function(_0x257d79,_0x1a02fc){_0x257d79=_0x257d79-0x105;let _0x64d745=_0xc101fb[_0x257d79];return _0x64d745;},a0_0x257d(_0x7a7935,_0x143f13);}const TASKS_WITH_INPUTS=[a0_0x53e726(0x10d)];let vision_inputs,image_size;function a0_0xc101(){const _0x2e84d3=['669993yvhPpQ','loading','70029vIsODY','fp32','now','81708fttpfx','data','addEventListener','postMessage','construct_prompts','supports_fp16','9666860UlnHGs','requestAdapter','model_id','7bGgccj','fp16','from_pretrained','gpu','ready','751448iXCROB','post_process_generation','has','1669362gOFeXd','Loading\x20model...','size','includes','all','shader-f16','<CAPTION_TO_PHRASE_GROUNDING>','generate','processor','424060DhPgLM','58IcQsdb','message','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','batch_decode','tokenizer','getInstance','features','88tsXHeA','model','complete'];a0_0xc101=function(){return _0x2e84d3;};return a0_0xc101();}async function run({text:_0x14632a,url:_0x592aa8,task:_0x42c255}){const _0x433f87=a0_0x53e726,[_0x4767f2,_0x295de4,_0x2c9695]=await Florence2Singleton[_0x433f87(0x116)](),_0x3ab740=performance[_0x433f87(0x11f)]();if(!vision_inputs){const _0x12c5b1=await RawImage['fromURL'](_0x592aa8);image_size=_0x12c5b1[_0x433f87(0x109)],vision_inputs=await _0x2c9695(_0x12c5b1);}let _0x6df96f=_0x42c255;TASKS_WITH_INPUTS[_0x433f87(0x10a)](_0x42c255)&&_0x14632a&&(_0x6df96f+=_0x14632a);const _0x17eebf=_0x295de4(_0x2c9695[_0x433f87(0x124)](_0x6df96f)),_0x2d2fba=await _0x4767f2[_0x433f87(0x10e)]({..._0x17eebf,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x40d244=_0x295de4[_0x433f87(0x114)](_0x2d2fba,{'skip_special_tokens':!0x1})[0x0],_0x856356=_0x2c9695[_0x433f87(0x105)](_0x40d244,_0x42c255,image_size),_0x356853=performance[_0x433f87(0x11f)]();self[_0x433f87(0x123)]({'status':_0x433f87(0x11a),'result':_0x856356,'time':_0x356853-_0x3ab740});}self[a0_0x53e726(0x122)](a0_0x53e726(0x112),async _0x16b956=>{const _0x2bbee9=a0_0x53e726,{type:_0x3e2040,data:_0x2bea6f}=_0x16b956[_0x2bbee9(0x121)];switch(_0x3e2040){case'load':load();break;case'run':run(_0x2bea6f);break;case'reset':vision_inputs=image_size=null;}});