const a0_0x440fc4=a0_0x40fc;(function(_0x51b3e8,_0x1be7fe){const _0x5a8e35=a0_0x40fc,_0x4c3adc=_0x51b3e8();while(!![]){try{const _0x10c88b=parseInt(_0x5a8e35(0x149))/0x1+parseInt(_0x5a8e35(0x154))/0x2+-parseInt(_0x5a8e35(0x151))/0x3+-parseInt(_0x5a8e35(0x146))/0x4*(-parseInt(_0x5a8e35(0x153))/0x5)+parseInt(_0x5a8e35(0x139))/0x6*(parseInt(_0x5a8e35(0x158))/0x7)+-parseInt(_0x5a8e35(0x152))/0x8*(-parseInt(_0x5a8e35(0x14a))/0x9)+-parseInt(_0x5a8e35(0x13c))/0xa;if(_0x10c88b===_0x1be7fe)break;else _0x4c3adc['push'](_0x4c3adc['shift']());}catch(_0x423089){_0x4c3adc['push'](_0x4c3adc['shift']());}}}(a0_0xd05c,0x6222c));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3/dist/transformers.min.js';async function hasFp16(){const _0xd449d0=a0_0x40fc;try{return(await navigator['gpu'][_0xd449d0(0x150)]())[_0xd449d0(0x13a)][_0xd449d0(0x14b)](_0xd449d0(0x14e));}catch(_0x212545){return!0x1;}}class Florence2Singleton{static [a0_0x440fc4(0x148)]=a0_0x440fc4(0x14c);static async[a0_0x440fc4(0x156)](_0x40031a=null){const _0x3fba99=a0_0x440fc4;return this[_0x3fba99(0x155)]??=AutoProcessor[_0x3fba99(0x140)](this['model_id']),this[_0x3fba99(0x143)]??=AutoTokenizer[_0x3fba99(0x140)](this[_0x3fba99(0x148)]),this[_0x3fba99(0x147)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x3fba99(0x148)],{'dtype':{'embed_tokens':this[_0x3fba99(0x147)]?_0x3fba99(0x141):_0x3fba99(0x13d),'vision_encoder':this[_0x3fba99(0x147)]?_0x3fba99(0x141):_0x3fba99(0x13d),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x40031a}),Promise['all']([this['model'],this[_0x3fba99(0x143)],this[_0x3fba99(0x155)]]);}}function a0_0x40fc(_0x95d8be,_0x1a0f48){const _0xd05c10=a0_0xd05c();return a0_0x40fc=function(_0x40fca3,_0x2b03fe){_0x40fca3=_0x40fca3-0x136;let _0xd8da78=_0xd05c10[_0x40fca3];return _0xd8da78;},a0_0x40fc(_0x95d8be,_0x1a0f48);}async function load(){const _0x1c0a0a=a0_0x440fc4;self[_0x1c0a0a(0x13f)]({'status':_0x1c0a0a(0x13e),'data':'Loading\x20model...'});const [_0x2c9af7,_0x5a553d,_0x513a29]=await Florence2Singleton[_0x1c0a0a(0x156)](_0x3df2fc=>{const _0x9e1ae=_0x1c0a0a;self[_0x9e1ae(0x13f)](_0x3df2fc);});self[_0x1c0a0a(0x13f)]({'status':_0x1c0a0a(0x13e),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x5d60e1=_0x5a553d('a'),_0x2e1af0=full([0x1,0x3,0x300,0x300],0x0);await _0x2c9af7['generate']({..._0x5d60e1,'pixel_values':_0x2e1af0,'max_new_tokens':0x1}),self[_0x1c0a0a(0x13f)]({'status':_0x1c0a0a(0x13b)});}const TASKS_WITH_INPUTS=[a0_0x440fc4(0x138)];let vision_inputs,image_size;function a0_0xd05c(){const _0x324982=['263781gpojJv','has','onnx-community/Florence-2-base-ft','generate','shader-f16','complete','requestAdapter','1401441qyxHAj','136XrmQHl','5jXYhNc','1445324nvWgDh','processor','getInstance','batch_decode','719607BBFBpY','now','data','post_process_generation','<CAPTION_TO_PHRASE_GROUNDING>','6Tqakep','features','ready','11136330nlMFkx','fp32','loading','postMessage','from_pretrained','fp16','addEventListener','tokenizer','run','fromURL','830596ppuxua','supports_fp16','model_id','451379EtHhei'];a0_0xd05c=function(){return _0x324982;};return a0_0xd05c();}async function run({text:_0x2f9a64,url:_0x1f1378,task:_0x26d04e}){const _0x52fb01=a0_0x440fc4,[_0x3e8824,_0x52cd64,_0x56da46]=await Florence2Singleton[_0x52fb01(0x156)](),_0xb53dc8=performance[_0x52fb01(0x159)]();if(!vision_inputs){const _0x1e3405=await RawImage[_0x52fb01(0x145)](_0x1f1378);image_size=_0x1e3405['size'],vision_inputs=await _0x56da46(_0x1e3405);}let _0xa1f32e=_0x26d04e;TASKS_WITH_INPUTS['includes'](_0x26d04e)&&_0x2f9a64&&(_0xa1f32e+=_0x2f9a64);const _0x392684=_0x52cd64(_0x56da46['construct_prompts'](_0xa1f32e)),_0x9a97dd=await _0x3e8824[_0x52fb01(0x14d)]({..._0x392684,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x45e657=_0x52cd64[_0x52fb01(0x157)](_0x9a97dd,{'skip_special_tokens':!0x1})[0x0],_0x2012da=_0x56da46[_0x52fb01(0x137)](_0x45e657,_0x26d04e,image_size),_0x16374e=performance[_0x52fb01(0x159)]();self['postMessage']({'status':_0x52fb01(0x14f),'result':_0x2012da,'time':_0x16374e-_0xb53dc8});}self[a0_0x440fc4(0x142)]('message',async _0x363535=>{const _0x480e78=a0_0x440fc4,{type:_0x5196b8,data:_0x39587a}=_0x363535[_0x480e78(0x136)];switch(_0x5196b8){case'load':load();break;case _0x480e78(0x144):run(_0x39587a);break;case'reset':vision_inputs=image_size=null;}});