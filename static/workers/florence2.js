const a0_0x305262=a0_0x1f71;(function(_0x593d3b,_0x325124){const _0x1a9d9d=a0_0x1f71,_0x52d6c5=_0x593d3b();while(!![]){try{const _0x935c23=parseInt(_0x1a9d9d(0x118))/0x1+parseInt(_0x1a9d9d(0x101))/0x2+parseInt(_0x1a9d9d(0x119))/0x3+parseInt(_0x1a9d9d(0x120))/0x4+-parseInt(_0x1a9d9d(0x116))/0x5+-parseInt(_0x1a9d9d(0x11c))/0x6*(parseInt(_0x1a9d9d(0x10e))/0x7)+-parseInt(_0x1a9d9d(0x10a))/0x8*(-parseInt(_0x1a9d9d(0x100))/0x9);if(_0x935c23===_0x325124)break;else _0x52d6c5['push'](_0x52d6c5['shift']());}catch(_0x237e46){_0x52d6c5['push'](_0x52d6c5['shift']());}}}(a0_0x2a82,0xa92da));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x1f71(_0x88ca97,_0x375b59){const _0x2a824d=a0_0x2a82();return a0_0x1f71=function(_0x1f71bd,_0x14d296){_0x1f71bd=_0x1f71bd-0xfe;let _0x4b7e69=_0x2a824d[_0x1f71bd];return _0x4b7e69;},a0_0x1f71(_0x88ca97,_0x375b59);}async function hasFp16(){const _0x585e07=a0_0x1f71;try{return(await navigator[_0x585e07(0x125)][_0x585e07(0x106)]())[_0x585e07(0x10d)][_0x585e07(0x127)](_0x585e07(0x108));}catch(_0x53e086){return!0x1;}}class Florence2Singleton{static [a0_0x305262(0x122)]='onnx-community/Florence-2-base-ft';static async['getInstance'](_0x45b252=null){const _0x5e9982=a0_0x305262;return this['processor']??=AutoProcessor[_0x5e9982(0x11b)](this[_0x5e9982(0x122)]),this[_0x5e9982(0x114)]??=AutoTokenizer[_0x5e9982(0x11b)](this['model_id']),this['supports_fp16']??=await hasFp16(),this[_0x5e9982(0x117)]??=Florence2ForConditionalGeneration[_0x5e9982(0x11b)](this[_0x5e9982(0x122)],{'dtype':{'embed_tokens':this[_0x5e9982(0x10b)]?_0x5e9982(0x107):'fp32','vision_encoder':this['supports_fp16']?_0x5e9982(0x107):_0x5e9982(0x110),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5e9982(0x115),'progress_callback':_0x45b252}),Promise[_0x5e9982(0x123)]([this['model'],this[_0x5e9982(0x114)],this[_0x5e9982(0x121)]]);}}async function load(){const _0x19ac1c=a0_0x305262;self[_0x19ac1c(0x109)]({'status':_0x19ac1c(0x10f),'data':_0x19ac1c(0xff)});const [_0x4a724c,_0x2f77a4,_0x194004]=await Florence2Singleton[_0x19ac1c(0x112)](_0x5cc654=>{const _0x3b1e3f=_0x19ac1c;self[_0x3b1e3f(0x109)](_0x5cc654);});self[_0x19ac1c(0x109)]({'status':_0x19ac1c(0x10f),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x138ad7=_0x2f77a4('a'),_0x1e02d4=full([0x1,0x3,0x300,0x300],0x0);await _0x4a724c[_0x19ac1c(0x126)]({..._0x138ad7,'pixel_values':_0x1e02d4,'max_new_tokens':0x1}),self[_0x19ac1c(0x109)]({'status':_0x19ac1c(0x113)});}const TASKS_WITH_INPUTS=[a0_0x305262(0x102)];function a0_0x2a82(){const _0x14450a=['2004HsAPxI','construct_prompts','now','addEventListener','1328876JpNUCR','processor','model_id','all','data','gpu','generate','has','batch_decode','Loading\x20model...','18XdXcGW','608320CwhNZJ','<CAPTION_TO_PHRASE_GROUNDING>','message','fromURL','size','requestAdapter','fp16','shader-f16','postMessage','6967392yARDxN','supports_fp16','reset','features','25592nWTxbo','loading','fp32','complete','getInstance','ready','tokenizer','webgpu','6582420UjJHnH','model','623480FNWcMP','686505FXjAqF','run','from_pretrained'];a0_0x2a82=function(){return _0x14450a;};return a0_0x2a82();}let vision_inputs,image_size;async function run({text:_0x2d2766,url:_0x3fa2b4,task:_0x5e6e8d}){const _0x59f393=a0_0x305262,[_0x5850a7,_0x26587e,_0x46c1f0]=await Florence2Singleton['getInstance'](),_0x5cf201=performance['now']();if(!vision_inputs){const _0x363de5=await RawImage[_0x59f393(0x104)](_0x3fa2b4);image_size=_0x363de5[_0x59f393(0x105)],vision_inputs=await _0x46c1f0(_0x363de5);}let _0x526f5d=_0x5e6e8d;TASKS_WITH_INPUTS['includes'](_0x5e6e8d)&&_0x2d2766&&(_0x526f5d+=_0x2d2766);const _0xbe04da=_0x26587e(_0x46c1f0[_0x59f393(0x11d)](_0x526f5d)),_0x2f0f95=await _0x5850a7[_0x59f393(0x126)]({..._0xbe04da,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x46d26f=_0x26587e[_0x59f393(0xfe)](_0x2f0f95,{'skip_special_tokens':!0x1})[0x0],_0x4932bd=_0x46c1f0['post_process_generation'](_0x46d26f,_0x5e6e8d,image_size),_0x1a66d4=performance[_0x59f393(0x11e)]();self[_0x59f393(0x109)]({'status':_0x59f393(0x111),'result':_0x4932bd,'time':_0x1a66d4-_0x5cf201});}self[a0_0x305262(0x11f)](a0_0x305262(0x103),async _0x4d2335=>{const _0xbdc9bc=a0_0x305262,{type:_0x2420d7,data:_0x3d76d9}=_0x4d2335[_0xbdc9bc(0x124)];switch(_0x2420d7){case'load':load();break;case _0xbdc9bc(0x11a):run(_0x3d76d9);break;case _0xbdc9bc(0x10c):vision_inputs=image_size=null;}});