const a0_0x31c6d5=a0_0xf119;(function(_0x17e6a8,_0x79263){const _0x386c5a=a0_0xf119,_0x18e9df=_0x17e6a8();while(!![]){try{const _0x1d3aa9=-parseInt(_0x386c5a(0xf7))/0x1*(-parseInt(_0x386c5a(0xf9))/0x2)+-parseInt(_0x386c5a(0x117))/0x3*(-parseInt(_0x386c5a(0x113))/0x4)+-parseInt(_0x386c5a(0x114))/0x5+-parseInt(_0x386c5a(0x11f))/0x6*(parseInt(_0x386c5a(0x11c))/0x7)+parseInt(_0x386c5a(0x102))/0x8*(-parseInt(_0x386c5a(0x115))/0x9)+-parseInt(_0x386c5a(0x10e))/0xa+parseInt(_0x386c5a(0x10c))/0xb;if(_0x1d3aa9===_0x79263)break;else _0x18e9df['push'](_0x18e9df['shift']());}catch(_0x27f8fd){_0x18e9df['push'](_0x18e9df['shift']());}}}(a0_0x12ac,0x4dc29));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x3847f8=a0_0xf119;try{return(await navigator['gpu'][_0x3847f8(0x112)]())[_0x3847f8(0xff)][_0x3847f8(0xf8)]('shader-f16');}catch(_0x1b5a4d){return!0x1;}}class Florence2Singleton{static [a0_0x31c6d5(0x11b)]=a0_0x31c6d5(0x108);static async['getInstance'](_0x27ba91=null){const _0x5ca8fc=a0_0x31c6d5;return this[_0x5ca8fc(0x10a)]??=AutoProcessor[_0x5ca8fc(0x111)](this[_0x5ca8fc(0x11b)]),this[_0x5ca8fc(0x11e)]??=AutoTokenizer[_0x5ca8fc(0x111)](this[_0x5ca8fc(0x11b)]),this[_0x5ca8fc(0x105)]??=await hasFp16(),this[_0x5ca8fc(0x10f)]??=Florence2ForConditionalGeneration[_0x5ca8fc(0x111)](this[_0x5ca8fc(0x11b)],{'dtype':{'embed_tokens':this[_0x5ca8fc(0x105)]?_0x5ca8fc(0x100):'fp32','vision_encoder':this[_0x5ca8fc(0x105)]?'fp16':_0x5ca8fc(0x119),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5ca8fc(0x118),'progress_callback':_0x27ba91}),Promise[_0x5ca8fc(0x104)]([this['model'],this[_0x5ca8fc(0x11e)],this[_0x5ca8fc(0x10a)]]);}}async function load(){const _0x33ff53=a0_0x31c6d5;self['postMessage']({'status':'loading','data':_0x33ff53(0x11d)});const [_0x155926,_0x428d2b,_0x2704d9]=await Florence2Singleton[_0x33ff53(0x116)](_0x15f4d0=>{const _0x42d798=_0x33ff53;self[_0x42d798(0x107)](_0x15f4d0);});self[_0x33ff53(0x107)]({'status':_0x33ff53(0x109),'data':_0x33ff53(0xfa)});const _0x2d3e17=_0x428d2b('a'),_0x3a8d92=full([0x1,0x3,0x300,0x300],0x0);await _0x155926[_0x33ff53(0x10b)]({..._0x2d3e17,'pixel_values':_0x3a8d92,'max_new_tokens':0x1}),self[_0x33ff53(0x107)]({'status':'ready'});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;function a0_0x12ac(){const _0x137613=['postMessage','onnx-community/Florence-2-base-ft','loading','processor','generate','6719680LpOHHd','batch_decode','3032220aweEvQ','model','size','from_pretrained','requestAdapter','20VzngJt','1604750tWXsbq','1215819TexJAv','getInstance','284397kbOfkC','webgpu','fp32','addEventListener','model_id','2154229EtHdeZ','Loading\x20model...','tokenizer','6UlAQrn','includes','run','5nugKUZ','has','120256HbhPJg','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','message','now','complete','reset','features','fp16','construct_prompts','8VFfjJv','data','all','supports_fp16','load'];a0_0x12ac=function(){return _0x137613;};return a0_0x12ac();}async function run({text:_0x3e55b5,url:_0x3b3fb7,task:_0xa2b56a}){const _0x468a3f=a0_0x31c6d5,[_0x3d95ec,_0x18a902,_0x127774]=await Florence2Singleton[_0x468a3f(0x116)](),_0x1df378=performance[_0x468a3f(0xfc)]();if(!vision_inputs){const _0x1d01d9=await RawImage['fromURL'](_0x3b3fb7);image_size=_0x1d01d9[_0x468a3f(0x110)],vision_inputs=await _0x127774(_0x1d01d9);}let _0xb1ddb9=_0xa2b56a;TASKS_WITH_INPUTS[_0x468a3f(0x120)](_0xa2b56a)&&_0x3e55b5&&(_0xb1ddb9+=_0x3e55b5);const _0x3e4491=_0x18a902(_0x127774[_0x468a3f(0x101)](_0xb1ddb9)),_0x2df7d3=await _0x3d95ec['generate']({..._0x3e4491,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x13e2cc=_0x18a902[_0x468a3f(0x10d)](_0x2df7d3,{'skip_special_tokens':!0x1})[0x0],_0x14c40c=_0x127774['post_process_generation'](_0x13e2cc,_0xa2b56a,image_size),_0x414a22=performance[_0x468a3f(0xfc)]();self[_0x468a3f(0x107)]({'status':_0x468a3f(0xfd),'result':_0x14c40c,'time':_0x414a22-_0x1df378});}function a0_0xf119(_0x374b6f,_0x802937){const _0x12acb3=a0_0x12ac();return a0_0xf119=function(_0xf119a6,_0x524678){_0xf119a6=_0xf119a6-0xf7;let _0x3eb8d1=_0x12acb3[_0xf119a6];return _0x3eb8d1;},a0_0xf119(_0x374b6f,_0x802937);}self[a0_0x31c6d5(0x11a)](a0_0x31c6d5(0xfb),async _0x567357=>{const _0x3a625e=a0_0x31c6d5,{type:_0x4afd1f,data:_0x58856d}=_0x567357[_0x3a625e(0x103)];switch(_0x4afd1f){case _0x3a625e(0x106):load();break;case _0x3a625e(0x121):run(_0x58856d);break;case _0x3a625e(0xfe):vision_inputs=image_size=null;}});