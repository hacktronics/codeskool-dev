const a0_0x34f32b=a0_0x218e;(function(_0x2cbc04,_0x96c93d){const _0x5f3d83=a0_0x218e,_0x46ee99=_0x2cbc04();while(!![]){try{const _0x31ecda=parseInt(_0x5f3d83(0xfb))/0x1*(-parseInt(_0x5f3d83(0xee))/0x2)+-parseInt(_0x5f3d83(0x108))/0x3*(-parseInt(_0x5f3d83(0x10c))/0x4)+parseInt(_0x5f3d83(0xef))/0x5+parseInt(_0x5f3d83(0xf8))/0x6+parseInt(_0x5f3d83(0xf1))/0x7+-parseInt(_0x5f3d83(0xf9))/0x8*(-parseInt(_0x5f3d83(0xf7))/0x9)+parseInt(_0x5f3d83(0xec))/0xa*(-parseInt(_0x5f3d83(0x10f))/0xb);if(_0x31ecda===_0x96c93d)break;else _0x46ee99['push'](_0x46ee99['shift']());}catch(_0x3aee89){_0x46ee99['push'](_0x46ee99['shift']());}}}(a0_0x396c,0x2d912));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x19d3db=a0_0x218e;try{return(await navigator[_0x19d3db(0x101)]['requestAdapter']())[_0x19d3db(0x104)][_0x19d3db(0x103)](_0x19d3db(0x10d));}catch(_0x39a575){return!0x1;}}class Florence2Singleton{static [a0_0x34f32b(0xea)]=a0_0x34f32b(0x105);static async[a0_0x34f32b(0x109)](_0x58e199=null){const _0x349a29=a0_0x34f32b;return this['processor']??=AutoProcessor[_0x349a29(0xf6)](this[_0x349a29(0xea)]),this[_0x349a29(0x10e)]??=AutoTokenizer['from_pretrained'](this[_0x349a29(0xea)]),this['supports_fp16']??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x349a29(0xf6)](this[_0x349a29(0xea)],{'dtype':{'embed_tokens':this[_0x349a29(0xfa)]?_0x349a29(0xfe):_0x349a29(0x106),'vision_encoder':this[_0x349a29(0xfa)]?_0x349a29(0xfe):_0x349a29(0x106),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x58e199}),Promise['all']([this[_0x349a29(0xf5)],this[_0x349a29(0x10e)],this[_0x349a29(0xf2)]]);}}async function load(){const _0xc1e287=a0_0x34f32b;self['postMessage']({'status':_0xc1e287(0x100),'data':_0xc1e287(0xf0)});const [_0x312227,_0xb10c3f,_0x4ea7ac]=await Florence2Singleton[_0xc1e287(0x109)](_0x507c2e=>{const _0x4fbaa0=_0xc1e287;self[_0x4fbaa0(0x107)](_0x507c2e);});self[_0xc1e287(0x107)]({'status':_0xc1e287(0x100),'data':_0xc1e287(0xf4)});const _0x31a9eb=_0xb10c3f('a'),_0x398c6c=full([0x1,0x3,0x300,0x300],0x0);await _0x312227['generate']({..._0x31a9eb,'pixel_values':_0x398c6c,'max_new_tokens':0x1}),self[_0xc1e287(0x107)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x34f32b(0xfc)];let vision_inputs,image_size;async function run({text:_0x540308,url:_0x515747,task:_0x2039fb}){const _0x1a3e24=a0_0x34f32b,[_0x17888b,_0x98ef25,_0x4cd0a8]=await Florence2Singleton[_0x1a3e24(0x109)](),_0x9cb15d=performance[_0x1a3e24(0x10a)]();if(!vision_inputs){const _0x3e0da2=await RawImage[_0x1a3e24(0xed)](_0x515747);image_size=_0x3e0da2['size'],vision_inputs=await _0x4cd0a8(_0x3e0da2);}let _0x3550d2=_0x2039fb;TASKS_WITH_INPUTS['includes'](_0x2039fb)&&_0x540308&&(_0x3550d2+=_0x540308);const _0x44347f=_0x98ef25(_0x4cd0a8[_0x1a3e24(0xf3)](_0x3550d2)),_0x29b27d=await _0x17888b['generate']({..._0x44347f,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x189c0b=_0x98ef25[_0x1a3e24(0x111)](_0x29b27d,{'skip_special_tokens':!0x1})[0x0],_0x4985f0=_0x4cd0a8[_0x1a3e24(0x110)](_0x189c0b,_0x2039fb,image_size),_0x4ebe60=performance[_0x1a3e24(0x10a)]();self[_0x1a3e24(0x107)]({'status':_0x1a3e24(0xfd),'result':_0x4985f0,'time':_0x4ebe60-_0x9cb15d});}function a0_0x218e(_0x55b5e4,_0x3086e1){const _0x396cff=a0_0x396c();return a0_0x218e=function(_0x218e92,_0x3ab6d6){_0x218e92=_0x218e92-0xea;let _0x3bbf9c=_0x396cff[_0x218e92];return _0x3bbf9c;},a0_0x218e(_0x55b5e4,_0x3086e1);}self['addEventListener']('message',async _0x3667bd=>{const _0x15ac73=a0_0x34f32b,{type:_0x130451,data:_0x257c2a}=_0x3667bd[_0x15ac73(0xff)];switch(_0x130451){case _0x15ac73(0x102):load();break;case _0x15ac73(0x10b):run(_0x257c2a);break;case _0x15ac73(0xeb):vision_inputs=image_size=null;}});function a0_0x396c(){const _0x214591=['postMessage','164166KLJRMu','getInstance','now','run','4QFJtpV','shader-f16','tokenizer','1741674ItLfDE','post_process_generation','batch_decode','model_id','reset','10ObCqyp','fromURL','6eAqxjT','442930wKmxLh','Loading\x20model...','1627136NJNNyl','processor','construct_prompts','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','model','from_pretrained','9mSOPeA','492438ncsBHD','20792DJeSJH','supports_fp16','38484IXVNkX','<CAPTION_TO_PHRASE_GROUNDING>','complete','fp16','data','loading','gpu','load','has','features','onnx-community/Florence-2-base-ft','fp32'];a0_0x396c=function(){return _0x214591;};return a0_0x396c();}