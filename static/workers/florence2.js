const a0_0x11e1d7=a0_0x2238;(function(_0x268fab,_0x41efc4){const _0x31bf6a=a0_0x2238,_0x10544a=_0x268fab();while(!![]){try{const _0x1137a7=-parseInt(_0x31bf6a(0x1c6))/0x1*(parseInt(_0x31bf6a(0x1bf))/0x2)+-parseInt(_0x31bf6a(0x1d3))/0x3*(-parseInt(_0x31bf6a(0x1c7))/0x4)+-parseInt(_0x31bf6a(0x1cb))/0x5+parseInt(_0x31bf6a(0x1c8))/0x6+-parseInt(_0x31bf6a(0x1bb))/0x7*(parseInt(_0x31bf6a(0x1d7))/0x8)+-parseInt(_0x31bf6a(0x1b3))/0x9+parseInt(_0x31bf6a(0x1b6))/0xa;if(_0x1137a7===_0x41efc4)break;else _0x10544a['push'](_0x10544a['shift']());}catch(_0x25b6bf){_0x10544a['push'](_0x10544a['shift']());}}}(a0_0x110f,0x1998f));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x2238(_0x252b72,_0x491864){const _0x110f97=a0_0x110f();return a0_0x2238=function(_0x22389e,_0x5b2d68){_0x22389e=_0x22389e-0x1b3;let _0x52890a=_0x110f97[_0x22389e];return _0x52890a;},a0_0x2238(_0x252b72,_0x491864);}async function hasFp16(){const _0x33882e=a0_0x2238;try{return(await navigator[_0x33882e(0x1d5)][_0x33882e(0x1d2)]())[_0x33882e(0x1cc)][_0x33882e(0x1ca)](_0x33882e(0x1c0));}catch(_0x314807){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x11e1d7(0x1d9);static async[a0_0x11e1d7(0x1d4)](_0x346319=null){const _0x582693=a0_0x11e1d7;return this[_0x582693(0x1da)]??=AutoProcessor['from_pretrained'](this[_0x582693(0x1cd)]),this[_0x582693(0x1d6)]??=AutoTokenizer[_0x582693(0x1de)](this[_0x582693(0x1cd)]),this[_0x582693(0x1d1)]??=await hasFp16(),this[_0x582693(0x1d8)]??=Florence2ForConditionalGeneration[_0x582693(0x1de)](this[_0x582693(0x1cd)],{'dtype':{'embed_tokens':this[_0x582693(0x1d1)]?'fp16':'fp32','vision_encoder':this[_0x582693(0x1d1)]?_0x582693(0x1db):_0x582693(0x1b7),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x582693(0x1bd),'progress_callback':_0x346319}),Promise[_0x582693(0x1b8)]([this['model'],this[_0x582693(0x1d6)],this[_0x582693(0x1da)]]);}}function a0_0x110f(){const _0x2672cf=['198868mTUrtv','shader-f16','generate','size','now','batch_decode','loading','2URRpRq','32zrqfIz','1065198FdBbWQ','post_process_generation','has','71080TwlEmI','features','model_id','addEventListener','message','fromURL','supports_fp16','requestAdapter','51567siyEaA','getInstance','gpu','tokenizer','48clYwvC','model','onnx-community/Florence-2-base-ft','processor','fp16','construct_prompts','postMessage','from_pretrained','829350UVeWMu','ready','run','1890320PJlLeH','fp32','all','reset','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','109662NjtoWB','<CAPTION_TO_PHRASE_GROUNDING>','webgpu','data'];a0_0x110f=function(){return _0x2672cf;};return a0_0x110f();}async function load(){const _0x525edc=a0_0x11e1d7;self[_0x525edc(0x1dd)]({'status':_0x525edc(0x1c5),'data':'Loading\x20model...'});const [_0x5d8d5f,_0x29ec40,_0x20d4dd]=await Florence2Singleton[_0x525edc(0x1d4)](_0x54600c=>{const _0x290709=_0x525edc;self[_0x290709(0x1dd)](_0x54600c);});self[_0x525edc(0x1dd)]({'status':'loading','data':_0x525edc(0x1ba)});const _0xc0782f=_0x29ec40('a'),_0x2ffebb=full([0x1,0x3,0x300,0x300],0x0);await _0x5d8d5f[_0x525edc(0x1c1)]({..._0xc0782f,'pixel_values':_0x2ffebb,'max_new_tokens':0x1}),self[_0x525edc(0x1dd)]({'status':_0x525edc(0x1b4)});}const TASKS_WITH_INPUTS=[a0_0x11e1d7(0x1bc)];let vision_inputs,image_size;async function run({text:_0x71534f,url:_0x2e8fa4,task:_0x1d7f2a}){const _0x596591=a0_0x11e1d7,[_0x34058c,_0x3345d4,_0x514669]=await Florence2Singleton[_0x596591(0x1d4)](),_0x133c6c=performance[_0x596591(0x1c3)]();if(!vision_inputs){const _0x14076e=await RawImage[_0x596591(0x1d0)](_0x2e8fa4);image_size=_0x14076e[_0x596591(0x1c2)],vision_inputs=await _0x514669(_0x14076e);}let _0x22d559=_0x1d7f2a;TASKS_WITH_INPUTS['includes'](_0x1d7f2a)&&_0x71534f&&(_0x22d559+=_0x71534f);const _0x22a1bd=_0x3345d4(_0x514669[_0x596591(0x1dc)](_0x22d559)),_0x157fee=await _0x34058c[_0x596591(0x1c1)]({..._0x22a1bd,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x2e8de8=_0x3345d4[_0x596591(0x1c4)](_0x157fee,{'skip_special_tokens':!0x1})[0x0],_0x584aa5=_0x514669[_0x596591(0x1c9)](_0x2e8de8,_0x1d7f2a,image_size),_0x71c5c=performance[_0x596591(0x1c3)]();self[_0x596591(0x1dd)]({'status':'complete','result':_0x584aa5,'time':_0x71c5c-_0x133c6c});}self[a0_0x11e1d7(0x1ce)](a0_0x11e1d7(0x1cf),async _0x28da29=>{const _0x39dbb5=a0_0x11e1d7,{type:_0x4cfc26,data:_0x17861a}=_0x28da29[_0x39dbb5(0x1be)];switch(_0x4cfc26){case'load':load();break;case _0x39dbb5(0x1b5):run(_0x17861a);break;case _0x39dbb5(0x1b9):vision_inputs=image_size=null;}});