const a0_0xe752f3=a0_0x59a4;(function(_0x462b11,_0x4c3bdf){const _0x13fe4e=a0_0x59a4,_0x37d150=_0x462b11();while(!![]){try{const _0x5dbf9d=-parseInt(_0x13fe4e(0xf4))/0x1+-parseInt(_0x13fe4e(0xea))/0x2*(-parseInt(_0x13fe4e(0xfb))/0x3)+-parseInt(_0x13fe4e(0xf5))/0x4*(-parseInt(_0x13fe4e(0x106))/0x5)+parseInt(_0x13fe4e(0xff))/0x6+parseInt(_0x13fe4e(0xe9))/0x7*(parseInt(_0x13fe4e(0x105))/0x8)+-parseInt(_0x13fe4e(0x100))/0x9*(-parseInt(_0x13fe4e(0x103))/0xa)+-parseInt(_0x13fe4e(0x10c))/0xb;if(_0x5dbf9d===_0x4c3bdf)break;else _0x37d150['push'](_0x37d150['shift']());}catch(_0x2d7ac8){_0x37d150['push'](_0x37d150['shift']());}}}(a0_0x2c0d,0x651b7));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x9e55b4=a0_0x59a4;try{return(await navigator['gpu'][_0x9e55b4(0xfd)]())['features'][_0x9e55b4(0xfa)]('shader-f16');}catch(_0x544be3){return!0x1;}}class Florence2Singleton{static [a0_0xe752f3(0xf1)]=a0_0xe752f3(0x108);static async['getInstance'](_0x26aa88=null){const _0x58b2b2=a0_0xe752f3;return this[_0x58b2b2(0xeb)]??=AutoProcessor[_0x58b2b2(0x10d)](this[_0x58b2b2(0xf1)]),this['tokenizer']??=AutoTokenizer[_0x58b2b2(0x10d)](this[_0x58b2b2(0xf1)]),this[_0x58b2b2(0x10e)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x58b2b2(0x10d)](this['model_id'],{'dtype':{'embed_tokens':this[_0x58b2b2(0x10e)]?_0x58b2b2(0xfe):_0x58b2b2(0xf7),'vision_encoder':this[_0x58b2b2(0x10e)]?_0x58b2b2(0xfe):_0x58b2b2(0xf7),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x26aa88}),Promise[_0x58b2b2(0xe7)]([this['model'],this[_0x58b2b2(0xf6)],this[_0x58b2b2(0xeb)]]);}}async function load(){const _0x41ff96=a0_0xe752f3;self[_0x41ff96(0x10a)]({'status':_0x41ff96(0xf3),'data':'Loading\x20model...'});const [_0x294945,_0x3791d3,_0x5586ad]=await Florence2Singleton[_0x41ff96(0x101)](_0x3d7f66=>{self['postMessage'](_0x3d7f66);});self[_0x41ff96(0x10a)]({'status':_0x41ff96(0xf3),'data':_0x41ff96(0xee)});const _0x33ab0c=_0x3791d3('a'),_0x271db8=full([0x1,0x3,0x300,0x300],0x0);await _0x294945[_0x41ff96(0xef)]({..._0x33ab0c,'pixel_values':_0x271db8,'max_new_tokens':0x1}),self['postMessage']({'status':_0x41ff96(0x10b)});}function a0_0x59a4(_0xc79eae,_0x198a75){const _0x2c0d99=a0_0x2c0d();return a0_0x59a4=function(_0x59a417,_0x495c50){_0x59a417=_0x59a417-0xe7;let _0x1517a6=_0x2c0d99[_0x59a417];return _0x1517a6;},a0_0x59a4(_0xc79eae,_0x198a75);}const TASKS_WITH_INPUTS=[a0_0xe752f3(0xfc)];function a0_0x2c0d(){const _0x42b62a=['2991315HKRmya','load','onnx-community/Florence-2-base-ft','construct_prompts','postMessage','ready','14994441gWPjIy','from_pretrained','supports_fp16','all','size','87612Uckiud','5902ddbrdw','processor','includes','fromURL','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','generate','run','model_id','message','loading','198298yDecHH','4hZOSbr','tokenizer','fp32','batch_decode','complete','has','51MOwcWe','<CAPTION_TO_PHRASE_GROUNDING>','requestAdapter','fp16','3703158JZcasA','9CmdaTC','getInstance','data','3720090LViLQJ','post_process_generation','216pgmgWa'];a0_0x2c0d=function(){return _0x42b62a;};return a0_0x2c0d();}let vision_inputs,image_size;async function run({text:_0x423aa2,url:_0x29f1b6,task:_0x19a053}){const _0x31b1e3=a0_0xe752f3,[_0x1fc9db,_0x29bf64,_0x2bb640]=await Florence2Singleton[_0x31b1e3(0x101)](),_0x5227d5=performance['now']();if(!vision_inputs){const _0x5b4530=await RawImage[_0x31b1e3(0xed)](_0x29f1b6);image_size=_0x5b4530[_0x31b1e3(0xe8)],vision_inputs=await _0x2bb640(_0x5b4530);}let _0x2a1c8a=_0x19a053;TASKS_WITH_INPUTS[_0x31b1e3(0xec)](_0x19a053)&&_0x423aa2&&(_0x2a1c8a+=_0x423aa2);const _0x12d029=_0x29bf64(_0x2bb640[_0x31b1e3(0x109)](_0x2a1c8a)),_0x7b10c=await _0x1fc9db[_0x31b1e3(0xef)]({..._0x12d029,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3d639d=_0x29bf64[_0x31b1e3(0xf8)](_0x7b10c,{'skip_special_tokens':!0x1})[0x0],_0x52ad6e=_0x2bb640[_0x31b1e3(0x104)](_0x3d639d,_0x19a053,image_size),_0x170cb2=performance['now']();self['postMessage']({'status':_0x31b1e3(0xf9),'result':_0x52ad6e,'time':_0x170cb2-_0x5227d5});}self['addEventListener'](a0_0xe752f3(0xf2),async _0x1ba352=>{const _0x387bd5=a0_0xe752f3,{type:_0x21aa9a,data:_0x458ea5}=_0x1ba352[_0x387bd5(0x102)];switch(_0x21aa9a){case _0x387bd5(0x107):load();break;case _0x387bd5(0xf0):run(_0x458ea5);break;case'reset':vision_inputs=image_size=null;}});