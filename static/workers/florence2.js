const a0_0x3b047b=a0_0x58b7;(function(_0x38fb81,_0x5c57fb){const _0x2b9564=a0_0x58b7,_0x22a2c4=_0x38fb81();while(!![]){try{const _0x6a6086=-parseInt(_0x2b9564(0x1bf))/0x1*(parseInt(_0x2b9564(0x1c0))/0x2)+parseInt(_0x2b9564(0x1b4))/0x3*(-parseInt(_0x2b9564(0x1ce))/0x4)+-parseInt(_0x2b9564(0x1ac))/0x5+parseInt(_0x2b9564(0x1b8))/0x6*(parseInt(_0x2b9564(0x1b0))/0x7)+parseInt(_0x2b9564(0x1b1))/0x8*(-parseInt(_0x2b9564(0x1cc))/0x9)+parseInt(_0x2b9564(0x1a7))/0xa+-parseInt(_0x2b9564(0x1a5))/0xb*(-parseInt(_0x2b9564(0x1d0))/0xc);if(_0x6a6086===_0x5c57fb)break;else _0x22a2c4['push'](_0x22a2c4['shift']());}catch(_0x47ce14){_0x22a2c4['push'](_0x22a2c4['shift']());}}}(a0_0x2733,0xc5d88));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x1d38dd=a0_0x58b7;try{return(await navigator[_0x1d38dd(0x1cf)][_0x1d38dd(0x1ba)]())[_0x1d38dd(0x1b6)][_0x1d38dd(0x1cb)](_0x1d38dd(0x1ab));}catch(_0x27271d){return!0x1;}}class Florence2Singleton{static [a0_0x3b047b(0x1ae)]=a0_0x3b047b(0x1a8);static async[a0_0x3b047b(0x1a6)](_0x1e7cff=null){const _0x223e29=a0_0x3b047b;return this['processor']??=AutoProcessor['from_pretrained'](this['model_id']),this[_0x223e29(0x1b7)]??=AutoTokenizer[_0x223e29(0x1c9)](this['model_id']),this['supports_fp16']??=await hasFp16(),this[_0x223e29(0x1b9)]??=Florence2ForConditionalGeneration[_0x223e29(0x1c9)](this[_0x223e29(0x1ae)],{'dtype':{'embed_tokens':this[_0x223e29(0x1af)]?_0x223e29(0x1c3):'fp32','vision_encoder':this['supports_fp16']?_0x223e29(0x1c3):_0x223e29(0x1bc),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x223e29(0x1c2),'progress_callback':_0x1e7cff}),Promise[_0x223e29(0x1c5)]([this[_0x223e29(0x1b9)],this['tokenizer'],this[_0x223e29(0x1c6)]]);}}async function load(){const _0x52698a=a0_0x3b047b;self['postMessage']({'status':_0x52698a(0x1b5),'data':_0x52698a(0x1bd)});const [_0x5ea076,_0x11d7e1,_0x13f9fe]=await Florence2Singleton[_0x52698a(0x1a6)](_0x8d10c9=>{self['postMessage'](_0x8d10c9);});self[_0x52698a(0x1be)]({'status':_0x52698a(0x1b5),'data':_0x52698a(0x1b2)});const _0x41fe49=_0x11d7e1('a'),_0x3fb53d=full([0x1,0x3,0x300,0x300],0x0);await _0x5ea076[_0x52698a(0x1b3)]({..._0x41fe49,'pixel_values':_0x3fb53d,'max_new_tokens':0x1}),self[_0x52698a(0x1be)]({'status':_0x52698a(0x1aa)});}function a0_0x58b7(_0x53116d,_0x4c766c){const _0x2733f7=a0_0x2733();return a0_0x58b7=function(_0x58b76d,_0x48f566){_0x58b76d=_0x58b76d-0x1a4;let _0x84bb4=_0x2733f7[_0x58b76d];return _0x84bb4;},a0_0x58b7(_0x53116d,_0x4c766c);}function a0_0x2733(){const _0x5025d4=['ready','shader-f16','4881385wQkLbj','now','model_id','supports_fp16','7ykXrHU','16JnpoDe','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','generate','2517xhdhIa','loading','features','tokenizer','4525134LmrtjD','model','requestAdapter','load','fp32','Loading\x20model...','postMessage','35519cAHMku','58AJOLvJ','reset','webgpu','fp16','run','all','processor','includes','size','from_pretrained','data','has','211959vdfQGe','addEventListener','4388LEhHje','gpu','144aFOuOq','<CAPTION_TO_PHRASE_GROUNDING>','2425071UOdQfE','getInstance','3844680ScJVjf','onnx-community/Florence-2-base-ft','fromURL'];a0_0x2733=function(){return _0x5025d4;};return a0_0x2733();}const TASKS_WITH_INPUTS=[a0_0x3b047b(0x1a4)];let vision_inputs,image_size;async function run({text:_0xf6aaa3,url:_0x2211cf,task:_0x36daae}){const _0x469ce2=a0_0x3b047b,[_0x5fa80d,_0x5944e4,_0x38ac45]=await Florence2Singleton[_0x469ce2(0x1a6)](),_0x29114f=performance[_0x469ce2(0x1ad)]();if(!vision_inputs){const _0x38dcf0=await RawImage[_0x469ce2(0x1a9)](_0x2211cf);image_size=_0x38dcf0[_0x469ce2(0x1c8)],vision_inputs=await _0x38ac45(_0x38dcf0);}let _0x4f9696=_0x36daae;TASKS_WITH_INPUTS[_0x469ce2(0x1c7)](_0x36daae)&&_0xf6aaa3&&(_0x4f9696+=_0xf6aaa3);const _0x529db2=_0x5944e4(_0x38ac45['construct_prompts'](_0x4f9696)),_0x4e078f=await _0x5fa80d['generate']({..._0x529db2,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x5360f6=_0x5944e4['batch_decode'](_0x4e078f,{'skip_special_tokens':!0x1})[0x0],_0x26723a=_0x38ac45['post_process_generation'](_0x5360f6,_0x36daae,image_size),_0x3fa774=performance[_0x469ce2(0x1ad)]();self[_0x469ce2(0x1be)]({'status':'complete','result':_0x26723a,'time':_0x3fa774-_0x29114f});}self[a0_0x3b047b(0x1cd)]('message',async _0x47c88e=>{const _0x1b2389=a0_0x3b047b,{type:_0x5b4394,data:_0x39f0e5}=_0x47c88e[_0x1b2389(0x1ca)];switch(_0x5b4394){case _0x1b2389(0x1bb):load();break;case _0x1b2389(0x1c4):run(_0x39f0e5);break;case _0x1b2389(0x1c1):vision_inputs=image_size=null;}});