const a0_0x3f3c85=a0_0x4e59;(function(_0xd0c8f4,_0xd9e4d9){const _0x6f43a=a0_0x4e59,_0x4cfd47=_0xd0c8f4();while(!![]){try{const _0x284a3b=-parseInt(_0x6f43a(0x159))/0x1+parseInt(_0x6f43a(0x171))/0x2*(-parseInt(_0x6f43a(0x15e))/0x3)+-parseInt(_0x6f43a(0x17b))/0x4*(parseInt(_0x6f43a(0x168))/0x5)+parseInt(_0x6f43a(0x156))/0x6*(parseInt(_0x6f43a(0x165))/0x7)+-parseInt(_0x6f43a(0x15d))/0x8*(parseInt(_0x6f43a(0x177))/0x9)+-parseInt(_0x6f43a(0x160))/0xa*(-parseInt(_0x6f43a(0x15f))/0xb)+parseInt(_0x6f43a(0x167))/0xc*(parseInt(_0x6f43a(0x17d))/0xd);if(_0x284a3b===_0xd9e4d9)break;else _0x4cfd47['push'](_0x4cfd47['shift']());}catch(_0x2d1c1f){_0x4cfd47['push'](_0x4cfd47['shift']());}}}(a0_0x3626,0x4ddac));function a0_0x4e59(_0x261ff7,_0x41a789){const _0x36269e=a0_0x3626();return a0_0x4e59=function(_0x4e5943,_0x1ddcfa){_0x4e5943=_0x4e5943-0x156;let _0x39a988=_0x36269e[_0x4e5943];return _0x39a988;},a0_0x4e59(_0x261ff7,_0x41a789);}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x3626(){const _0x6f6149=['247448nXqlyS','54651hsyWQy','89529IlFSee','510fFeEGr','requestAdapter','addEventListener','from_pretrained','shader-f16','799883EXURRt','model','12alrdcM','5MocdSy','webgpu','supports_fp16','generate','fp16','Loading\x20model...','run','message','includes','26rnRxYz','tokenizer','fp32','model_id','has','processor','18FCjwoo','postMessage','construct_prompts','post_process_generation','1607828tTJDlW','getInstance','7593638czHqYB','24QodSVA','gpu','all','436759YLGliO','ready','data','batch_decode'];a0_0x3626=function(){return _0x6f6149;};return a0_0x3626();}async function hasFp16(){const _0x24643e=a0_0x4e59;try{return(await navigator[_0x24643e(0x157)][_0x24643e(0x161)]())['features'][_0x24643e(0x175)](_0x24643e(0x164));}catch(_0x22ef3c){return!0x1;}}class Florence2Singleton{static [a0_0x3f3c85(0x174)]='onnx-community/Florence-2-base-ft';static async[a0_0x3f3c85(0x17c)](_0x4fbc1f=null){const _0x1a22b2=a0_0x3f3c85;return this[_0x1a22b2(0x176)]??=AutoProcessor[_0x1a22b2(0x163)](this[_0x1a22b2(0x174)]),this[_0x1a22b2(0x172)]??=AutoTokenizer[_0x1a22b2(0x163)](this[_0x1a22b2(0x174)]),this[_0x1a22b2(0x16a)]??=await hasFp16(),this[_0x1a22b2(0x166)]??=Florence2ForConditionalGeneration[_0x1a22b2(0x163)](this[_0x1a22b2(0x174)],{'dtype':{'embed_tokens':this[_0x1a22b2(0x16a)]?_0x1a22b2(0x16c):'fp32','vision_encoder':this[_0x1a22b2(0x16a)]?_0x1a22b2(0x16c):_0x1a22b2(0x173),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x1a22b2(0x169),'progress_callback':_0x4fbc1f}),Promise[_0x1a22b2(0x158)]([this['model'],this[_0x1a22b2(0x172)],this[_0x1a22b2(0x176)]]);}}async function load(){const _0x2dc1f8=a0_0x3f3c85;self['postMessage']({'status':'loading','data':_0x2dc1f8(0x16d)});const [_0x562a87,_0x1cf32e,_0x234a03]=await Florence2Singleton['getInstance'](_0x3b8260=>{self['postMessage'](_0x3b8260);});self[_0x2dc1f8(0x178)]({'status':'loading','data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x67a38f=_0x1cf32e('a'),_0xeb016f=full([0x1,0x3,0x300,0x300],0x0);await _0x562a87['generate']({..._0x67a38f,'pixel_values':_0xeb016f,'max_new_tokens':0x1}),self[_0x2dc1f8(0x178)]({'status':_0x2dc1f8(0x15a)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x4285fb,url:_0x3b1acb,task:_0x26b660}){const _0x315b12=a0_0x3f3c85,[_0x2fe5e4,_0x28dec2,_0x3314ea]=await Florence2Singleton['getInstance'](),_0x475ecc=performance['now']();if(!vision_inputs){const _0x15a245=await RawImage['fromURL'](_0x3b1acb);image_size=_0x15a245['size'],vision_inputs=await _0x3314ea(_0x15a245);}let _0x2baa21=_0x26b660;TASKS_WITH_INPUTS[_0x315b12(0x170)](_0x26b660)&&_0x4285fb&&(_0x2baa21+=_0x4285fb);const _0x53ac22=_0x28dec2(_0x3314ea[_0x315b12(0x179)](_0x2baa21)),_0x22ed2d=await _0x2fe5e4[_0x315b12(0x16b)]({..._0x53ac22,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x585003=_0x28dec2[_0x315b12(0x15c)](_0x22ed2d,{'skip_special_tokens':!0x1})[0x0],_0x217ecd=_0x3314ea[_0x315b12(0x17a)](_0x585003,_0x26b660,image_size),_0xe48b27=performance['now']();self[_0x315b12(0x178)]({'status':'complete','result':_0x217ecd,'time':_0xe48b27-_0x475ecc});}self[a0_0x3f3c85(0x162)](a0_0x3f3c85(0x16f),async _0x480b0e=>{const _0x19412c=a0_0x3f3c85,{type:_0xafd020,data:_0x44d2e0}=_0x480b0e[_0x19412c(0x15b)];switch(_0xafd020){case'load':load();break;case _0x19412c(0x16e):run(_0x44d2e0);break;case'reset':vision_inputs=image_size=null;}});