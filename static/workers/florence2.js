const a0_0x159ac3=a0_0x3e75;(function(_0x40494e,_0x2a1c0b){const _0xb590a7=a0_0x3e75,_0x3f5c33=_0x40494e();while(!![]){try{const _0x46156e=-parseInt(_0xb590a7(0x16b))/0x1+-parseInt(_0xb590a7(0x16a))/0x2*(parseInt(_0xb590a7(0x154))/0x3)+-parseInt(_0xb590a7(0x166))/0x4*(-parseInt(_0xb590a7(0x169))/0x5)+-parseInt(_0xb590a7(0x15b))/0x6+parseInt(_0xb590a7(0x171))/0x7*(parseInt(_0xb590a7(0x167))/0x8)+parseInt(_0xb590a7(0x16f))/0x9+-parseInt(_0xb590a7(0x160))/0xa*(-parseInt(_0xb590a7(0x16d))/0xb);if(_0x46156e===_0x2a1c0b)break;else _0x3f5c33['push'](_0x3f5c33['shift']());}catch(_0x1d6479){_0x3f5c33['push'](_0x3f5c33['shift']());}}}(a0_0x118e,0xa1737));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x51f7a8=a0_0x3e75;try{return(await navigator[_0x51f7a8(0x173)][_0x51f7a8(0x15d)]())[_0x51f7a8(0x155)]['has'](_0x51f7a8(0x15f));}catch(_0x5b38f6){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x159ac3(0x14d);static async['getInstance'](_0x4024fb=null){const _0x5f4eed=a0_0x159ac3;return this[_0x5f4eed(0x151)]??=AutoProcessor[_0x5f4eed(0x158)](this[_0x5f4eed(0x164)]),this[_0x5f4eed(0x168)]??=AutoTokenizer[_0x5f4eed(0x158)](this[_0x5f4eed(0x164)]),this[_0x5f4eed(0x15a)]??=await hasFp16(),this[_0x5f4eed(0x159)]??=Florence2ForConditionalGeneration[_0x5f4eed(0x158)](this[_0x5f4eed(0x164)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x5f4eed(0x16e):'fp32','vision_encoder':this[_0x5f4eed(0x15a)]?_0x5f4eed(0x16e):_0x5f4eed(0x150),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5f4eed(0x156),'progress_callback':_0x4024fb}),Promise[_0x5f4eed(0x16c)]([this[_0x5f4eed(0x159)],this[_0x5f4eed(0x168)],this[_0x5f4eed(0x151)]]);}}function a0_0x118e(){const _0x577604=['from_pretrained','model','supports_fp16','5263554toAQLA','size','requestAdapter','generate','shader-f16','40YsuAhj','batch_decode','<CAPTION_TO_PHRASE_GROUNDING>','post_process_generation','model_id','loading','4fozqIF','7610608BKumkH','tokenizer','5391110rKfWgH','3902tOJedk','1034233UKhcGa','all','1812569MYptMA','fp16','326781ZTzrYu','ready','7evXQSD','construct_prompts','gpu','data','load','getInstance','now','onnx-community/Florence-2-base-ft','includes','fromURL','fp32','processor','message','reset','234bfKdbZ','features','webgpu','postMessage'];a0_0x118e=function(){return _0x577604;};return a0_0x118e();}async function load(){const _0x561404=a0_0x159ac3;self[_0x561404(0x157)]({'status':_0x561404(0x165),'data':'Loading\x20model...'});const [_0x124f6f,_0x1bca31,_0x11a363]=await Florence2Singleton['getInstance'](_0x3714e7=>{const _0x20dcf7=_0x561404;self[_0x20dcf7(0x157)](_0x3714e7);});self[_0x561404(0x157)]({'status':_0x561404(0x165),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x2f1d7d=_0x1bca31('a'),_0x355fa2=full([0x1,0x3,0x300,0x300],0x0);await _0x124f6f[_0x561404(0x15e)]({..._0x2f1d7d,'pixel_values':_0x355fa2,'max_new_tokens':0x1}),self[_0x561404(0x157)]({'status':_0x561404(0x170)});}const TASKS_WITH_INPUTS=[a0_0x159ac3(0x162)];let vision_inputs,image_size;async function run({text:_0x5e0b2b,url:_0x10abae,task:_0x5358b2}){const _0x44d33c=a0_0x159ac3,[_0x3056f2,_0x179012,_0x52619e]=await Florence2Singleton[_0x44d33c(0x14b)](),_0x461487=performance[_0x44d33c(0x14c)]();if(!vision_inputs){const _0x24bea0=await RawImage[_0x44d33c(0x14f)](_0x10abae);image_size=_0x24bea0[_0x44d33c(0x15c)],vision_inputs=await _0x52619e(_0x24bea0);}let _0x4e5f46=_0x5358b2;TASKS_WITH_INPUTS[_0x44d33c(0x14e)](_0x5358b2)&&_0x5e0b2b&&(_0x4e5f46+=_0x5e0b2b);const _0x502dd8=_0x179012(_0x52619e[_0x44d33c(0x172)](_0x4e5f46)),_0x6ad36c=await _0x3056f2[_0x44d33c(0x15e)]({..._0x502dd8,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x52a7ed=_0x179012[_0x44d33c(0x161)](_0x6ad36c,{'skip_special_tokens':!0x1})[0x0],_0x286f86=_0x52619e[_0x44d33c(0x163)](_0x52a7ed,_0x5358b2,image_size),_0x207791=performance[_0x44d33c(0x14c)]();self[_0x44d33c(0x157)]({'status':'complete','result':_0x286f86,'time':_0x207791-_0x461487});}function a0_0x3e75(_0x5b66c5,_0x2c68dd){const _0x118ee2=a0_0x118e();return a0_0x3e75=function(_0x3e75dc,_0x55b3de){_0x3e75dc=_0x3e75dc-0x14b;let _0xdd5e8e=_0x118ee2[_0x3e75dc];return _0xdd5e8e;},a0_0x3e75(_0x5b66c5,_0x2c68dd);}self['addEventListener'](a0_0x159ac3(0x152),async _0x1559fe=>{const _0xe11fb7=a0_0x159ac3,{type:_0x2025c1,data:_0xed5c07}=_0x1559fe[_0xe11fb7(0x174)];switch(_0x2025c1){case _0xe11fb7(0x175):load();break;case'run':run(_0xed5c07);break;case _0xe11fb7(0x153):vision_inputs=image_size=null;}});