function a0_0x10a1(_0x5a82bb,_0x4eee9c){const _0x163d8a=a0_0x163d();return a0_0x10a1=function(_0x10a14b,_0x17fe5a){_0x10a14b=_0x10a14b-0x17e;let _0x1900d1=_0x163d8a[_0x10a14b];return _0x1900d1;},a0_0x10a1(_0x5a82bb,_0x4eee9c);}const a0_0x5d059a=a0_0x10a1;(function(_0x1c2584,_0x21ce3f){const _0x4c5630=a0_0x10a1,_0x4a1a24=_0x1c2584();while(!![]){try{const _0x483b2a=-parseInt(_0x4c5630(0x189))/0x1*(parseInt(_0x4c5630(0x188))/0x2)+parseInt(_0x4c5630(0x187))/0x3*(-parseInt(_0x4c5630(0x193))/0x4)+-parseInt(_0x4c5630(0x191))/0x5+-parseInt(_0x4c5630(0x18b))/0x6+parseInt(_0x4c5630(0x194))/0x7*(parseInt(_0x4c5630(0x181))/0x8)+parseInt(_0x4c5630(0x190))/0x9+parseInt(_0x4c5630(0x197))/0xa;if(_0x483b2a===_0x21ce3f)break;else _0x4a1a24['push'](_0x4a1a24['shift']());}catch(_0x4c6458){_0x4a1a24['push'](_0x4a1a24['shift']());}}}(a0_0x163d,0xbbe3d));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x163d(){const _0x3b27e9=['1152NcLANZ','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','construct_prompts','reset','gpu','post_process_generation','685239zShsoR','95878zRnFGM','14oYGGEd','all','2061582JOskIU','now','model_id','from_pretrained','webgpu','7721910LaRwua','4946165huXhng','message','4DySVWa','54187uuhAbI','includes','fp16','10292920xzqPTE','generate','batch_decode','processor','postMessage','has','model','fromURL','loading','shader-f16','data','ready','fp32','supports_fp16','getInstance','features'];a0_0x163d=function(){return _0x3b27e9;};return a0_0x163d();}async function hasFp16(){const _0x51115a=a0_0x10a1;try{return(await navigator[_0x51115a(0x185)]['requestAdapter']())[_0x51115a(0x180)][_0x51115a(0x19c)](_0x51115a(0x1a0));}catch(_0x34425f){return!0x1;}}class Florence2Singleton{static [a0_0x5d059a(0x18d)]='onnx-community/Florence-2-base-ft';static async[a0_0x5d059a(0x17f)](_0x228e43=null){const _0x44bf8b=a0_0x5d059a;return this[_0x44bf8b(0x19a)]??=AutoProcessor[_0x44bf8b(0x18e)](this[_0x44bf8b(0x18d)]),this['tokenizer']??=AutoTokenizer[_0x44bf8b(0x18e)](this[_0x44bf8b(0x18d)]),this['supports_fp16']??=await hasFp16(),this[_0x44bf8b(0x19d)]??=Florence2ForConditionalGeneration[_0x44bf8b(0x18e)](this[_0x44bf8b(0x18d)],{'dtype':{'embed_tokens':this[_0x44bf8b(0x17e)]?_0x44bf8b(0x196):'fp32','vision_encoder':this[_0x44bf8b(0x17e)]?_0x44bf8b(0x196):_0x44bf8b(0x1a3),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x44bf8b(0x18f),'progress_callback':_0x228e43}),Promise[_0x44bf8b(0x18a)]([this[_0x44bf8b(0x19d)],this['tokenizer'],this[_0x44bf8b(0x19a)]]);}}async function load(){const _0x1dd3a1=a0_0x5d059a;self[_0x1dd3a1(0x19b)]({'status':_0x1dd3a1(0x19f),'data':'Loading\x20model...'});const [_0x173f34,_0x50aae8,_0x221842]=await Florence2Singleton[_0x1dd3a1(0x17f)](_0x33652a=>{self['postMessage'](_0x33652a);});self['postMessage']({'status':_0x1dd3a1(0x19f),'data':_0x1dd3a1(0x182)});const _0x5f3a1d=_0x50aae8('a'),_0xc33fad=full([0x1,0x3,0x300,0x300],0x0);await _0x173f34[_0x1dd3a1(0x198)]({..._0x5f3a1d,'pixel_values':_0xc33fad,'max_new_tokens':0x1}),self[_0x1dd3a1(0x19b)]({'status':_0x1dd3a1(0x1a2)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x49454f,url:_0x407371,task:_0x375538}){const _0x59953e=a0_0x5d059a,[_0x1b025d,_0x14f98b,_0x594601]=await Florence2Singleton[_0x59953e(0x17f)](),_0x5cb0c3=performance[_0x59953e(0x18c)]();if(!vision_inputs){const _0x4b8dac=await RawImage[_0x59953e(0x19e)](_0x407371);image_size=_0x4b8dac['size'],vision_inputs=await _0x594601(_0x4b8dac);}let _0x2a710f=_0x375538;TASKS_WITH_INPUTS[_0x59953e(0x195)](_0x375538)&&_0x49454f&&(_0x2a710f+=_0x49454f);const _0x56b2bc=_0x14f98b(_0x594601[_0x59953e(0x183)](_0x2a710f)),_0x4020bf=await _0x1b025d[_0x59953e(0x198)]({..._0x56b2bc,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x54072a=_0x14f98b[_0x59953e(0x199)](_0x4020bf,{'skip_special_tokens':!0x1})[0x0],_0x5e357b=_0x594601[_0x59953e(0x186)](_0x54072a,_0x375538,image_size),_0x1980e1=performance[_0x59953e(0x18c)]();self[_0x59953e(0x19b)]({'status':'complete','result':_0x5e357b,'time':_0x1980e1-_0x5cb0c3});}self['addEventListener'](a0_0x5d059a(0x192),async _0x40e9ef=>{const _0x1f73a5=a0_0x5d059a,{type:_0x5ad3a9,data:_0x122cf3}=_0x40e9ef[_0x1f73a5(0x1a1)];switch(_0x5ad3a9){case'load':load();break;case'run':run(_0x122cf3);break;case _0x1f73a5(0x184):vision_inputs=image_size=null;}});