const a0_0x2f655a=a0_0x2f1b;(function(_0x49c660,_0xe191b4){const _0xa38b3f=a0_0x2f1b,_0x38ff12=_0x49c660();while(!![]){try{const _0x33fa5c=parseInt(_0xa38b3f(0xc3))/0x1*(parseInt(_0xa38b3f(0xa6))/0x2)+-parseInt(_0xa38b3f(0xb3))/0x3+-parseInt(_0xa38b3f(0xbc))/0x4*(-parseInt(_0xa38b3f(0xb5))/0x5)+parseInt(_0xa38b3f(0xb6))/0x6*(-parseInt(_0xa38b3f(0xc4))/0x7)+parseInt(_0xa38b3f(0xb1))/0x8+-parseInt(_0xa38b3f(0xaa))/0x9*(parseInt(_0xa38b3f(0xcf))/0xa)+parseInt(_0xa38b3f(0xb7))/0xb;if(_0x33fa5c===_0xe191b4)break;else _0x38ff12['push'](_0x38ff12['shift']());}catch(_0x3fc407){_0x38ff12['push'](_0x38ff12['shift']());}}}(a0_0x42f6,0xc508c));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x2cf961=a0_0x2f1b;try{return(await navigator['gpu'][_0x2cf961(0xb0)]())[_0x2cf961(0xce)][_0x2cf961(0xc2)]('shader-f16');}catch(_0x22c1de){return!0x1;}}class Florence2Singleton{static [a0_0x2f655a(0xc6)]=a0_0x2f655a(0xa7);static async[a0_0x2f655a(0xac)](_0x1ffd0d=null){const _0x240637=a0_0x2f655a;return this[_0x240637(0xbd)]??=AutoProcessor[_0x240637(0xc7)](this[_0x240637(0xc6)]),this[_0x240637(0xd1)]??=AutoTokenizer['from_pretrained'](this['model_id']),this[_0x240637(0xca)]??=await hasFp16(),this[_0x240637(0xaf)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x240637(0xc6)],{'dtype':{'embed_tokens':this[_0x240637(0xca)]?_0x240637(0xbf):_0x240637(0xb8),'vision_encoder':this[_0x240637(0xca)]?_0x240637(0xbf):_0x240637(0xb8),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x240637(0xc5),'progress_callback':_0x1ffd0d}),Promise['all']([this[_0x240637(0xaf)],this[_0x240637(0xd1)],this[_0x240637(0xbd)]]);}}function a0_0x42f6(){const _0x39fd71=['1206927DcLmdr','now','5HoMBhy','6kUvLsU','9015578ubvmUf','fp32','batch_decode','construct_prompts','load','2249924gXivzu','processor','generate','fp16','<CAPTION_TO_PHRASE_GROUNDING>','ready','has','256095ZyBrze','10583118LHGoeQ','webgpu','model_id','from_pretrained','fromURL','data','supports_fp16','loading','complete','run','features','830clswWi','post_process_generation','tokenizer','10Glneik','onnx-community/Florence-2-base-ft','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','reset','120411ZEDBgA','size','getInstance','Loading\x20model...','addEventListener','model','requestAdapter','9353104MffKcC','postMessage'];a0_0x42f6=function(){return _0x39fd71;};return a0_0x42f6();}async function load(){const _0x203020=a0_0x2f655a;self[_0x203020(0xb2)]({'status':_0x203020(0xcb),'data':_0x203020(0xad)});const [_0x5a7884,_0x451308,_0x3fedfc]=await Florence2Singleton[_0x203020(0xac)](_0x44e4bd=>{const _0xd00632=_0x203020;self[_0xd00632(0xb2)](_0x44e4bd);});self['postMessage']({'status':_0x203020(0xcb),'data':_0x203020(0xa8)});const _0x2362ed=_0x451308('a'),_0x54fc15=full([0x1,0x3,0x300,0x300],0x0);await _0x5a7884[_0x203020(0xbe)]({..._0x2362ed,'pixel_values':_0x54fc15,'max_new_tokens':0x1}),self[_0x203020(0xb2)]({'status':_0x203020(0xc1)});}const TASKS_WITH_INPUTS=[a0_0x2f655a(0xc0)];let vision_inputs,image_size;async function run({text:_0x58c7e4,url:_0xc75166,task:_0x1bfe53}){const _0x4cbbaf=a0_0x2f655a,[_0x1b21c4,_0x73a850,_0x3ec577]=await Florence2Singleton[_0x4cbbaf(0xac)](),_0x249126=performance[_0x4cbbaf(0xb4)]();if(!vision_inputs){const _0x15af4c=await RawImage[_0x4cbbaf(0xc8)](_0xc75166);image_size=_0x15af4c[_0x4cbbaf(0xab)],vision_inputs=await _0x3ec577(_0x15af4c);}let _0x5ce4d8=_0x1bfe53;TASKS_WITH_INPUTS['includes'](_0x1bfe53)&&_0x58c7e4&&(_0x5ce4d8+=_0x58c7e4);const _0x49437e=_0x73a850(_0x3ec577[_0x4cbbaf(0xba)](_0x5ce4d8)),_0x211796=await _0x1b21c4[_0x4cbbaf(0xbe)]({..._0x49437e,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x46c651=_0x73a850[_0x4cbbaf(0xb9)](_0x211796,{'skip_special_tokens':!0x1})[0x0],_0x51ab41=_0x3ec577[_0x4cbbaf(0xd0)](_0x46c651,_0x1bfe53,image_size),_0x3ddc22=performance[_0x4cbbaf(0xb4)]();self[_0x4cbbaf(0xb2)]({'status':_0x4cbbaf(0xcc),'result':_0x51ab41,'time':_0x3ddc22-_0x249126});}function a0_0x2f1b(_0xe20cc0,_0x12c2ef){const _0x42f646=a0_0x42f6();return a0_0x2f1b=function(_0x2f1bf7,_0x4fdafb){_0x2f1bf7=_0x2f1bf7-0xa6;let _0x45f195=_0x42f646[_0x2f1bf7];return _0x45f195;},a0_0x2f1b(_0xe20cc0,_0x12c2ef);}self[a0_0x2f655a(0xae)]('message',async _0x5c29ed=>{const _0x4e38fa=a0_0x2f655a,{type:_0x3154a1,data:_0x43b40e}=_0x5c29ed[_0x4e38fa(0xc9)];switch(_0x3154a1){case _0x4e38fa(0xbb):load();break;case _0x4e38fa(0xcd):run(_0x43b40e);break;case _0x4e38fa(0xa9):vision_inputs=image_size=null;}});