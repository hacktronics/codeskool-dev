function a0_0x5369(){const _0x57f5ae=['<CAPTION_TO_PHRASE_GROUNDING>','model_id','2685940uOrsyC','postMessage','onnx-community/Florence-2-base-ft','1230213MkantH','webgpu','5437752wAmIUQ','size','6545392AlJWXA','reset','from_pretrained','features','470376CLlhOd','load','processor','getInstance','supports_fp16','gpu','10wThqtk','model','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','50srfFcm','all','message','ready','fp16','1821276BSPHli','data','fp32','addEventListener','72LsaGlq','generate','run','tokenizer','44782VNtPxu','requestAdapter','fromURL','loading','shader-f16','complete'];a0_0x5369=function(){return _0x57f5ae;};return a0_0x5369();}const a0_0x3aa98f=a0_0x4837;(function(_0x24e7c3,_0x441610){const _0x1371f7=a0_0x4837,_0x39ee8f=_0x24e7c3();while(!![]){try{const _0x421322=parseInt(_0x1371f7(0xb9))/0x1+parseInt(_0x1371f7(0xd7))/0x2*(-parseInt(_0x1371f7(0xd3))/0x3)+-parseInt(_0x1371f7(0xb6))/0x4+parseInt(_0x1371f7(0xc7))/0x5*(parseInt(_0x1371f7(0xcf))/0x6)+parseInt(_0x1371f7(0xbd))/0x7+-parseInt(_0x1371f7(0xbb))/0x8+parseInt(_0x1371f7(0xc1))/0x9*(-parseInt(_0x1371f7(0xca))/0xa);if(_0x421322===_0x441610)break;else _0x39ee8f['push'](_0x39ee8f['shift']());}catch(_0x18058a){_0x39ee8f['push'](_0x39ee8f['shift']());}}}(a0_0x5369,0x97f75));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x52d210=a0_0x4837;try{return(await navigator[_0x52d210(0xc6)][_0x52d210(0xd8)]())[_0x52d210(0xc0)]['has'](_0x52d210(0xb2));}catch(_0x19637f){return!0x1;}}function a0_0x4837(_0x21b7f1,_0x3ab9af){const _0x536921=a0_0x5369();return a0_0x4837=function(_0x4837c9,_0x48339f){_0x4837c9=_0x4837c9-0xb2;let _0x3a39ac=_0x536921[_0x4837c9];return _0x3a39ac;},a0_0x4837(_0x21b7f1,_0x3ab9af);}class Florence2Singleton{static ['model_id']=a0_0x3aa98f(0xb8);static async[a0_0x3aa98f(0xc4)](_0x557113=null){const _0x4f717a=a0_0x3aa98f;return this['processor']??=AutoProcessor[_0x4f717a(0xbf)](this[_0x4f717a(0xb5)]),this[_0x4f717a(0xd6)]??=AutoTokenizer['from_pretrained'](this[_0x4f717a(0xb5)]),this[_0x4f717a(0xc5)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x4f717a(0xbf)](this[_0x4f717a(0xb5)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x4f717a(0xce):_0x4f717a(0xd1),'vision_encoder':this[_0x4f717a(0xc5)]?_0x4f717a(0xce):_0x4f717a(0xd1),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x4f717a(0xba),'progress_callback':_0x557113}),Promise[_0x4f717a(0xcb)]([this[_0x4f717a(0xc8)],this[_0x4f717a(0xd6)],this[_0x4f717a(0xc3)]]);}}async function load(){const _0x373045=a0_0x3aa98f;self[_0x373045(0xb7)]({'status':_0x373045(0xda),'data':'Loading\x20model...'});const [_0x3ffb8c,_0x39511c,_0xc39bf9]=await Florence2Singleton['getInstance'](_0x13a3a6=>{const _0x2a1ae3=_0x373045;self[_0x2a1ae3(0xb7)](_0x13a3a6);});self[_0x373045(0xb7)]({'status':_0x373045(0xda),'data':_0x373045(0xc9)});const _0x74e9b6=_0x39511c('a'),_0x2bbb22=full([0x1,0x3,0x300,0x300],0x0);await _0x3ffb8c[_0x373045(0xd4)]({..._0x74e9b6,'pixel_values':_0x2bbb22,'max_new_tokens':0x1}),self[_0x373045(0xb7)]({'status':_0x373045(0xcd)});}const TASKS_WITH_INPUTS=[a0_0x3aa98f(0xb4)];let vision_inputs,image_size;async function run({text:_0x3708d1,url:_0x305200,task:_0x1a11a4}){const _0xf69b39=a0_0x3aa98f,[_0x13fe28,_0x238fd7,_0x29d350]=await Florence2Singleton[_0xf69b39(0xc4)](),_0x36b304=performance['now']();if(!vision_inputs){const _0x208b54=await RawImage[_0xf69b39(0xd9)](_0x305200);image_size=_0x208b54[_0xf69b39(0xbc)],vision_inputs=await _0x29d350(_0x208b54);}let _0x496da9=_0x1a11a4;TASKS_WITH_INPUTS['includes'](_0x1a11a4)&&_0x3708d1&&(_0x496da9+=_0x3708d1);const _0x3c9f90=_0x238fd7(_0x29d350['construct_prompts'](_0x496da9)),_0x18a00b=await _0x13fe28[_0xf69b39(0xd4)]({..._0x3c9f90,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x419d24=_0x238fd7['batch_decode'](_0x18a00b,{'skip_special_tokens':!0x1})[0x0],_0x25656c=_0x29d350['post_process_generation'](_0x419d24,_0x1a11a4,image_size),_0x1ab863=performance['now']();self['postMessage']({'status':_0xf69b39(0xb3),'result':_0x25656c,'time':_0x1ab863-_0x36b304});}self[a0_0x3aa98f(0xd2)](a0_0x3aa98f(0xcc),async _0x3881bb=>{const _0x2600a3=a0_0x3aa98f,{type:_0x3e38f8,data:_0x350089}=_0x3881bb[_0x2600a3(0xd0)];switch(_0x3e38f8){case _0x2600a3(0xc2):load();break;case _0x2600a3(0xd5):run(_0x350089);break;case _0x2600a3(0xbe):vision_inputs=image_size=null;}});