const a0_0x238bd1=a0_0x48ea;(function(_0x3aac4a,_0x299380){const _0x9f25df=a0_0x48ea,_0x2f3675=_0x3aac4a();while(!![]){try{const _0x5638c3=-parseInt(_0x9f25df(0x208))/0x1*(-parseInt(_0x9f25df(0x1fb))/0x2)+parseInt(_0x9f25df(0x1e9))/0x3+parseInt(_0x9f25df(0x1eb))/0x4+-parseInt(_0x9f25df(0x1f8))/0x5+-parseInt(_0x9f25df(0x202))/0x6+-parseInt(_0x9f25df(0x1f9))/0x7*(parseInt(_0x9f25df(0x1f4))/0x8)+parseInt(_0x9f25df(0x1ff))/0x9;if(_0x5638c3===_0x299380)break;else _0x2f3675['push'](_0x2f3675['shift']());}catch(_0x52c101){_0x2f3675['push'](_0x2f3675['shift']());}}}(a0_0x4fc2,0x86b4b));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3/dist/transformers.min.js';async function hasFp16(){const _0x56b495=a0_0x48ea;try{return(await navigator[_0x56b495(0x1ee)]['requestAdapter']())[_0x56b495(0x1fd)][_0x56b495(0x1fe)]('shader-f16');}catch(_0x4e180e){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x238bd1(0x1f5);static async['getInstance'](_0x2d0343=null){const _0x174a11=a0_0x238bd1;return this[_0x174a11(0x1f3)]??=AutoProcessor[_0x174a11(0x207)](this[_0x174a11(0x1ec)]),this[_0x174a11(0x1ef)]??=AutoTokenizer[_0x174a11(0x207)](this['model_id']),this['supports_fp16']??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x174a11(0x207)](this[_0x174a11(0x1ec)],{'dtype':{'embed_tokens':this[_0x174a11(0x1ea)]?'fp16':_0x174a11(0x1f0),'vision_encoder':this[_0x174a11(0x1ea)]?_0x174a11(0x1ed):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x2d0343}),Promise[_0x174a11(0x1f7)]([this['model'],this[_0x174a11(0x1ef)],this[_0x174a11(0x1f3)]]);}}async function load(){const _0x28c5ea=a0_0x238bd1;self[_0x28c5ea(0x20b)]({'status':'loading','data':'Loading\x20model...'});const [_0x371208,_0x5cbf8a,_0x17cd12]=await Florence2Singleton[_0x28c5ea(0x205)](_0x31b629=>{self['postMessage'](_0x31b629);});self[_0x28c5ea(0x20b)]({'status':_0x28c5ea(0x1f1),'data':_0x28c5ea(0x20a)});const _0x44ed88=_0x5cbf8a('a'),_0x4d878c=full([0x1,0x3,0x300,0x300],0x0);await _0x371208['generate']({..._0x44ed88,'pixel_values':_0x4d878c,'max_new_tokens':0x1}),self[_0x28c5ea(0x20b)]({'status':_0x28c5ea(0x1fc)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];function a0_0x4fc2(){const _0x22c6d7=['ready','features','has','1686888JQihAl','post_process_generation','now','3422064pjZRaP','construct_prompts','data','getInstance','reset','from_pretrained','7393JfXISx','includes','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','postMessage','340278TqIAxz','supports_fp16','3929860giTiQO','model_id','fp16','gpu','tokenizer','fp32','loading','load','processor','5064KEoohb','onnx-community/Florence-2-base-ft','addEventListener','all','4410955BIWIUR','448wvMgOB','complete','206kKwXoF'];a0_0x4fc2=function(){return _0x22c6d7;};return a0_0x4fc2();}let vision_inputs,image_size;function a0_0x48ea(_0x1da918,_0x1e5c02){const _0x4fc2d8=a0_0x4fc2();return a0_0x48ea=function(_0x48ea2b,_0x326680){_0x48ea2b=_0x48ea2b-0x1e9;let _0x4cf3b8=_0x4fc2d8[_0x48ea2b];return _0x4cf3b8;},a0_0x48ea(_0x1da918,_0x1e5c02);}async function run({text:_0x3f7eeb,url:_0x4d5cb3,task:_0x52d80d}){const _0x395e08=a0_0x238bd1,[_0x227f48,_0x557a2c,_0x173774]=await Florence2Singleton['getInstance'](),_0x114194=performance['now']();if(!vision_inputs){const _0x34bf1c=await RawImage['fromURL'](_0x4d5cb3);image_size=_0x34bf1c['size'],vision_inputs=await _0x173774(_0x34bf1c);}let _0xb79c8=_0x52d80d;TASKS_WITH_INPUTS[_0x395e08(0x209)](_0x52d80d)&&_0x3f7eeb&&(_0xb79c8+=_0x3f7eeb);const _0x5c4a75=_0x557a2c(_0x173774[_0x395e08(0x203)](_0xb79c8)),_0x122597=await _0x227f48['generate']({..._0x5c4a75,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x22e193=_0x557a2c['batch_decode'](_0x122597,{'skip_special_tokens':!0x1})[0x0],_0x7be5cc=_0x173774[_0x395e08(0x200)](_0x22e193,_0x52d80d,image_size),_0x4f6b80=performance[_0x395e08(0x201)]();self[_0x395e08(0x20b)]({'status':_0x395e08(0x1fa),'result':_0x7be5cc,'time':_0x4f6b80-_0x114194});}self[a0_0x238bd1(0x1f6)]('message',async _0x15153f=>{const _0x1d4cfb=a0_0x238bd1,{type:_0x420292,data:_0xa87c4}=_0x15153f[_0x1d4cfb(0x204)];switch(_0x420292){case _0x1d4cfb(0x1f2):load();break;case'run':run(_0xa87c4);break;case _0x1d4cfb(0x206):vision_inputs=image_size=null;}});