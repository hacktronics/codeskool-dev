const a0_0x39e37e=a0_0x3de2;(function(_0x5f1b66,_0x3d36dc){const _0x6e2303=a0_0x3de2,_0x14f248=_0x5f1b66();while(!![]){try{const _0x2a599f=-parseInt(_0x6e2303(0x187))/0x1*(parseInt(_0x6e2303(0x192))/0x2)+parseInt(_0x6e2303(0x185))/0x3*(-parseInt(_0x6e2303(0x16c))/0x4)+parseInt(_0x6e2303(0x195))/0x5*(-parseInt(_0x6e2303(0x189))/0x6)+parseInt(_0x6e2303(0x16d))/0x7*(-parseInt(_0x6e2303(0x17c))/0x8)+-parseInt(_0x6e2303(0x16f))/0x9*(parseInt(_0x6e2303(0x17b))/0xa)+-parseInt(_0x6e2303(0x176))/0xb+parseInt(_0x6e2303(0x190))/0xc*(parseInt(_0x6e2303(0x171))/0xd);if(_0x2a599f===_0x3d36dc)break;else _0x14f248['push'](_0x14f248['shift']());}catch(_0xc51738){_0x14f248['push'](_0x14f248['shift']());}}}(a0_0xf586,0x1f5a6));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x2d48a6=a0_0x3de2;try{return(await navigator['gpu']['requestAdapter']())[_0x2d48a6(0x193)][_0x2d48a6(0x18a)](_0x2d48a6(0x172));}catch(_0x42ece8){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x39e37e(0x17f);static async[a0_0x39e37e(0x18d)](_0x3a249a=null){const _0x5134ec=a0_0x39e37e;return this[_0x5134ec(0x16b)]??=AutoProcessor[_0x5134ec(0x169)](this['model_id']),this[_0x5134ec(0x18f)]??=AutoTokenizer[_0x5134ec(0x169)](this[_0x5134ec(0x17d)]),this[_0x5134ec(0x174)]??=await hasFp16(),this[_0x5134ec(0x17e)]??=Florence2ForConditionalGeneration[_0x5134ec(0x169)](this[_0x5134ec(0x17d)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x5134ec(0x179):'fp32','vision_encoder':this[_0x5134ec(0x174)]?_0x5134ec(0x179):_0x5134ec(0x186),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5134ec(0x182),'progress_callback':_0x3a249a}),Promise[_0x5134ec(0x170)]([this[_0x5134ec(0x17e)],this[_0x5134ec(0x18f)],this[_0x5134ec(0x16b)]]);}}async function load(){const _0x340208=a0_0x39e37e;self[_0x340208(0x180)]({'status':_0x340208(0x184),'data':_0x340208(0x181)});const [_0x3e6713,_0x307486,_0x1b1cf1]=await Florence2Singleton[_0x340208(0x18d)](_0x1caf0d=>{const _0x5b65da=_0x340208;self[_0x5b65da(0x180)](_0x1caf0d);});self[_0x340208(0x180)]({'status':_0x340208(0x184),'data':_0x340208(0x17a)});const _0x58892b=_0x307486('a'),_0x42f1c2=full([0x1,0x3,0x300,0x300],0x0);await _0x3e6713[_0x340208(0x191)]({..._0x58892b,'pixel_values':_0x42f1c2,'max_new_tokens':0x1}),self[_0x340208(0x180)]({'status':_0x340208(0x194)});}function a0_0xf586(){const _0x245072=['tokenizer','12QKZdgv','generate','4194HacLQY','features','ready','119540qUFvzN','from_pretrained','now','processor','4AKSCJa','876589EHFiXL','complete','935622jwKokW','all','12494651HFAxhI','shader-f16','batch_decode','supports_fp16','size','463265aMWRFv','message','reset','fp16','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','20LbKcWs','16sZFexw','model_id','model','onnx-community/Florence-2-base-ft','postMessage','Loading\x20model...','webgpu','includes','loading','319689chIzSZ','fp32','5wrJMnd','post_process_generation','54AyRsIY','has','data','run','getInstance','<CAPTION_TO_PHRASE_GROUNDING>'];a0_0xf586=function(){return _0x245072;};return a0_0xf586();}const TASKS_WITH_INPUTS=[a0_0x39e37e(0x18e)];function a0_0x3de2(_0x546d8d,_0x1c193a){const _0xf586b6=a0_0xf586();return a0_0x3de2=function(_0x3de207,_0x2934ed){_0x3de207=_0x3de207-0x169;let _0xed3c79=_0xf586b6[_0x3de207];return _0xed3c79;},a0_0x3de2(_0x546d8d,_0x1c193a);}let vision_inputs,image_size;async function run({text:_0x1ec254,url:_0x374b5c,task:_0x28c4c5}){const _0x37996a=a0_0x39e37e,[_0x58afce,_0x4bb895,_0x232fcc]=await Florence2Singleton[_0x37996a(0x18d)](),_0x3963d2=performance[_0x37996a(0x16a)]();if(!vision_inputs){const _0x9b056=await RawImage['fromURL'](_0x374b5c);image_size=_0x9b056[_0x37996a(0x175)],vision_inputs=await _0x232fcc(_0x9b056);}let _0x3b8a2b=_0x28c4c5;TASKS_WITH_INPUTS[_0x37996a(0x183)](_0x28c4c5)&&_0x1ec254&&(_0x3b8a2b+=_0x1ec254);const _0x1c91fd=_0x4bb895(_0x232fcc['construct_prompts'](_0x3b8a2b)),_0x53e920=await _0x58afce['generate']({..._0x1c91fd,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1d1d76=_0x4bb895[_0x37996a(0x173)](_0x53e920,{'skip_special_tokens':!0x1})[0x0],_0x269c64=_0x232fcc[_0x37996a(0x188)](_0x1d1d76,_0x28c4c5,image_size),_0x9dcb6b=performance['now']();self[_0x37996a(0x180)]({'status':_0x37996a(0x16e),'result':_0x269c64,'time':_0x9dcb6b-_0x3963d2});}self['addEventListener'](a0_0x39e37e(0x177),async _0x111eaa=>{const _0x44b4d2=a0_0x39e37e,{type:_0x4cd26d,data:_0x585377}=_0x111eaa[_0x44b4d2(0x18b)];switch(_0x4cd26d){case'load':load();break;case _0x44b4d2(0x18c):run(_0x585377);break;case _0x44b4d2(0x178):vision_inputs=image_size=null;}});