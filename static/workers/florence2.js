const a0_0x3ad55d=a0_0x3711;(function(_0x12b631,_0x322802){const _0x5afcd6=a0_0x3711,_0x9c5c95=_0x12b631();while(!![]){try{const _0x469101=-parseInt(_0x5afcd6(0x1e3))/0x1*(parseInt(_0x5afcd6(0x1f7))/0x2)+parseInt(_0x5afcd6(0x1f6))/0x3+-parseInt(_0x5afcd6(0x1f3))/0x4*(-parseInt(_0x5afcd6(0x1e5))/0x5)+parseInt(_0x5afcd6(0x1f1))/0x6*(parseInt(_0x5afcd6(0x1eb))/0x7)+parseInt(_0x5afcd6(0x1df))/0x8+-parseInt(_0x5afcd6(0x1e9))/0x9*(parseInt(_0x5afcd6(0x1f5))/0xa)+-parseInt(_0x5afcd6(0x1ed))/0xb*(parseInt(_0x5afcd6(0x1e8))/0xc);if(_0x469101===_0x322802)break;else _0x9c5c95['push'](_0x9c5c95['shift']());}catch(_0x6bf0dc){_0x9c5c95['push'](_0x9c5c95['shift']());}}}(a0_0x512e,0xe0f24));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x3711(_0x961465,_0x33ced3){const _0x512eab=a0_0x512e();return a0_0x3711=function(_0x371156,_0xf7d4b6){_0x371156=_0x371156-0x1d3;let _0x2b1e01=_0x512eab[_0x371156];return _0x2b1e01;},a0_0x3711(_0x961465,_0x33ced3);}async function hasFp16(){const _0x2f2060=a0_0x3711;try{return(await navigator['gpu']['requestAdapter']())['features']['has'](_0x2f2060(0x1dc));}catch(_0x2a363e){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x3ad55d(0x1e0);static async[a0_0x3ad55d(0x1d7)](_0x4ce23c=null){const _0x52287f=a0_0x3ad55d;return this[_0x52287f(0x1ef)]??=AutoProcessor[_0x52287f(0x1ec)](this[_0x52287f(0x1f4)]),this[_0x52287f(0x1ee)]??=AutoTokenizer[_0x52287f(0x1ec)](this[_0x52287f(0x1f4)]),this['supports_fp16']??=await hasFp16(),this[_0x52287f(0x1fa)]??=Florence2ForConditionalGeneration[_0x52287f(0x1ec)](this['model_id'],{'dtype':{'embed_tokens':this[_0x52287f(0x1d9)]?_0x52287f(0x1f0):'fp32','vision_encoder':this[_0x52287f(0x1d9)]?_0x52287f(0x1f0):_0x52287f(0x1db),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x52287f(0x1e7),'progress_callback':_0x4ce23c}),Promise[_0x52287f(0x1ea)]([this[_0x52287f(0x1fa)],this[_0x52287f(0x1ee)],this[_0x52287f(0x1ef)]]);}}async function load(){const _0x4ba22c=a0_0x3ad55d;self[_0x4ba22c(0x1d5)]({'status':_0x4ba22c(0x1f9),'data':_0x4ba22c(0x1d4)});const [_0x2ba2ad,_0x4e1be3,_0x23ca21]=await Florence2Singleton[_0x4ba22c(0x1d7)](_0x5048ec=>{const _0x452f5e=_0x4ba22c;self[_0x452f5e(0x1d5)](_0x5048ec);});self[_0x4ba22c(0x1d5)]({'status':_0x4ba22c(0x1f9),'data':_0x4ba22c(0x1da)});const _0x47a218=_0x4e1be3('a'),_0x436096=full([0x1,0x3,0x300,0x300],0x0);await _0x2ba2ad[_0x4ba22c(0x1dd)]({..._0x47a218,'pixel_values':_0x436096,'max_new_tokens':0x1}),self[_0x4ba22c(0x1d5)]({'status':_0x4ba22c(0x1e2)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x3ed4c3,url:_0x547eca,task:_0x17edad}){const _0x42a9bd=a0_0x3ad55d,[_0x14de58,_0x3096ae,_0x46704a]=await Florence2Singleton[_0x42a9bd(0x1d7)](),_0x5aab00=performance[_0x42a9bd(0x1e6)]();if(!vision_inputs){const _0x286650=await RawImage[_0x42a9bd(0x1f8)](_0x547eca);image_size=_0x286650['size'],vision_inputs=await _0x46704a(_0x286650);}let _0x4ff9d1=_0x17edad;TASKS_WITH_INPUTS[_0x42a9bd(0x1e1)](_0x17edad)&&_0x3ed4c3&&(_0x4ff9d1+=_0x3ed4c3);const _0x37f4dd=_0x3096ae(_0x46704a[_0x42a9bd(0x1d6)](_0x4ff9d1)),_0x351015=await _0x14de58['generate']({..._0x37f4dd,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x322ab5=_0x3096ae[_0x42a9bd(0x1d3)](_0x351015,{'skip_special_tokens':!0x1})[0x0],_0x57a4e0=_0x46704a[_0x42a9bd(0x1d8)](_0x322ab5,_0x17edad,image_size),_0x474709=performance[_0x42a9bd(0x1e6)]();self['postMessage']({'status':_0x42a9bd(0x1de),'result':_0x57a4e0,'time':_0x474709-_0x5aab00});}function a0_0x512e(){const _0x264f3c=['webgpu','3966756SufMFn','13097187FyynDb','all','7QqakMm','from_pretrained','11bTtCNy','tokenizer','processor','fp16','4057758bIARRp','message','210884rqcoep','model_id','10gXkfUs','3142194szJlcI','2547782XNInqR','fromURL','loading','model','batch_decode','Loading\x20model...','postMessage','construct_prompts','getInstance','post_process_generation','supports_fp16','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','fp32','shader-f16','generate','complete','8358424FgaAYD','onnx-community/Florence-2-base-ft','includes','ready','1ePsYuQ','addEventListener','115gGeMEt','now'];a0_0x512e=function(){return _0x264f3c;};return a0_0x512e();}self[a0_0x3ad55d(0x1e4)](a0_0x3ad55d(0x1f2),async _0xd0c2c1=>{const {type:_0x5d5e89,data:_0x520c52}=_0xd0c2c1['data'];switch(_0x5d5e89){case'load':load();break;case'run':run(_0x520c52);break;case'reset':vision_inputs=image_size=null;}});