function a0_0x381e(_0x292b79,_0x3a2841){const _0x1e917f=a0_0x1e91();return a0_0x381e=function(_0x381ece,_0x1d93f2){_0x381ece=_0x381ece-0x6f;let _0x1db7ec=_0x1e917f[_0x381ece];return _0x1db7ec;},a0_0x381e(_0x292b79,_0x3a2841);}const a0_0x9e613f=a0_0x381e;(function(_0x245313,_0x206f96){const _0x2b6655=a0_0x381e,_0x24e6ec=_0x245313();while(!![]){try{const _0x37a02d=parseInt(_0x2b6655(0x77))/0x1*(-parseInt(_0x2b6655(0x79))/0x2)+parseInt(_0x2b6655(0x7d))/0x3+parseInt(_0x2b6655(0x82))/0x4*(-parseInt(_0x2b6655(0x8d))/0x5)+parseInt(_0x2b6655(0x96))/0x6*(parseInt(_0x2b6655(0x78))/0x7)+-parseInt(_0x2b6655(0x99))/0x8+parseInt(_0x2b6655(0x90))/0x9*(-parseInt(_0x2b6655(0x74))/0xa)+-parseInt(_0x2b6655(0x83))/0xb*(-parseInt(_0x2b6655(0x98))/0xc);if(_0x37a02d===_0x206f96)break;else _0x24e6ec['push'](_0x24e6ec['shift']());}catch(_0xc8beae){_0x24e6ec['push'](_0x24e6ec['shift']());}}}(a0_0x1e91,0x94db6));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x1e91(){const _0x25abbd=['complete','generate','fp16','gpu','loading','145NkGrYd','data','includes','21501tlXHAd','supports_fp16','has','processor','now','requestAdapter','237672PAYGwK','message','564ubeSUk','8331656NbuwLp','model','fromURL','from_pretrained','Loading\x20model...','tokenizer','80WwUZdj','webgpu','reset','1kdswiZ','7sscCth','77118hcxuFi','addEventListener','features','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','1723668ACdCLG','run','fp32','shader-f16','<CAPTION_TO_PHRASE_GROUNDING>','23260bnJhZd','295669McVlrf','size','model_id','getInstance','postMessage'];a0_0x1e91=function(){return _0x25abbd;};return a0_0x1e91();}async function hasFp16(){const _0x42e9d1=a0_0x381e;try{return(await navigator[_0x42e9d1(0x8b)][_0x42e9d1(0x95)]())[_0x42e9d1(0x7b)][_0x42e9d1(0x92)](_0x42e9d1(0x80));}catch(_0x5e3c25){return!0x1;}}class Florence2Singleton{static ['model_id']='onnx-community/Florence-2-base-ft';static async[a0_0x9e613f(0x86)](_0x19f19a=null){const _0x12ad7b=a0_0x9e613f;return this[_0x12ad7b(0x93)]??=AutoProcessor[_0x12ad7b(0x71)](this[_0x12ad7b(0x85)]),this[_0x12ad7b(0x73)]??=AutoTokenizer['from_pretrained'](this[_0x12ad7b(0x85)]),this[_0x12ad7b(0x91)]??=await hasFp16(),this[_0x12ad7b(0x6f)]??=Florence2ForConditionalGeneration[_0x12ad7b(0x71)](this[_0x12ad7b(0x85)],{'dtype':{'embed_tokens':this[_0x12ad7b(0x91)]?'fp16':_0x12ad7b(0x7f),'vision_encoder':this[_0x12ad7b(0x91)]?_0x12ad7b(0x8a):_0x12ad7b(0x7f),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x12ad7b(0x75),'progress_callback':_0x19f19a}),Promise['all']([this['model'],this[_0x12ad7b(0x73)],this[_0x12ad7b(0x93)]]);}}async function load(){const _0xf122f=a0_0x9e613f;self[_0xf122f(0x87)]({'status':_0xf122f(0x8c),'data':_0xf122f(0x72)});const [_0x2d8d15,_0x12e436,_0x5981f6]=await Florence2Singleton[_0xf122f(0x86)](_0x2d264e=>{const _0xbf5b29=_0xf122f;self[_0xbf5b29(0x87)](_0x2d264e);});self['postMessage']({'status':'loading','data':_0xf122f(0x7c)});const _0x4e7c62=_0x12e436('a'),_0x1cf3a9=full([0x1,0x3,0x300,0x300],0x0);await _0x2d8d15[_0xf122f(0x89)]({..._0x4e7c62,'pixel_values':_0x1cf3a9,'max_new_tokens':0x1}),self[_0xf122f(0x87)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x9e613f(0x81)];let vision_inputs,image_size;async function run({text:_0x52ba64,url:_0x155818,task:_0x3bd9c2}){const _0x252e28=a0_0x9e613f,[_0x413fe8,_0x3216b1,_0x56ee37]=await Florence2Singleton[_0x252e28(0x86)](),_0x3b185b=performance[_0x252e28(0x94)]();if(!vision_inputs){const _0x36d630=await RawImage[_0x252e28(0x70)](_0x155818);image_size=_0x36d630[_0x252e28(0x84)],vision_inputs=await _0x56ee37(_0x36d630);}let _0x25103c=_0x3bd9c2;TASKS_WITH_INPUTS[_0x252e28(0x8f)](_0x3bd9c2)&&_0x52ba64&&(_0x25103c+=_0x52ba64);const _0x5328b1=_0x3216b1(_0x56ee37['construct_prompts'](_0x25103c)),_0x5a3ab1=await _0x413fe8['generate']({..._0x5328b1,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x548f41=_0x3216b1['batch_decode'](_0x5a3ab1,{'skip_special_tokens':!0x1})[0x0],_0x31724a=_0x56ee37['post_process_generation'](_0x548f41,_0x3bd9c2,image_size),_0x1d008e=performance[_0x252e28(0x94)]();self['postMessage']({'status':_0x252e28(0x88),'result':_0x31724a,'time':_0x1d008e-_0x3b185b});}self[a0_0x9e613f(0x7a)](a0_0x9e613f(0x97),async _0x66a770=>{const _0x3c9ba0=a0_0x9e613f,{type:_0x4edade,data:_0x7f3c6f}=_0x66a770[_0x3c9ba0(0x8e)];switch(_0x4edade){case'load':load();break;case _0x3c9ba0(0x7e):run(_0x7f3c6f);break;case _0x3c9ba0(0x76):vision_inputs=image_size=null;}});