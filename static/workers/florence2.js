const a0_0x2ce3c9=a0_0x58e9;(function(_0x4d9b0f,_0x3d2e52){const _0x4b54e3=a0_0x58e9,_0x306338=_0x4d9b0f();while(!![]){try{const _0x2b8144=parseInt(_0x4b54e3(0x1a7))/0x1+parseInt(_0x4b54e3(0x19b))/0x2+-parseInt(_0x4b54e3(0x1a3))/0x3*(parseInt(_0x4b54e3(0x1b5))/0x4)+-parseInt(_0x4b54e3(0x199))/0x5+parseInt(_0x4b54e3(0x192))/0x6+parseInt(_0x4b54e3(0x1a5))/0x7*(parseInt(_0x4b54e3(0x1b4))/0x8)+-parseInt(_0x4b54e3(0x1b0))/0x9;if(_0x2b8144===_0x3d2e52)break;else _0x306338['push'](_0x306338['shift']());}catch(_0x141bd0){_0x306338['push'](_0x306338['shift']());}}}(a0_0x51af,0xa0391));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x162f63=a0_0x58e9;try{return(await navigator['gpu'][_0x162f63(0x1b2)]())[_0x162f63(0x19c)][_0x162f63(0x1a0)](_0x162f63(0x194));}catch(_0x2c1a39){return!0x1;}}class Florence2Singleton{static [a0_0x2ce3c9(0x1ac)]=a0_0x2ce3c9(0x1b1);static async[a0_0x2ce3c9(0x1a8)](_0x178346=null){const _0x97d750=a0_0x2ce3c9;return this[_0x97d750(0x1ad)]??=AutoProcessor[_0x97d750(0x195)](this['model_id']),this[_0x97d750(0x1a6)]??=AutoTokenizer['from_pretrained'](this[_0x97d750(0x1ac)]),this[_0x97d750(0x191)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x97d750(0x195)](this['model_id'],{'dtype':{'embed_tokens':this[_0x97d750(0x191)]?_0x97d750(0x198):_0x97d750(0x1b7),'vision_encoder':this[_0x97d750(0x191)]?_0x97d750(0x198):_0x97d750(0x1b7),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x178346}),Promise[_0x97d750(0x19a)]([this[_0x97d750(0x1ae)],this['tokenizer'],this[_0x97d750(0x1ad)]]);}}async function load(){const _0x2ebb28=a0_0x2ce3c9;self['postMessage']({'status':_0x2ebb28(0x1aa),'data':_0x2ebb28(0x1a9)});const [_0x34794e,_0x2cf22c,_0x1c067f]=await Florence2Singleton['getInstance'](_0x103589=>{const _0x534333=_0x2ebb28;self[_0x534333(0x1a4)](_0x103589);});self[_0x2ebb28(0x1a4)]({'status':_0x2ebb28(0x1aa),'data':_0x2ebb28(0x19d)});const _0x52bd34=_0x2cf22c('a'),_0x52ed6e=full([0x1,0x3,0x300,0x300],0x0);await _0x34794e[_0x2ebb28(0x196)]({..._0x52bd34,'pixel_values':_0x52ed6e,'max_new_tokens':0x1}),self[_0x2ebb28(0x1a4)]({'status':_0x2ebb28(0x1b3)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x189fc1,url:_0x389498,task:_0xd6a9d}){const _0x17a4cc=a0_0x2ce3c9,[_0xdab80c,_0x3f2ffc,_0x26f5cc]=await Florence2Singleton[_0x17a4cc(0x1a8)](),_0x26c585=performance[_0x17a4cc(0x1b8)]();if(!vision_inputs){const _0x49ffa0=await RawImage[_0x17a4cc(0x197)](_0x389498);image_size=_0x49ffa0[_0x17a4cc(0x19f)],vision_inputs=await _0x26f5cc(_0x49ffa0);}let _0x3ee071=_0xd6a9d;TASKS_WITH_INPUTS['includes'](_0xd6a9d)&&_0x189fc1&&(_0x3ee071+=_0x189fc1);const _0x2e8329=_0x3f2ffc(_0x26f5cc[_0x17a4cc(0x1a2)](_0x3ee071)),_0x20c47d=await _0xdab80c[_0x17a4cc(0x196)]({..._0x2e8329,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1a92a8=_0x3f2ffc[_0x17a4cc(0x193)](_0x20c47d,{'skip_special_tokens':!0x1})[0x0],_0x595c91=_0x26f5cc['post_process_generation'](_0x1a92a8,_0xd6a9d,image_size),_0xb5c1dc=performance[_0x17a4cc(0x1b8)]();self[_0x17a4cc(0x1a4)]({'status':_0x17a4cc(0x1a1),'result':_0x595c91,'time':_0xb5c1dc-_0x26c585});}function a0_0x58e9(_0x3b3ffb,_0x4d2030){const _0x51af45=a0_0x51af();return a0_0x58e9=function(_0x58e985,_0x4bd7d4){_0x58e985=_0x58e985-0x191;let _0xaf2a27=_0x51af45[_0x58e985];return _0xaf2a27;},a0_0x58e9(_0x3b3ffb,_0x4d2030);}function a0_0x51af(){const _0x173657=['18823437nuZJav','onnx-community/Florence-2-base-ft','requestAdapter','ready','15248vvGMXj','4DywSMQ','run','fp32','now','supports_fp16','7743858WZeFFB','batch_decode','shader-f16','from_pretrained','generate','fromURL','fp16','22510iKnrdr','all','1979330CwYDFG','features','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','reset','size','has','complete','construct_prompts','1114395uaoJjh','postMessage','2611tGnZoa','tokenizer','132487KvqLpu','getInstance','Loading\x20model...','loading','load','model_id','processor','model','data'];a0_0x51af=function(){return _0x173657;};return a0_0x51af();}self['addEventListener']('message',async _0x3afe61=>{const _0x1c41e4=a0_0x2ce3c9,{type:_0x37e02c,data:_0x287952}=_0x3afe61[_0x1c41e4(0x1af)];switch(_0x37e02c){case _0x1c41e4(0x1ab):load();break;case _0x1c41e4(0x1b6):run(_0x287952);break;case _0x1c41e4(0x19e):vision_inputs=image_size=null;}});