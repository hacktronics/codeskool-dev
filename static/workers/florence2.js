const a0_0x1e3394=a0_0x3783;(function(_0x244e05,_0x15a43e){const _0x3924da=a0_0x3783,_0x3255d0=_0x244e05();while(!![]){try{const _0x45bec6=-parseInt(_0x3924da(0x1b8))/0x1+-parseInt(_0x3924da(0x1a5))/0x2+-parseInt(_0x3924da(0x198))/0x3*(-parseInt(_0x3924da(0x194))/0x4)+-parseInt(_0x3924da(0x1a6))/0x5+parseInt(_0x3924da(0x1b9))/0x6*(-parseInt(_0x3924da(0x19b))/0x7)+parseInt(_0x3924da(0x19a))/0x8+parseInt(_0x3924da(0x1ab))/0x9;if(_0x45bec6===_0x15a43e)break;else _0x3255d0['push'](_0x3255d0['shift']());}catch(_0x6604e3){_0x3255d0['push'](_0x3255d0['shift']());}}}(a0_0x5f08,0x70ba4));function a0_0x5f08(){const _0x16798d=['5115DDOSYZ','reset','1139712aQNsDi','18284hNrCDP','postMessage','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','getInstance','shader-f16','model_id','fromURL','supports_fp16','Loading\x20model...','addEventListener','1085020QgIwjc','2318260snKwEc','generate','includes','now','model','13593429vbePkb','onnx-community/Florence-2-base-ft','batch_decode','post_process_generation','run','fp32','<CAPTION_TO_PHRASE_GROUNDING>','fp16','from_pretrained','features','gpu','load','construct_prompts','890638WltMtc','114CEOsEW','requestAdapter','tokenizer','message','1772qTyNWf','webgpu','loading','processor'];a0_0x5f08=function(){return _0x16798d;};return a0_0x5f08();}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x121885=a0_0x3783;try{return(await navigator[_0x121885(0x1b5)][_0x121885(0x191)]())[_0x121885(0x1b4)]['has'](_0x121885(0x19f));}catch(_0x5ae29c){return!0x1;}}class Florence2Singleton{static [a0_0x1e3394(0x1a0)]=a0_0x1e3394(0x1ac);static async[a0_0x1e3394(0x19e)](_0x383e26=null){const _0x2fad73=a0_0x1e3394;return this['processor']??=AutoProcessor['from_pretrained'](this[_0x2fad73(0x1a0)]),this[_0x2fad73(0x192)]??=AutoTokenizer[_0x2fad73(0x1b3)](this['model_id']),this[_0x2fad73(0x1a2)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x2fad73(0x1b3)](this[_0x2fad73(0x1a0)],{'dtype':{'embed_tokens':this[_0x2fad73(0x1a2)]?'fp16':_0x2fad73(0x1b0),'vision_encoder':this[_0x2fad73(0x1a2)]?_0x2fad73(0x1b2):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x2fad73(0x195),'progress_callback':_0x383e26}),Promise['all']([this[_0x2fad73(0x1aa)],this['tokenizer'],this[_0x2fad73(0x197)]]);}}function a0_0x3783(_0x574c32,_0x267d42){const _0x5f08d1=a0_0x5f08();return a0_0x3783=function(_0x37838c,_0x20a5c0){_0x37838c=_0x37838c-0x191;let _0x51a7da=_0x5f08d1[_0x37838c];return _0x51a7da;},a0_0x3783(_0x574c32,_0x267d42);}async function load(){const _0xd109fb=a0_0x1e3394;self['postMessage']({'status':_0xd109fb(0x196),'data':_0xd109fb(0x1a3)});const [_0x38190a,_0x30656e,_0x2bbb13]=await Florence2Singleton[_0xd109fb(0x19e)](_0x2088ca=>{const _0xa63e32=_0xd109fb;self[_0xa63e32(0x19c)](_0x2088ca);});self[_0xd109fb(0x19c)]({'status':_0xd109fb(0x196),'data':_0xd109fb(0x19d)});const _0x1659d1=_0x30656e('a'),_0x1700af=full([0x1,0x3,0x300,0x300],0x0);await _0x38190a[_0xd109fb(0x1a7)]({..._0x1659d1,'pixel_values':_0x1700af,'max_new_tokens':0x1}),self[_0xd109fb(0x19c)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x1e3394(0x1b1)];let vision_inputs,image_size;async function run({text:_0x39b1ee,url:_0xf0556d,task:_0x1cf50e}){const _0x577404=a0_0x1e3394,[_0x5bf748,_0x30c43d,_0x24a1ec]=await Florence2Singleton[_0x577404(0x19e)](),_0x1fc7b=performance[_0x577404(0x1a9)]();if(!vision_inputs){const _0x27dfa4=await RawImage[_0x577404(0x1a1)](_0xf0556d);image_size=_0x27dfa4['size'],vision_inputs=await _0x24a1ec(_0x27dfa4);}let _0x19e950=_0x1cf50e;TASKS_WITH_INPUTS[_0x577404(0x1a8)](_0x1cf50e)&&_0x39b1ee&&(_0x19e950+=_0x39b1ee);const _0x262f63=_0x30c43d(_0x24a1ec[_0x577404(0x1b7)](_0x19e950)),_0x3d3aec=await _0x5bf748[_0x577404(0x1a7)]({..._0x262f63,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x11c282=_0x30c43d[_0x577404(0x1ad)](_0x3d3aec,{'skip_special_tokens':!0x1})[0x0],_0xa05953=_0x24a1ec[_0x577404(0x1ae)](_0x11c282,_0x1cf50e,image_size),_0xcef4ba=performance[_0x577404(0x1a9)]();self[_0x577404(0x19c)]({'status':'complete','result':_0xa05953,'time':_0xcef4ba-_0x1fc7b});}self[a0_0x1e3394(0x1a4)](a0_0x1e3394(0x193),async _0x3c2b62=>{const _0x8ddb55=a0_0x1e3394,{type:_0x4f2eca,data:_0x68b49f}=_0x3c2b62['data'];switch(_0x4f2eca){case _0x8ddb55(0x1b6):load();break;case _0x8ddb55(0x1af):run(_0x68b49f);break;case _0x8ddb55(0x199):vision_inputs=image_size=null;}});