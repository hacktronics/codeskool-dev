const a0_0x416cef=a0_0x42c8;function a0_0x34a2(){const _0x447afe=['construct_prompts','webgpu','1852IjEsIF','getInstance','model','4270146uhsQyg','<CAPTION_TO_PHRASE_GROUNDING>','fp16','fromURL','fp32','14187fRIxcC','tokenizer','size','supports_fp16','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','368LFZBGa','postMessage','1308SDQQdx','1192Oulsiu','message','1914290ovflZi','gpu','13347HOFuYe','data','from_pretrained','generate','5208145BqsFVj','addEventListener','run','shader-f16','ready','now','post_process_generation','onnx-community/Florence-2-base-ft','loading','model_id','features','includes','has','28400580QcgPGu'];a0_0x34a2=function(){return _0x447afe;};return a0_0x34a2();}(function(_0x24fb8f,_0x2b209c){const _0x921ad7=a0_0x42c8,_0x282703=_0x24fb8f();while(!![]){try{const _0x19ad73=parseInt(_0x921ad7(0xb3))/0x1*(-parseInt(_0x921ad7(0xc2))/0x2)+parseInt(_0x921ad7(0xbb))/0x3*(-parseInt(_0x921ad7(0xc0))/0x4)+-parseInt(_0x921ad7(0xa3))/0x5+parseInt(_0x921ad7(0xb6))/0x6+parseInt(_0x921ad7(0xc5))/0x7+-parseInt(_0x921ad7(0xc3))/0x8*(parseInt(_0x921ad7(0x9f))/0x9)+parseInt(_0x921ad7(0xb0))/0xa;if(_0x19ad73===_0x2b209c)break;else _0x282703['push'](_0x282703['shift']());}catch(_0x36e8b5){_0x282703['push'](_0x282703['shift']());}}}(a0_0x34a2,0xdfb7b));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x404c70=a0_0x42c8;try{return(await navigator[_0x404c70(0x9e)]['requestAdapter']())[_0x404c70(0xad)][_0x404c70(0xaf)](_0x404c70(0xa6));}catch(_0x10f077){return!0x1;}}class Florence2Singleton{static [a0_0x416cef(0xac)]=a0_0x416cef(0xaa);static async[a0_0x416cef(0xb4)](_0x2b85b2=null){const _0x4dd2d2=a0_0x416cef;return this['processor']??=AutoProcessor[_0x4dd2d2(0xa1)](this[_0x4dd2d2(0xac)]),this[_0x4dd2d2(0xbc)]??=AutoTokenizer[_0x4dd2d2(0xa1)](this['model_id']),this[_0x4dd2d2(0xbe)]??=await hasFp16(),this[_0x4dd2d2(0xb5)]??=Florence2ForConditionalGeneration[_0x4dd2d2(0xa1)](this['model_id'],{'dtype':{'embed_tokens':this[_0x4dd2d2(0xbe)]?_0x4dd2d2(0xb8):_0x4dd2d2(0xba),'vision_encoder':this[_0x4dd2d2(0xbe)]?_0x4dd2d2(0xb8):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x4dd2d2(0xb2),'progress_callback':_0x2b85b2}),Promise['all']([this['model'],this[_0x4dd2d2(0xbc)],this['processor']]);}}function a0_0x42c8(_0x2e9ee3,_0x3ef394){const _0x34a29c=a0_0x34a2();return a0_0x42c8=function(_0x42c8c5,_0x354580){_0x42c8c5=_0x42c8c5-0x9e;let _0x29ce4d=_0x34a29c[_0x42c8c5];return _0x29ce4d;},a0_0x42c8(_0x2e9ee3,_0x3ef394);}async function load(){const _0x3a1d20=a0_0x416cef;self[_0x3a1d20(0xc1)]({'status':'loading','data':'Loading\x20model...'});const [_0x4ef989,_0x4b60c8,_0x1e7f8e]=await Florence2Singleton[_0x3a1d20(0xb4)](_0x2543a0=>{const _0x50d0b8=_0x3a1d20;self[_0x50d0b8(0xc1)](_0x2543a0);});self[_0x3a1d20(0xc1)]({'status':_0x3a1d20(0xab),'data':_0x3a1d20(0xbf)});const _0x5efcdd=_0x4b60c8('a'),_0xad8a0d=full([0x1,0x3,0x300,0x300],0x0);await _0x4ef989[_0x3a1d20(0xa2)]({..._0x5efcdd,'pixel_values':_0xad8a0d,'max_new_tokens':0x1}),self[_0x3a1d20(0xc1)]({'status':_0x3a1d20(0xa7)});}const TASKS_WITH_INPUTS=[a0_0x416cef(0xb7)];let vision_inputs,image_size;async function run({text:_0x417064,url:_0x1d8624,task:_0x3a01da}){const _0x25748b=a0_0x416cef,[_0x141d8f,_0x37ccab,_0x257ffd]=await Florence2Singleton[_0x25748b(0xb4)](),_0x3a744b=performance[_0x25748b(0xa8)]();if(!vision_inputs){const _0x345eef=await RawImage[_0x25748b(0xb9)](_0x1d8624);image_size=_0x345eef[_0x25748b(0xbd)],vision_inputs=await _0x257ffd(_0x345eef);}let _0x34178e=_0x3a01da;TASKS_WITH_INPUTS[_0x25748b(0xae)](_0x3a01da)&&_0x417064&&(_0x34178e+=_0x417064);const _0xc77bc=_0x37ccab(_0x257ffd[_0x25748b(0xb1)](_0x34178e)),_0x5ba5dc=await _0x141d8f[_0x25748b(0xa2)]({..._0xc77bc,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x4f2ff1=_0x37ccab['batch_decode'](_0x5ba5dc,{'skip_special_tokens':!0x1})[0x0],_0x1aed55=_0x257ffd[_0x25748b(0xa9)](_0x4f2ff1,_0x3a01da,image_size),_0x102cbd=performance[_0x25748b(0xa8)]();self[_0x25748b(0xc1)]({'status':'complete','result':_0x1aed55,'time':_0x102cbd-_0x3a744b});}self[a0_0x416cef(0xa4)](a0_0x416cef(0xc4),async _0x5375e6=>{const _0x2470ff=a0_0x416cef,{type:_0x2cfd1,data:_0x10633d}=_0x5375e6[_0x2470ff(0xa0)];switch(_0x2cfd1){case'load':load();break;case _0x2470ff(0xa5):run(_0x10633d);break;case'reset':vision_inputs=image_size=null;}});