function a0_0x3100(){const _0x14cc0a=['fp32','from_pretrained','postMessage','webgpu','addEventListener','fromURL','6633040mRmchC','ready','data','gpu','loading','all','231124CgacFg','load','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','includes','<CAPTION_TO_PHRASE_GROUNDING>','features','processor','requestAdapter','Loading\x20model...','now','shader-f16','668689mADnui','generate','4893921ODbhXQ','466338RdQPij','post_process_generation','getInstance','1745232SShlLp','model_id','reset','size','batch_decode','fp16','onnx-community/Florence-2-base-ft','run','1721664aXcaAO','model'];a0_0x3100=function(){return _0x14cc0a;};return a0_0x3100();}const a0_0x84ec8d=a0_0x1762;function a0_0x1762(_0x1cf904,_0x46ca52){const _0x3100e8=a0_0x3100();return a0_0x1762=function(_0x176226,_0x8c3ef2){_0x176226=_0x176226-0x108;let _0x347cff=_0x3100e8[_0x176226];return _0x347cff;},a0_0x1762(_0x1cf904,_0x46ca52);}(function(_0x1c7dd8,_0x4156c3){const _0x5e0054=a0_0x1762,_0x318994=_0x1c7dd8();while(!![]){try{const _0x48b2e5=-parseInt(_0x5e0054(0x12d))/0x1+parseInt(_0x5e0054(0x11c))/0x2+parseInt(_0x5e0054(0x129))/0x3+-parseInt(_0x5e0054(0x10e))/0x4+parseInt(_0x5e0054(0x116))/0x5+parseInt(_0x5e0054(0x12a))/0x6+-parseInt(_0x5e0054(0x127))/0x7;if(_0x48b2e5===_0x4156c3)break;else _0x318994['push'](_0x318994['shift']());}catch(_0x3f7647){_0x318994['push'](_0x318994['shift']());}}}(a0_0x3100,0xd6d99));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x376185=a0_0x1762;try{return(await navigator[_0x376185(0x119)][_0x376185(0x123)]())[_0x376185(0x121)]['has'](_0x376185(0x126));}catch(_0x212617){return!0x1;}}class Florence2Singleton{static [a0_0x84ec8d(0x12e)]=a0_0x84ec8d(0x10c);static async[a0_0x84ec8d(0x12c)](_0x28efca=null){const _0x3b5adf=a0_0x84ec8d;return this[_0x3b5adf(0x122)]??=AutoProcessor['from_pretrained'](this[_0x3b5adf(0x12e)]),this['tokenizer']??=AutoTokenizer[_0x3b5adf(0x111)](this[_0x3b5adf(0x12e)]),this['supports_fp16']??=await hasFp16(),this[_0x3b5adf(0x10f)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x3b5adf(0x12e)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x3b5adf(0x10b):_0x3b5adf(0x110),'vision_encoder':this['supports_fp16']?_0x3b5adf(0x10b):_0x3b5adf(0x110),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x3b5adf(0x113),'progress_callback':_0x28efca}),Promise[_0x3b5adf(0x11b)]([this[_0x3b5adf(0x10f)],this['tokenizer'],this[_0x3b5adf(0x122)]]);}}async function load(){const _0x3bdbc5=a0_0x84ec8d;self[_0x3bdbc5(0x112)]({'status':_0x3bdbc5(0x11a),'data':_0x3bdbc5(0x124)});const [_0x44dff9,_0x273243,_0x5977f6]=await Florence2Singleton[_0x3bdbc5(0x12c)](_0x98edc2=>{const _0x146cd1=_0x3bdbc5;self[_0x146cd1(0x112)](_0x98edc2);});self['postMessage']({'status':_0x3bdbc5(0x11a),'data':_0x3bdbc5(0x11e)});const _0x288491=_0x273243('a'),_0x52bf75=full([0x1,0x3,0x300,0x300],0x0);await _0x44dff9[_0x3bdbc5(0x128)]({..._0x288491,'pixel_values':_0x52bf75,'max_new_tokens':0x1}),self[_0x3bdbc5(0x112)]({'status':_0x3bdbc5(0x117)});}const TASKS_WITH_INPUTS=[a0_0x84ec8d(0x120)];let vision_inputs,image_size;async function run({text:_0x2393d6,url:_0x1f37ea,task:_0x4a51b3}){const _0x5ba6fe=a0_0x84ec8d,[_0x599a57,_0x453984,_0xc4d984]=await Florence2Singleton[_0x5ba6fe(0x12c)](),_0x3797b1=performance['now']();if(!vision_inputs){const _0x2354b6=await RawImage[_0x5ba6fe(0x115)](_0x1f37ea);image_size=_0x2354b6[_0x5ba6fe(0x109)],vision_inputs=await _0xc4d984(_0x2354b6);}let _0x375e42=_0x4a51b3;TASKS_WITH_INPUTS[_0x5ba6fe(0x11f)](_0x4a51b3)&&_0x2393d6&&(_0x375e42+=_0x2393d6);const _0x13a345=_0x453984(_0xc4d984['construct_prompts'](_0x375e42)),_0x555479=await _0x599a57[_0x5ba6fe(0x128)]({..._0x13a345,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x302d85=_0x453984[_0x5ba6fe(0x10a)](_0x555479,{'skip_special_tokens':!0x1})[0x0],_0x1a749f=_0xc4d984[_0x5ba6fe(0x12b)](_0x302d85,_0x4a51b3,image_size),_0x57f63a=performance[_0x5ba6fe(0x125)]();self[_0x5ba6fe(0x112)]({'status':'complete','result':_0x1a749f,'time':_0x57f63a-_0x3797b1});}self[a0_0x84ec8d(0x114)]('message',async _0x453f83=>{const _0x53b3eb=a0_0x84ec8d,{type:_0x12b609,data:_0x5f4f8a}=_0x453f83[_0x53b3eb(0x118)];switch(_0x12b609){case _0x53b3eb(0x11d):load();break;case _0x53b3eb(0x10d):run(_0x5f4f8a);break;case _0x53b3eb(0x108):vision_inputs=image_size=null;}});