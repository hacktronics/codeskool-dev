const a0_0x47b866=a0_0x279a;(function(_0x110675,_0x14692d){const _0x232b7c=a0_0x279a,_0x4e3abc=_0x110675();while(!![]){try{const _0x47f514=parseInt(_0x232b7c(0x1ad))/0x1+parseInt(_0x232b7c(0x19b))/0x2+parseInt(_0x232b7c(0x1a3))/0x3*(parseInt(_0x232b7c(0x1ab))/0x4)+-parseInt(_0x232b7c(0x1a9))/0x5*(-parseInt(_0x232b7c(0x1bb))/0x6)+parseInt(_0x232b7c(0x19e))/0x7*(-parseInt(_0x232b7c(0x1a4))/0x8)+parseInt(_0x232b7c(0x1a8))/0x9*(-parseInt(_0x232b7c(0x1bd))/0xa)+parseInt(_0x232b7c(0x19f))/0xb*(-parseInt(_0x232b7c(0x1bc))/0xc);if(_0x47f514===_0x14692d)break;else _0x4e3abc['push'](_0x4e3abc['shift']());}catch(_0xb54dff){_0x4e3abc['push'](_0x4e3abc['shift']());}}}(a0_0x1d68,0x9d454));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x3dfab7=a0_0x279a;try{return(await navigator[_0x3dfab7(0x1a2)][_0x3dfab7(0x1b2)]())[_0x3dfab7(0x1a1)][_0x3dfab7(0x19d)](_0x3dfab7(0x1a5));}catch(_0x52a252){return!0x1;}}class Florence2Singleton{static ['model_id']='onnx-community/Florence-2-base-ft';static async[a0_0x47b866(0x1aa)](_0x5112a8=null){const _0x12eed5=a0_0x47b866;return this[_0x12eed5(0x1a7)]??=AutoProcessor[_0x12eed5(0x1b5)](this[_0x12eed5(0x1c0)]),this[_0x12eed5(0x1b9)]??=AutoTokenizer[_0x12eed5(0x1b5)](this[_0x12eed5(0x1c0)]),this[_0x12eed5(0x1c2)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x12eed5(0x1b5)](this['model_id'],{'dtype':{'embed_tokens':this[_0x12eed5(0x1c2)]?_0x12eed5(0x1b3):_0x12eed5(0x1bf),'vision_encoder':this[_0x12eed5(0x1c2)]?'fp16':_0x12eed5(0x1bf),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x12eed5(0x1ba),'progress_callback':_0x5112a8}),Promise[_0x12eed5(0x1ae)]([this[_0x12eed5(0x19c)],this[_0x12eed5(0x1b9)],this[_0x12eed5(0x1a7)]]);}}function a0_0x279a(_0x5d5b41,_0x2fdfc4){const _0x1d68ea=a0_0x1d68();return a0_0x279a=function(_0x279a2e,_0x3bf10a){_0x279a2e=_0x279a2e-0x19a;let _0x5ca92d=_0x1d68ea[_0x279a2e];return _0x5ca92d;},a0_0x279a(_0x5d5b41,_0x2fdfc4);}async function load(){const _0x4a7709=a0_0x47b866;self['postMessage']({'status':_0x4a7709(0x1a6),'data':'Loading\x20model...'});const [_0x5f08ab,_0x3f883e,_0x176268]=await Florence2Singleton['getInstance'](_0x1b3d72=>{const _0x157fe9=_0x4a7709;self[_0x157fe9(0x1ac)](_0x1b3d72);});self[_0x4a7709(0x1ac)]({'status':'loading','data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x40e855=_0x3f883e('a'),_0x394c95=full([0x1,0x3,0x300,0x300],0x0);await _0x5f08ab[_0x4a7709(0x1a0)]({..._0x40e855,'pixel_values':_0x394c95,'max_new_tokens':0x1}),self[_0x4a7709(0x1ac)]({'status':_0x4a7709(0x1b1)});}function a0_0x1d68(){const _0x3917f2=['postMessage','144732LXKySC','all','run','batch_decode','ready','requestAdapter','fp16','load','from_pretrained','post_process_generation','construct_prompts','<CAPTION_TO_PHRASE_GROUNDING>','tokenizer','webgpu','30teQmtT','36GJBJxY','10twhqPw','message','fp32','model_id','data','supports_fp16','reset','1616544ZuYZPK','model','has','3042277mjiFDo','4297403JtiSof','generate','features','gpu','12gZRQZk','8mZkQCB','shader-f16','loading','processor','118926SJKlhk','450040ItVRJj','getInstance','860980BzzLzI'];a0_0x1d68=function(){return _0x3917f2;};return a0_0x1d68();}const TASKS_WITH_INPUTS=[a0_0x47b866(0x1b8)];let vision_inputs,image_size;async function run({text:_0x2db20f,url:_0x1c83b5,task:_0x231d9a}){const _0x9bc298=a0_0x47b866,[_0x4b28be,_0x4eb7c8,_0x4253f7]=await Florence2Singleton[_0x9bc298(0x1aa)](),_0x522987=performance['now']();if(!vision_inputs){const _0x4d2c52=await RawImage['fromURL'](_0x1c83b5);image_size=_0x4d2c52['size'],vision_inputs=await _0x4253f7(_0x4d2c52);}let _0x5892b0=_0x231d9a;TASKS_WITH_INPUTS['includes'](_0x231d9a)&&_0x2db20f&&(_0x5892b0+=_0x2db20f);const _0x5baf60=_0x4eb7c8(_0x4253f7[_0x9bc298(0x1b7)](_0x5892b0)),_0x5c37e8=await _0x4b28be[_0x9bc298(0x1a0)]({..._0x5baf60,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x14cd26=_0x4eb7c8[_0x9bc298(0x1b0)](_0x5c37e8,{'skip_special_tokens':!0x1})[0x0],_0x2c7b90=_0x4253f7[_0x9bc298(0x1b6)](_0x14cd26,_0x231d9a,image_size),_0xb681d6=performance['now']();self[_0x9bc298(0x1ac)]({'status':'complete','result':_0x2c7b90,'time':_0xb681d6-_0x522987});}self['addEventListener'](a0_0x47b866(0x1be),async _0x4610cb=>{const _0x55d671=a0_0x47b866,{type:_0x570dbf,data:_0x5c27d2}=_0x4610cb[_0x55d671(0x1c1)];switch(_0x570dbf){case _0x55d671(0x1b4):load();break;case _0x55d671(0x1af):run(_0x5c27d2);break;case _0x55d671(0x19a):vision_inputs=image_size=null;}});