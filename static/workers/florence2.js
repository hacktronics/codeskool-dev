const a0_0x4e1c1e=a0_0x777b;(function(_0x3603c3,_0x572870){const _0x5192ee=a0_0x777b,_0xc4d304=_0x3603c3();while(!![]){try{const _0xe69324=-parseInt(_0x5192ee(0xae))/0x1+parseInt(_0x5192ee(0xa3))/0x2+parseInt(_0x5192ee(0x95))/0x3+-parseInt(_0x5192ee(0x8d))/0x4*(parseInt(_0x5192ee(0xa0))/0x5)+-parseInt(_0x5192ee(0x9b))/0x6+parseInt(_0x5192ee(0x93))/0x7+-parseInt(_0x5192ee(0x97))/0x8*(-parseInt(_0x5192ee(0xad))/0x9);if(_0xe69324===_0x572870)break;else _0xc4d304['push'](_0xc4d304['shift']());}catch(_0x473c00){_0xc4d304['push'](_0xc4d304['shift']());}}}(a0_0x2f56,0xd3d23));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x5baab7=a0_0x777b;try{return(await navigator[_0x5baab7(0xa4)][_0x5baab7(0x8f)]())[_0x5baab7(0xa7)][_0x5baab7(0xa8)](_0x5baab7(0xb1));}catch(_0x43c0fd){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x4e1c1e(0x9a);static async[a0_0x4e1c1e(0x9d)](_0x91ef52=null){const _0x2f35ff=a0_0x4e1c1e;return this['processor']??=AutoProcessor['from_pretrained'](this[_0x2f35ff(0x8c)]),this['tokenizer']??=AutoTokenizer[_0x2f35ff(0xa5)](this['model_id']),this[_0x2f35ff(0x99)]??=await hasFp16(),this[_0x2f35ff(0x9f)]??=Florence2ForConditionalGeneration[_0x2f35ff(0xa5)](this[_0x2f35ff(0x8c)],{'dtype':{'embed_tokens':this[_0x2f35ff(0x99)]?'fp16':_0x2f35ff(0xac),'vision_encoder':this[_0x2f35ff(0x99)]?_0x2f35ff(0xaa):_0x2f35ff(0xac),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x2f35ff(0x92),'progress_callback':_0x91ef52}),Promise[_0x2f35ff(0x90)]([this[_0x2f35ff(0x9f)],this[_0x2f35ff(0xa1)],this['processor']]);}}function a0_0x2f56(){const _0x37944f=['Loading\x20model...','2029460ixHZdA','gpu','from_pretrained','generate','features','has','size','fp16','data','fp32','72378AYivhM','1080254QSNplm','loading','run','shader-f16','batch_decode','construct_prompts','now','model_id','148mZaYrx','postMessage','requestAdapter','all','addEventListener','webgpu','2926259DHjcip','post_process_generation','1033359JsIoVe','ready','1928wOFVgl','complete','supports_fp16','onnx-community/Florence-2-base-ft','7825152ZzDtEZ','reset','getInstance','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','model','62605zHdgRz','tokenizer'];a0_0x2f56=function(){return _0x37944f;};return a0_0x2f56();}async function load(){const _0x1db02c=a0_0x4e1c1e;self[_0x1db02c(0x8e)]({'status':_0x1db02c(0xaf),'data':_0x1db02c(0xa2)});const [_0x148f59,_0x1ac7d0,_0x376d20]=await Florence2Singleton[_0x1db02c(0x9d)](_0x3978b5=>{const _0x188b04=_0x1db02c;self[_0x188b04(0x8e)](_0x3978b5);});self[_0x1db02c(0x8e)]({'status':_0x1db02c(0xaf),'data':_0x1db02c(0x9e)});const _0x5b01e6=_0x1ac7d0('a'),_0xe9a7d8=full([0x1,0x3,0x300,0x300],0x0);await _0x148f59['generate']({..._0x5b01e6,'pixel_values':_0xe9a7d8,'max_new_tokens':0x1}),self['postMessage']({'status':_0x1db02c(0x96)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];function a0_0x777b(_0x207efb,_0x45a314){const _0x2f564b=a0_0x2f56();return a0_0x777b=function(_0x777bb9,_0x5e98f1){_0x777bb9=_0x777bb9-0x8b;let _0x39bd33=_0x2f564b[_0x777bb9];return _0x39bd33;},a0_0x777b(_0x207efb,_0x45a314);}let vision_inputs,image_size;async function run({text:_0x4958e3,url:_0x3aeda2,task:_0x593755}){const _0x1a1f2b=a0_0x4e1c1e,[_0x46188d,_0x20f295,_0x2f1f36]=await Florence2Singleton[_0x1a1f2b(0x9d)](),_0x35394a=performance[_0x1a1f2b(0x8b)]();if(!vision_inputs){const _0x56fc9e=await RawImage['fromURL'](_0x3aeda2);image_size=_0x56fc9e[_0x1a1f2b(0xa9)],vision_inputs=await _0x2f1f36(_0x56fc9e);}let _0x277226=_0x593755;TASKS_WITH_INPUTS['includes'](_0x593755)&&_0x4958e3&&(_0x277226+=_0x4958e3);const _0x2dd640=_0x20f295(_0x2f1f36[_0x1a1f2b(0xb3)](_0x277226)),_0x153277=await _0x46188d[_0x1a1f2b(0xa6)]({..._0x2dd640,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1feca0=_0x20f295[_0x1a1f2b(0xb2)](_0x153277,{'skip_special_tokens':!0x1})[0x0],_0xe233a5=_0x2f1f36[_0x1a1f2b(0x94)](_0x1feca0,_0x593755,image_size),_0x180b92=performance[_0x1a1f2b(0x8b)]();self[_0x1a1f2b(0x8e)]({'status':_0x1a1f2b(0x98),'result':_0xe233a5,'time':_0x180b92-_0x35394a});}self[a0_0x4e1c1e(0x91)]('message',async _0x423017=>{const _0x3bf19d=a0_0x4e1c1e,{type:_0x558ff9,data:_0x3559b0}=_0x423017[_0x3bf19d(0xab)];switch(_0x558ff9){case'load':load();break;case _0x3bf19d(0xb0):run(_0x3559b0);break;case _0x3bf19d(0x9c):vision_inputs=image_size=null;}});