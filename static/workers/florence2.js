const a0_0x3c1cbd=a0_0x4c5e;(function(_0x59041e,_0x51d434){const _0x304eb1=a0_0x4c5e,_0xb18a49=_0x59041e();while(!![]){try{const _0xbec695=parseInt(_0x304eb1(0xaa))/0x1+parseInt(_0x304eb1(0xab))/0x2+parseInt(_0x304eb1(0x9f))/0x3+-parseInt(_0x304eb1(0xa8))/0x4*(parseInt(_0x304eb1(0xa3))/0x5)+-parseInt(_0x304eb1(0xac))/0x6+parseInt(_0x304eb1(0xb1))/0x7*(-parseInt(_0x304eb1(0xad))/0x8)+-parseInt(_0x304eb1(0x96))/0x9*(-parseInt(_0x304eb1(0x9b))/0xa);if(_0xbec695===_0x51d434)break;else _0xb18a49['push'](_0xb18a49['shift']());}catch(_0x2e2aaa){_0xb18a49['push'](_0xb18a49['shift']());}}}(a0_0x3186,0x2a71b));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x294af1=a0_0x4c5e;try{return(await navigator[_0x294af1(0xaf)][_0x294af1(0xa0)]())[_0x294af1(0xb8)][_0x294af1(0x92)](_0x294af1(0x98));}catch(_0x43a1d1){return!0x1;}}function a0_0x3186(){const _0x408f9a=['processor','454956USFSvC','requestAdapter','batch_decode','onnx-community/Florence-2-base-ft','486085DLWpKJ','addEventListener','generate','post_process_generation','model_id','8aNbrtg','postMessage','190287QYNtzJ','98598NvZBjh','1229790vlEkIw','8WdfSlv','now','gpu','run','2143617HJHBKA','supports_fp16','loading','includes','tokenizer','load','from_pretrained','features','getInstance','model','reset','has','data','message','webgpu','4394187MCpyIc','size','shader-f16','Loading\x20model...','fp32','10vDojCj','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','ready'];a0_0x3186=function(){return _0x408f9a;};return a0_0x3186();}function a0_0x4c5e(_0xe9f35e,_0x3dfd9d){const _0x3186fb=a0_0x3186();return a0_0x4c5e=function(_0x4c5ec0,_0x4f72b1){_0x4c5ec0=_0x4c5ec0-0x91;let _0x2221f4=_0x3186fb[_0x4c5ec0];return _0x2221f4;},a0_0x4c5e(_0xe9f35e,_0x3dfd9d);}class Florence2Singleton{static [a0_0x3c1cbd(0xa7)]=a0_0x3c1cbd(0xa2);static async[a0_0x3c1cbd(0xb9)](_0x2035d3=null){const _0x43e988=a0_0x3c1cbd;return this[_0x43e988(0x9e)]??=AutoProcessor[_0x43e988(0xb7)](this['model_id']),this[_0x43e988(0xb5)]??=AutoTokenizer[_0x43e988(0xb7)](this[_0x43e988(0xa7)]),this['supports_fp16']??=await hasFp16(),this[_0x43e988(0xba)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x43e988(0xa7)],{'dtype':{'embed_tokens':this[_0x43e988(0xb2)]?'fp16':_0x43e988(0x9a),'vision_encoder':this[_0x43e988(0xb2)]?'fp16':'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x43e988(0x95),'progress_callback':_0x2035d3}),Promise['all']([this['model'],this[_0x43e988(0xb5)],this[_0x43e988(0x9e)]]);}}async function load(){const _0x112aa3=a0_0x3c1cbd;self['postMessage']({'status':'loading','data':_0x112aa3(0x99)});const [_0x42c416,_0x4b5d91,_0x4f3ad2]=await Florence2Singleton[_0x112aa3(0xb9)](_0x5aecd0=>{const _0x5c38dd=_0x112aa3;self[_0x5c38dd(0xa9)](_0x5aecd0);});self[_0x112aa3(0xa9)]({'status':_0x112aa3(0xb3),'data':_0x112aa3(0x9c)});const _0x47cca0=_0x4b5d91('a'),_0x3cb357=full([0x1,0x3,0x300,0x300],0x0);await _0x42c416[_0x112aa3(0xa5)]({..._0x47cca0,'pixel_values':_0x3cb357,'max_new_tokens':0x1}),self[_0x112aa3(0xa9)]({'status':_0x112aa3(0x9d)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x102ab7,url:_0x334579,task:_0x3f1a05}){const _0x4f9737=a0_0x3c1cbd,[_0x5c98e7,_0x410437,_0x1079e4]=await Florence2Singleton[_0x4f9737(0xb9)](),_0x336d38=performance[_0x4f9737(0xae)]();if(!vision_inputs){const _0xfa9bff=await RawImage['fromURL'](_0x334579);image_size=_0xfa9bff[_0x4f9737(0x97)],vision_inputs=await _0x1079e4(_0xfa9bff);}let _0x3f90b8=_0x3f1a05;TASKS_WITH_INPUTS[_0x4f9737(0xb4)](_0x3f1a05)&&_0x102ab7&&(_0x3f90b8+=_0x102ab7);const _0x3e6f4f=_0x410437(_0x1079e4['construct_prompts'](_0x3f90b8)),_0x13ac9f=await _0x5c98e7['generate']({..._0x3e6f4f,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x54f332=_0x410437[_0x4f9737(0xa1)](_0x13ac9f,{'skip_special_tokens':!0x1})[0x0],_0x14d129=_0x1079e4[_0x4f9737(0xa6)](_0x54f332,_0x3f1a05,image_size),_0x1ddcc9=performance[_0x4f9737(0xae)]();self['postMessage']({'status':'complete','result':_0x14d129,'time':_0x1ddcc9-_0x336d38});}self[a0_0x3c1cbd(0xa4)](a0_0x3c1cbd(0x94),async _0x456611=>{const _0x394a9f=a0_0x3c1cbd,{type:_0x5ccb0d,data:_0x49b6be}=_0x456611[_0x394a9f(0x93)];switch(_0x5ccb0d){case _0x394a9f(0xb6):load();break;case _0x394a9f(0xb0):run(_0x49b6be);break;case _0x394a9f(0x91):vision_inputs=image_size=null;}});