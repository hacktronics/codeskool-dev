const a0_0xe3ec97=a0_0x594b;(function(_0x1f3ff7,_0x50ca2e){const _0x5df29a=a0_0x594b,_0x55aa07=_0x1f3ff7();while(!![]){try{const _0x45b913=parseInt(_0x5df29a(0xfe))/0x1*(parseInt(_0x5df29a(0xe3))/0x2)+parseInt(_0x5df29a(0xdc))/0x3*(-parseInt(_0x5df29a(0xf9))/0x4)+parseInt(_0x5df29a(0xe2))/0x5+parseInt(_0x5df29a(0xfb))/0x6+-parseInt(_0x5df29a(0xeb))/0x7+-parseInt(_0x5df29a(0xf8))/0x8+parseInt(_0x5df29a(0xf7))/0x9*(-parseInt(_0x5df29a(0xe9))/0xa);if(_0x45b913===_0x50ca2e)break;else _0x55aa07['push'](_0x55aa07['shift']());}catch(_0x12d509){_0x55aa07['push'](_0x55aa07['shift']());}}}(a0_0x15d0,0x591f3));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x20a040=a0_0x594b;try{return(await navigator[_0x20a040(0xf6)]['requestAdapter']())[_0x20a040(0x102)]['has']('shader-f16');}catch(_0x3e1ac0){return!0x1;}}class Florence2Singleton{static [a0_0xe3ec97(0xfc)]=a0_0xe3ec97(0xf0);static async[a0_0xe3ec97(0xee)](_0x18b04e=null){const _0x396de4=a0_0xe3ec97;return this[_0x396de4(0xff)]??=AutoProcessor[_0x396de4(0x101)](this[_0x396de4(0xfc)]),this[_0x396de4(0xe7)]??=AutoTokenizer[_0x396de4(0x101)](this[_0x396de4(0xfc)]),this[_0x396de4(0xe0)]??=await hasFp16(),this[_0x396de4(0xec)]??=Florence2ForConditionalGeneration[_0x396de4(0x101)](this[_0x396de4(0xfc)],{'dtype':{'embed_tokens':this[_0x396de4(0xe0)]?_0x396de4(0x105):_0x396de4(0xe8),'vision_encoder':this[_0x396de4(0xe0)]?_0x396de4(0x105):_0x396de4(0xe8),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x396de4(0xde),'progress_callback':_0x18b04e}),Promise[_0x396de4(0xf5)]([this[_0x396de4(0xec)],this[_0x396de4(0xe7)],this['processor']]);}}async function load(){const _0x28644d=a0_0xe3ec97;self[_0x28644d(0xed)]({'status':_0x28644d(0xf2),'data':_0x28644d(0xdd)});const [_0x50fa4f,_0x160434,_0x2496dd]=await Florence2Singleton['getInstance'](_0x3a395d=>{const _0x3cae54=_0x28644d;self[_0x3cae54(0xed)](_0x3a395d);});self[_0x28644d(0xed)]({'status':'loading','data':_0x28644d(0xdf)});const _0x32bbfb=_0x160434('a'),_0x40edd7=full([0x1,0x3,0x300,0x300],0x0);await _0x50fa4f[_0x28644d(0xfd)]({..._0x32bbfb,'pixel_values':_0x40edd7,'max_new_tokens':0x1}),self[_0x28644d(0xed)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0xe3ec97(0xea)];function a0_0x15d0(){const _0x30d484=['reset','data','fp16','6iOnpLe','Loading\x20model...','webgpu','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','supports_fp16','fromURL','3246290PkeUor','15014CGtjop','includes','construct_prompts','now','tokenizer','fp32','10tqypib','<CAPTION_TO_PHRASE_GROUNDING>','2909060pajHcq','model','postMessage','getInstance','post_process_generation','onnx-community/Florence-2-base-ft','complete','loading','run','load','all','gpu','3585969ZAODhF','1826616SVofZW','96392uZruJv','addEventListener','3847050OtZIjW','model_id','generate','22BVYbPh','processor','size','from_pretrained','features'];a0_0x15d0=function(){return _0x30d484;};return a0_0x15d0();}function a0_0x594b(_0x3461a6,_0x4e2066){const _0x15d0d7=a0_0x15d0();return a0_0x594b=function(_0x594ba7,_0x4d64df){_0x594ba7=_0x594ba7-0xdc;let _0xf07ad3=_0x15d0d7[_0x594ba7];return _0xf07ad3;},a0_0x594b(_0x3461a6,_0x4e2066);}let vision_inputs,image_size;async function run({text:_0x332270,url:_0x41a369,task:_0x45fd19}){const _0xe2f49d=a0_0xe3ec97,[_0x4204c9,_0x393495,_0x28e8e2]=await Florence2Singleton['getInstance'](),_0x4f06af=performance[_0xe2f49d(0xe6)]();if(!vision_inputs){const _0x9bd9aa=await RawImage[_0xe2f49d(0xe1)](_0x41a369);image_size=_0x9bd9aa[_0xe2f49d(0x100)],vision_inputs=await _0x28e8e2(_0x9bd9aa);}let _0x539da9=_0x45fd19;TASKS_WITH_INPUTS[_0xe2f49d(0xe4)](_0x45fd19)&&_0x332270&&(_0x539da9+=_0x332270);const _0x1350ce=_0x393495(_0x28e8e2[_0xe2f49d(0xe5)](_0x539da9)),_0x390aa4=await _0x4204c9[_0xe2f49d(0xfd)]({..._0x1350ce,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3315e1=_0x393495['batch_decode'](_0x390aa4,{'skip_special_tokens':!0x1})[0x0],_0x440706=_0x28e8e2[_0xe2f49d(0xef)](_0x3315e1,_0x45fd19,image_size),_0x1d1c07=performance[_0xe2f49d(0xe6)]();self[_0xe2f49d(0xed)]({'status':_0xe2f49d(0xf1),'result':_0x440706,'time':_0x1d1c07-_0x4f06af});}self[a0_0xe3ec97(0xfa)]('message',async _0x5b3325=>{const _0x83b258=a0_0xe3ec97,{type:_0x381ebe,data:_0x5eaabc}=_0x5b3325[_0x83b258(0x104)];switch(_0x381ebe){case _0x83b258(0xf4):load();break;case _0x83b258(0xf3):run(_0x5eaabc);break;case _0x83b258(0x103):vision_inputs=image_size=null;}});