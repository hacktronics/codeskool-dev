const a0_0x27ad5d=a0_0x2551;function a0_0x3829(){const _0x5b6cdf=['processor','getInstance','fp32','complete','addEventListener','batch_decode','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','shader-f16','775588taRbPg','Loading\x20model...','fp16','onnx-community/Florence-2-base-ft','3986442hcsmCk','postMessage','message','generate','reset','8nOdYdX','loading','gpu','run','505ayHSmu','requestAdapter','model','18120pXUQyP','from_pretrained','486330KMpDqm','features','tokenizer','now','supports_fp16','model_id','webgpu','ready','<CAPTION_TO_PHRASE_GROUNDING>','construct_prompts','991361hbyhZP','includes','520cLODQh','has','all','346975LKomPY'];a0_0x3829=function(){return _0x5b6cdf;};return a0_0x3829();}(function(_0x1fd40a,_0x107caf){const _0x1f02f7=a0_0x2551,_0x5919e2=_0x1fd40a();while(!![]){try{const _0x548867=-parseInt(_0x1f02f7(0xe6))/0x1*(parseInt(_0x1f02f7(0xcd))/0x2)+parseInt(_0x1f02f7(0xe9))/0x3+-parseInt(_0x1f02f7(0xd9))/0x4+-parseInt(_0x1f02f7(0xd0))/0x5+-parseInt(_0x1f02f7(0xeb))/0x6+parseInt(_0x1f02f7(0xcb))/0x7*(parseInt(_0x1f02f7(0xe2))/0x8)+parseInt(_0x1f02f7(0xdd))/0x9;if(_0x548867===_0x107caf)break;else _0x5919e2['push'](_0x5919e2['shift']());}catch(_0x350912){_0x5919e2['push'](_0x5919e2['shift']());}}}(a0_0x3829,0x1c10a));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0xd65e8a=a0_0x2551;try{return(await navigator[_0xd65e8a(0xe4)][_0xd65e8a(0xe7)]())[_0xd65e8a(0xec)][_0xd65e8a(0xce)](_0xd65e8a(0xd8));}catch(_0x28bac8){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x27ad5d(0xdc);static async[a0_0x27ad5d(0xd2)](_0x862224=null){const _0x42b0f3=a0_0x27ad5d;return this['processor']??=AutoProcessor[_0x42b0f3(0xea)](this[_0x42b0f3(0xf0)]),this[_0x42b0f3(0xed)]??=AutoTokenizer['from_pretrained'](this[_0x42b0f3(0xf0)]),this[_0x42b0f3(0xef)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration['from_pretrained'](this['model_id'],{'dtype':{'embed_tokens':this[_0x42b0f3(0xef)]?_0x42b0f3(0xdb):'fp32','vision_encoder':this['supports_fp16']?_0x42b0f3(0xdb):_0x42b0f3(0xd3),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x42b0f3(0xf1),'progress_callback':_0x862224}),Promise[_0x42b0f3(0xcf)]([this[_0x42b0f3(0xe8)],this[_0x42b0f3(0xed)],this[_0x42b0f3(0xd1)]]);}}function a0_0x2551(_0x244ae6,_0x486c6a){const _0x382995=a0_0x3829();return a0_0x2551=function(_0x2551db,_0xc5b77b){_0x2551db=_0x2551db-0xc8;let _0x1ab391=_0x382995[_0x2551db];return _0x1ab391;},a0_0x2551(_0x244ae6,_0x486c6a);}async function load(){const _0x4d3c3f=a0_0x27ad5d;self['postMessage']({'status':'loading','data':_0x4d3c3f(0xda)});const [_0x4b0b53,_0x4900a1,_0x113774]=await Florence2Singleton['getInstance'](_0x30378a=>{const _0x32f921=_0x4d3c3f;self[_0x32f921(0xde)](_0x30378a);});self[_0x4d3c3f(0xde)]({'status':_0x4d3c3f(0xe3),'data':_0x4d3c3f(0xd7)});const _0x2b6309=_0x4900a1('a'),_0x44196d=full([0x1,0x3,0x300,0x300],0x0);await _0x4b0b53[_0x4d3c3f(0xe0)]({..._0x2b6309,'pixel_values':_0x44196d,'max_new_tokens':0x1}),self[_0x4d3c3f(0xde)]({'status':_0x4d3c3f(0xc8)});}const TASKS_WITH_INPUTS=[a0_0x27ad5d(0xc9)];let vision_inputs,image_size;async function run({text:_0x130935,url:_0xb90fad,task:_0x28617d}){const _0x49dd2f=a0_0x27ad5d,[_0x2bb12c,_0x33cebb,_0x1f915a]=await Florence2Singleton[_0x49dd2f(0xd2)](),_0x1c382b=performance['now']();if(!vision_inputs){const _0x553810=await RawImage['fromURL'](_0xb90fad);image_size=_0x553810['size'],vision_inputs=await _0x1f915a(_0x553810);}let _0x14e160=_0x28617d;TASKS_WITH_INPUTS[_0x49dd2f(0xcc)](_0x28617d)&&_0x130935&&(_0x14e160+=_0x130935);const _0x3a2309=_0x33cebb(_0x1f915a[_0x49dd2f(0xca)](_0x14e160)),_0x42ea8b=await _0x2bb12c[_0x49dd2f(0xe0)]({..._0x3a2309,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x40b3b2=_0x33cebb[_0x49dd2f(0xd6)](_0x42ea8b,{'skip_special_tokens':!0x1})[0x0],_0x4b4280=_0x1f915a['post_process_generation'](_0x40b3b2,_0x28617d,image_size),_0x335d4c=performance[_0x49dd2f(0xee)]();self[_0x49dd2f(0xde)]({'status':_0x49dd2f(0xd4),'result':_0x4b4280,'time':_0x335d4c-_0x1c382b});}self[a0_0x27ad5d(0xd5)](a0_0x27ad5d(0xdf),async _0x4311c3=>{const _0x224ea6=a0_0x27ad5d,{type:_0x17bb79,data:_0x4fb4f8}=_0x4311c3['data'];switch(_0x17bb79){case'load':load();break;case _0x224ea6(0xe5):run(_0x4fb4f8);break;case _0x224ea6(0xe1):vision_inputs=image_size=null;}});