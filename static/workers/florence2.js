const a0_0x207272=a0_0x10d4;(function(_0x507f22,_0x50a49b){const _0x1d51e6=a0_0x10d4,_0x90e0cb=_0x507f22();while(!![]){try{const _0x7829cb=-parseInt(_0x1d51e6(0xe7))/0x1+parseInt(_0x1d51e6(0x10c))/0x2*(parseInt(_0x1d51e6(0x105))/0x3)+-parseInt(_0x1d51e6(0x10e))/0x4*(-parseInt(_0x1d51e6(0x104))/0x5)+-parseInt(_0x1d51e6(0x109))/0x6*(-parseInt(_0x1d51e6(0xe9))/0x7)+-parseInt(_0x1d51e6(0x10d))/0x8*(parseInt(_0x1d51e6(0x110))/0x9)+parseInt(_0x1d51e6(0x101))/0xa+-parseInt(_0x1d51e6(0xf9))/0xb*(parseInt(_0x1d51e6(0xf0))/0xc);if(_0x7829cb===_0x50a49b)break;else _0x90e0cb['push'](_0x90e0cb['shift']());}catch(_0x54a4c0){_0x90e0cb['push'](_0x90e0cb['shift']());}}}(a0_0x2a27,0xc1fd4));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x4ea8ad=a0_0x10d4;try{return(await navigator[_0x4ea8ad(0xee)][_0x4ea8ad(0xfd)]())[_0x4ea8ad(0x10f)]['has'](_0x4ea8ad(0x106));}catch(_0x390467){return!0x1;}}class Florence2Singleton{static [a0_0x207272(0x115)]=a0_0x207272(0x112);static async[a0_0x207272(0xfe)](_0x4d5179=null){const _0x2359a4=a0_0x207272;return this[_0x2359a4(0xfa)]??=AutoProcessor[_0x2359a4(0xff)](this[_0x2359a4(0x115)]),this[_0x2359a4(0xf1)]??=AutoTokenizer['from_pretrained'](this[_0x2359a4(0x115)]),this['supports_fp16']??=await hasFp16(),this[_0x2359a4(0xe8)]??=Florence2ForConditionalGeneration[_0x2359a4(0xff)](this[_0x2359a4(0x115)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':_0x2359a4(0xfb),'vision_encoder':this[_0x2359a4(0xf8)]?_0x2359a4(0xf7):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x2359a4(0xef),'progress_callback':_0x4d5179}),Promise[_0x2359a4(0xfc)]([this[_0x2359a4(0xe8)],this['tokenizer'],this[_0x2359a4(0xfa)]]);}}async function load(){const _0x763b4c=a0_0x207272;self[_0x763b4c(0xec)]({'status':_0x763b4c(0x108),'data':_0x763b4c(0x10a)});const [_0xb66bb7,_0x56ef68,_0x5c9f03]=await Florence2Singleton[_0x763b4c(0xfe)](_0x4de6e4=>{const _0x510d18=_0x763b4c;self[_0x510d18(0xec)](_0x4de6e4);});self[_0x763b4c(0xec)]({'status':'loading','data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x21a159=_0x56ef68('a'),_0x516379=full([0x1,0x3,0x300,0x300],0x0);await _0xb66bb7[_0x763b4c(0x103)]({..._0x21a159,'pixel_values':_0x516379,'max_new_tokens':0x1}),self[_0x763b4c(0xec)]({'status':_0x763b4c(0x102)});}const TASKS_WITH_INPUTS=[a0_0x207272(0xea)];let vision_inputs,image_size;async function run({text:_0x1a880f,url:_0x40dc57,task:_0x9dcca}){const _0x3c6034=a0_0x207272,[_0x4c05e0,_0xabd393,_0x21b70a]=await Florence2Singleton['getInstance'](),_0x2b4f25=performance[_0x3c6034(0x111)]();if(!vision_inputs){const _0x49b9e7=await RawImage[_0x3c6034(0x114)](_0x40dc57);image_size=_0x49b9e7[_0x3c6034(0x113)],vision_inputs=await _0x21b70a(_0x49b9e7);}let _0x42a9d0=_0x9dcca;TASKS_WITH_INPUTS[_0x3c6034(0xf2)](_0x9dcca)&&_0x1a880f&&(_0x42a9d0+=_0x1a880f);const _0x4a4409=_0xabd393(_0x21b70a[_0x3c6034(0x100)](_0x42a9d0)),_0x289e7f=await _0x4c05e0['generate']({..._0x4a4409,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x2150c7=_0xabd393[_0x3c6034(0xf3)](_0x289e7f,{'skip_special_tokens':!0x1})[0x0],_0x11b834=_0x21b70a[_0x3c6034(0xf4)](_0x2150c7,_0x9dcca,image_size),_0x1dc714=performance[_0x3c6034(0x111)]();self[_0x3c6034(0xec)]({'status':_0x3c6034(0xf5),'result':_0x11b834,'time':_0x1dc714-_0x2b4f25});}function a0_0x2a27(){const _0x520d19=['features','312489jGdEaC','now','onnx-community/Florence-2-base-ft','size','fromURL','model_id','658350nQoUPM','model','1203139OVpJix','<CAPTION_TO_PHRASE_GROUNDING>','reset','postMessage','addEventListener','gpu','webgpu','180YnPmcp','tokenizer','includes','batch_decode','post_process_generation','complete','data','fp16','supports_fp16','504878EbAwoo','processor','fp32','all','requestAdapter','getInstance','from_pretrained','construct_prompts','11035030hvKnbp','ready','generate','40UHZFCx','6918JVKgYw','shader-f16','load','loading','36flPSUZ','Loading\x20model...','run','338kSbDGn','120cLLBYm','68868eDILsR'];a0_0x2a27=function(){return _0x520d19;};return a0_0x2a27();}function a0_0x10d4(_0x11c6ab,_0x3d3db3){const _0x2a27c3=a0_0x2a27();return a0_0x10d4=function(_0x10d4a3,_0x778955){_0x10d4a3=_0x10d4a3-0xe7;let _0x2f2549=_0x2a27c3[_0x10d4a3];return _0x2f2549;},a0_0x10d4(_0x11c6ab,_0x3d3db3);}self[a0_0x207272(0xed)]('message',async _0xc5a50d=>{const _0x123af2=a0_0x207272,{type:_0x503ea2,data:_0x26bae2}=_0xc5a50d[_0x123af2(0xf6)];switch(_0x503ea2){case _0x123af2(0x107):load();break;case _0x123af2(0x10b):run(_0x26bae2);break;case _0x123af2(0xeb):vision_inputs=image_size=null;}});