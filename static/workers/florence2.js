const a0_0x4b4774=a0_0xc3db;(function(_0x4fa454,_0x3648f1){const _0x40ef57=a0_0xc3db,_0x3b7026=_0x4fa454();while(!![]){try{const _0x3270fb=parseInt(_0x40ef57(0x145))/0x1+-parseInt(_0x40ef57(0x13f))/0x2+parseInt(_0x40ef57(0x140))/0x3+parseInt(_0x40ef57(0x143))/0x4+parseInt(_0x40ef57(0x162))/0x5*(-parseInt(_0x40ef57(0x13e))/0x6)+parseInt(_0x40ef57(0x159))/0x7*(parseInt(_0x40ef57(0x14a))/0x8)+-parseInt(_0x40ef57(0x150))/0x9;if(_0x3270fb===_0x3648f1)break;else _0x3b7026['push'](_0x3b7026['shift']());}catch(_0x59027e){_0x3b7026['push'](_0x3b7026['shift']());}}}(a0_0xd5c3,0x7dd10));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x2daf78=a0_0xc3db;try{return(await navigator[_0x2daf78(0x156)][_0x2daf78(0x148)]())[_0x2daf78(0x149)]['has'](_0x2daf78(0x14e));}catch(_0x233b75){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x4b4774(0x146);static async[a0_0x4b4774(0x153)](_0x4c47bb=null){const _0x5be0e7=a0_0x4b4774;return this[_0x5be0e7(0x14b)]??=AutoProcessor[_0x5be0e7(0x141)](this[_0x5be0e7(0x15b)]),this[_0x5be0e7(0x161)]??=AutoTokenizer['from_pretrained'](this[_0x5be0e7(0x15b)]),this['supports_fp16']??=await hasFp16(),this[_0x5be0e7(0x142)]??=Florence2ForConditionalGeneration[_0x5be0e7(0x141)](this[_0x5be0e7(0x15b)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x5be0e7(0x15e):'fp32','vision_encoder':this['supports_fp16']?_0x5be0e7(0x15e):_0x5be0e7(0x154),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5be0e7(0x15c),'progress_callback':_0x4c47bb}),Promise[_0x5be0e7(0x152)]([this[_0x5be0e7(0x142)],this[_0x5be0e7(0x161)],this[_0x5be0e7(0x14b)]]);}}async function load(){const _0x1263ff=a0_0x4b4774;self[_0x1263ff(0x14d)]({'status':_0x1263ff(0x14f),'data':'Loading\x20model...'});const [_0x1792fb,_0x4637ef,_0x121d44]=await Florence2Singleton['getInstance'](_0x5145fb=>{const _0x59a095=_0x1263ff;self[_0x59a095(0x14d)](_0x5145fb);});self[_0x1263ff(0x14d)]({'status':'loading','data':_0x1263ff(0x160)});const _0x3603cf=_0x4637ef('a'),_0x3baa5c=full([0x1,0x3,0x300,0x300],0x0);await _0x1792fb[_0x1263ff(0x147)]({..._0x3603cf,'pixel_values':_0x3baa5c,'max_new_tokens':0x1}),self[_0x1263ff(0x14d)]({'status':_0x1263ff(0x15d)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;function a0_0xc3db(_0x1f8ec,_0x1e4141){const _0xd5c388=a0_0xd5c3();return a0_0xc3db=function(_0xc3db32,_0x41c58a){_0xc3db32=_0xc3db32-0x13d;let _0x57418b=_0xd5c388[_0xc3db32];return _0x57418b;},a0_0xc3db(_0x1f8ec,_0x1e4141);}function a0_0xd5c3(){const _0x56077b=['getInstance','fp32','fromURL','gpu','load','now','6963439ACdeio','construct_prompts','model_id','webgpu','ready','fp16','run','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','tokenizer','5HpmQom','size','addEventListener','4916922VvytBz','589836GdzwSN','1487208ySFwAU','from_pretrained','model','3745772xLXxGa','message','262938kTFLbQ','onnx-community/Florence-2-base-ft','generate','requestAdapter','features','8qFybmk','processor','includes','postMessage','shader-f16','loading','9541305AuVxLp','data','all'];a0_0xd5c3=function(){return _0x56077b;};return a0_0xd5c3();}async function run({text:_0x23d81a,url:_0x340601,task:_0x2a6c67}){const _0xde1be1=a0_0x4b4774,[_0xabaa30,_0x6fc12b,_0x1c358c]=await Florence2Singleton[_0xde1be1(0x153)](),_0x416fe0=performance[_0xde1be1(0x158)]();if(!vision_inputs){const _0xd036cd=await RawImage[_0xde1be1(0x155)](_0x340601);image_size=_0xd036cd[_0xde1be1(0x163)],vision_inputs=await _0x1c358c(_0xd036cd);}let _0x281d3f=_0x2a6c67;TASKS_WITH_INPUTS[_0xde1be1(0x14c)](_0x2a6c67)&&_0x23d81a&&(_0x281d3f+=_0x23d81a);const _0x40b8bc=_0x6fc12b(_0x1c358c[_0xde1be1(0x15a)](_0x281d3f)),_0x3a1e27=await _0xabaa30[_0xde1be1(0x147)]({..._0x40b8bc,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x2c89dd=_0x6fc12b['batch_decode'](_0x3a1e27,{'skip_special_tokens':!0x1})[0x0],_0x46df9a=_0x1c358c['post_process_generation'](_0x2c89dd,_0x2a6c67,image_size),_0x4f0fa8=performance[_0xde1be1(0x158)]();self[_0xde1be1(0x14d)]({'status':'complete','result':_0x46df9a,'time':_0x4f0fa8-_0x416fe0});}self[a0_0x4b4774(0x13d)](a0_0x4b4774(0x144),async _0xa3634d=>{const _0x2fc2b3=a0_0x4b4774,{type:_0x2bd3e2,data:_0xa3040d}=_0xa3634d[_0x2fc2b3(0x151)];switch(_0x2bd3e2){case _0x2fc2b3(0x157):load();break;case _0x2fc2b3(0x15f):run(_0xa3040d);break;case'reset':vision_inputs=image_size=null;}});