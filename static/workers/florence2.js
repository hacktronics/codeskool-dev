const a0_0x4b7f21=a0_0x35e8;(function(_0x2b42f6,_0x798ead){const _0x360ad3=a0_0x35e8,_0x299d73=_0x2b42f6();while(!![]){try{const _0x43bff1=-parseInt(_0x360ad3(0x1df))/0x1+parseInt(_0x360ad3(0x1e6))/0x2+-parseInt(_0x360ad3(0x1f6))/0x3+-parseInt(_0x360ad3(0x1d6))/0x4+-parseInt(_0x360ad3(0x1e5))/0x5+-parseInt(_0x360ad3(0x1e7))/0x6*(-parseInt(_0x360ad3(0x1de))/0x7)+-parseInt(_0x360ad3(0x1f4))/0x8*(-parseInt(_0x360ad3(0x1f0))/0x9);if(_0x43bff1===_0x798ead)break;else _0x299d73['push'](_0x299d73['shift']());}catch(_0x1789c9){_0x299d73['push'](_0x299d73['shift']());}}}(a0_0x1e24,0x3f0dc));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x4573b9=a0_0x35e8;try{return(await navigator[_0x4573b9(0x1e4)][_0x4573b9(0x1f5)]())[_0x4573b9(0x1ee)][_0x4573b9(0x1e9)](_0x4573b9(0x1e3));}catch(_0x347e01){return!0x1;}}class Florence2Singleton{static [a0_0x4b7f21(0x1e1)]='onnx-community/Florence-2-base-ft';static async[a0_0x4b7f21(0x1da)](_0x3de4b2=null){const _0x471ee1=a0_0x4b7f21;return this['processor']??=AutoProcessor[_0x471ee1(0x1d5)](this[_0x471ee1(0x1e1)]),this[_0x471ee1(0x1ef)]??=AutoTokenizer[_0x471ee1(0x1d5)](this['model_id']),this[_0x471ee1(0x1dc)]??=await hasFp16(),this[_0x471ee1(0x1ec)]??=Florence2ForConditionalGeneration[_0x471ee1(0x1d5)](this[_0x471ee1(0x1e1)],{'dtype':{'embed_tokens':this[_0x471ee1(0x1dc)]?_0x471ee1(0x1eb):_0x471ee1(0x1d9),'vision_encoder':this[_0x471ee1(0x1dc)]?_0x471ee1(0x1eb):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x471ee1(0x1dd),'progress_callback':_0x3de4b2}),Promise[_0x471ee1(0x1f1)]([this['model'],this[_0x471ee1(0x1ef)],this[_0x471ee1(0x1d3)]]);}}function a0_0x1e24(){const _0x31844c=['model_id','batch_decode','shader-f16','gpu','1795690AHOxuv','401252EDYZDY','296754yvVzxA','construct_prompts','has','complete','fp16','model','postMessage','features','tokenizer','8406513nfnArF','all','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','message','8ozSXMb','requestAdapter','970083hokXuG','load','run','post_process_generation','processor','generate','from_pretrained','44616vAMlmj','now','loading','fp32','getInstance','data','supports_fp16','webgpu','28HEhZRZ','380598riFfCN','addEventListener'];a0_0x1e24=function(){return _0x31844c;};return a0_0x1e24();}function a0_0x35e8(_0x1d0550,_0x82a1aa){const _0x1e249d=a0_0x1e24();return a0_0x35e8=function(_0x35e831,_0x44c7ee){_0x35e831=_0x35e831-0x1d3;let _0x404068=_0x1e249d[_0x35e831];return _0x404068;},a0_0x35e8(_0x1d0550,_0x82a1aa);}async function load(){const _0x15b81a=a0_0x4b7f21;self[_0x15b81a(0x1ed)]({'status':_0x15b81a(0x1d8),'data':'Loading\x20model...'});const [_0x3b04f8,_0x2dae33,_0x31d925]=await Florence2Singleton[_0x15b81a(0x1da)](_0x2e0f4e=>{const _0x4782ba=_0x15b81a;self[_0x4782ba(0x1ed)](_0x2e0f4e);});self[_0x15b81a(0x1ed)]({'status':_0x15b81a(0x1d8),'data':_0x15b81a(0x1f2)});const _0x4a6bf1=_0x2dae33('a'),_0x45b87f=full([0x1,0x3,0x300,0x300],0x0);await _0x3b04f8[_0x15b81a(0x1d4)]({..._0x4a6bf1,'pixel_values':_0x45b87f,'max_new_tokens':0x1}),self[_0x15b81a(0x1ed)]({'status':'ready'});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x405a39,url:_0x59c52d,task:_0x36e8d3}){const _0x21953c=a0_0x4b7f21,[_0x25270a,_0x30b445,_0x110b14]=await Florence2Singleton[_0x21953c(0x1da)](),_0x1c7d2a=performance['now']();if(!vision_inputs){const _0x3b7a0c=await RawImage['fromURL'](_0x59c52d);image_size=_0x3b7a0c['size'],vision_inputs=await _0x110b14(_0x3b7a0c);}let _0x5179a6=_0x36e8d3;TASKS_WITH_INPUTS['includes'](_0x36e8d3)&&_0x405a39&&(_0x5179a6+=_0x405a39);const _0x5f3208=_0x30b445(_0x110b14[_0x21953c(0x1e8)](_0x5179a6)),_0xdd09be=await _0x25270a[_0x21953c(0x1d4)]({..._0x5f3208,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x403d4b=_0x30b445[_0x21953c(0x1e2)](_0xdd09be,{'skip_special_tokens':!0x1})[0x0],_0x3da70a=_0x110b14[_0x21953c(0x1f9)](_0x403d4b,_0x36e8d3,image_size),_0x137741=performance[_0x21953c(0x1d7)]();self['postMessage']({'status':_0x21953c(0x1ea),'result':_0x3da70a,'time':_0x137741-_0x1c7d2a});}self[a0_0x4b7f21(0x1e0)](a0_0x4b7f21(0x1f3),async _0x12b307=>{const _0x492fa7=a0_0x4b7f21,{type:_0x535183,data:_0x2fc4db}=_0x12b307[_0x492fa7(0x1db)];switch(_0x535183){case _0x492fa7(0x1f7):load();break;case _0x492fa7(0x1f8):run(_0x2fc4db);break;case'reset':vision_inputs=image_size=null;}});