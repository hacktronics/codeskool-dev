const a0_0x1cdc34=a0_0x14d4;(function(_0x8bb406,_0x21f4f0){const _0x687a5a=a0_0x14d4,_0x224320=_0x8bb406();while(!![]){try{const _0x14c6fa=parseInt(_0x687a5a(0x1ad))/0x1*(-parseInt(_0x687a5a(0x1b3))/0x2)+-parseInt(_0x687a5a(0x19c))/0x3*(parseInt(_0x687a5a(0x1a9))/0x4)+parseInt(_0x687a5a(0x1b5))/0x5*(-parseInt(_0x687a5a(0x1a5))/0x6)+-parseInt(_0x687a5a(0x1c0))/0x7*(-parseInt(_0x687a5a(0x1b0))/0x8)+-parseInt(_0x687a5a(0x1bc))/0x9*(-parseInt(_0x687a5a(0x19e))/0xa)+-parseInt(_0x687a5a(0x1a6))/0xb*(parseInt(_0x687a5a(0x1ba))/0xc)+parseInt(_0x687a5a(0x1b8))/0xd;if(_0x14c6fa===_0x21f4f0)break;else _0x224320['push'](_0x224320['shift']());}catch(_0x407137){_0x224320['push'](_0x224320['shift']());}}}(a0_0x5ea4,0x4984d));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x505f6a=a0_0x14d4;try{return(await navigator[_0x505f6a(0x1b1)]['requestAdapter']())[_0x505f6a(0x19d)][_0x505f6a(0x1c5)]('shader-f16');}catch(_0x228ec0){return!0x1;}}function a0_0x5ea4(){const _0xa44b97=['run','construct_prompts','13aKOrNe','fp16','getInstance','80xYREbK','gpu','model_id','44348PXYGKc','from_pretrained','62105hHOufu','complete','fp32','14920178JviqWV','post_process_generation','24BBaVNx','fromURL','2313xpdhAr','processor','<CAPTION_TO_PHRASE_GROUNDING>','now','332325KobOtR','onnx-community/Florence-2-base-ft','supports_fp16','all','batch_decode','has','data','690699dvHNAr','features','3670hnJbJq','load','size','addEventListener','generate','postMessage','Loading\x20model...','246JWNuEx','2133373VbBIeP','tokenizer','model','4eCBjAz','loading'];a0_0x5ea4=function(){return _0xa44b97;};return a0_0x5ea4();}class Florence2Singleton{static [a0_0x1cdc34(0x1b2)]=a0_0x1cdc34(0x1c1);static async[a0_0x1cdc34(0x1af)](_0x4ef9dd=null){const _0x1b2d1f=a0_0x1cdc34;return this[_0x1b2d1f(0x1bd)]??=AutoProcessor[_0x1b2d1f(0x1b4)](this[_0x1b2d1f(0x1b2)]),this[_0x1b2d1f(0x1a7)]??=AutoTokenizer[_0x1b2d1f(0x1b4)](this[_0x1b2d1f(0x1b2)]),this[_0x1b2d1f(0x1c2)]??=await hasFp16(),this[_0x1b2d1f(0x1a8)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x1b2d1f(0x1b2)],{'dtype':{'embed_tokens':this[_0x1b2d1f(0x1c2)]?_0x1b2d1f(0x1ae):_0x1b2d1f(0x1b7),'vision_encoder':this[_0x1b2d1f(0x1c2)]?_0x1b2d1f(0x1ae):_0x1b2d1f(0x1b7),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x4ef9dd}),Promise[_0x1b2d1f(0x1c3)]([this['model'],this[_0x1b2d1f(0x1a7)],this[_0x1b2d1f(0x1bd)]]);}}async function load(){const _0x4b2eca=a0_0x1cdc34;self[_0x4b2eca(0x1a3)]({'status':_0x4b2eca(0x1aa),'data':_0x4b2eca(0x1a4)});const [_0x2c5a0e,_0x30fd56,_0x4283d7]=await Florence2Singleton['getInstance'](_0x24d66c=>{const _0x2b7592=_0x4b2eca;self[_0x2b7592(0x1a3)](_0x24d66c);});self['postMessage']({'status':_0x4b2eca(0x1aa),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x221e06=_0x30fd56('a'),_0x50baf5=full([0x1,0x3,0x300,0x300],0x0);await _0x2c5a0e[_0x4b2eca(0x1a2)]({..._0x221e06,'pixel_values':_0x50baf5,'max_new_tokens':0x1}),self[_0x4b2eca(0x1a3)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x1cdc34(0x1be)];let vision_inputs,image_size;async function run({text:_0x558103,url:_0x8e2af3,task:_0x7605fb}){const _0x5b7ccf=a0_0x1cdc34,[_0x363535,_0x5d9f85,_0x162582]=await Florence2Singleton[_0x5b7ccf(0x1af)](),_0x75abaa=performance[_0x5b7ccf(0x1bf)]();if(!vision_inputs){const _0x167a99=await RawImage[_0x5b7ccf(0x1bb)](_0x8e2af3);image_size=_0x167a99[_0x5b7ccf(0x1a0)],vision_inputs=await _0x162582(_0x167a99);}let _0xc98808=_0x7605fb;TASKS_WITH_INPUTS['includes'](_0x7605fb)&&_0x558103&&(_0xc98808+=_0x558103);const _0x322e12=_0x5d9f85(_0x162582[_0x5b7ccf(0x1ac)](_0xc98808)),_0x413fcb=await _0x363535[_0x5b7ccf(0x1a2)]({..._0x322e12,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x4ed8f2=_0x5d9f85[_0x5b7ccf(0x1c4)](_0x413fcb,{'skip_special_tokens':!0x1})[0x0],_0x320a69=_0x162582[_0x5b7ccf(0x1b9)](_0x4ed8f2,_0x7605fb,image_size),_0x356a0b=performance[_0x5b7ccf(0x1bf)]();self[_0x5b7ccf(0x1a3)]({'status':_0x5b7ccf(0x1b6),'result':_0x320a69,'time':_0x356a0b-_0x75abaa});}function a0_0x14d4(_0x1f6d38,_0x5e9a69){const _0x5ea423=a0_0x5ea4();return a0_0x14d4=function(_0x14d46d,_0x1a83d4){_0x14d46d=_0x14d46d-0x19c;let _0x3b1b8c=_0x5ea423[_0x14d46d];return _0x3b1b8c;},a0_0x14d4(_0x1f6d38,_0x5e9a69);}self[a0_0x1cdc34(0x1a1)]('message',async _0x5eedc6=>{const _0x3519b3=a0_0x1cdc34,{type:_0x50b04d,data:_0x405239}=_0x5eedc6[_0x3519b3(0x1c6)];switch(_0x50b04d){case _0x3519b3(0x19f):load();break;case _0x3519b3(0x1ab):run(_0x405239);break;case'reset':vision_inputs=image_size=null;}});