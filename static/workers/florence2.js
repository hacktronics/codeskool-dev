const a0_0x1362d0=a0_0xd845;(function(_0x1fb7c5,_0x8cdafc){const _0x584f17=a0_0xd845,_0x155e67=_0x1fb7c5();while(!![]){try{const _0x580931=-parseInt(_0x584f17(0x7c))/0x1+parseInt(_0x584f17(0x86))/0x2*(parseInt(_0x584f17(0x87))/0x3)+parseInt(_0x584f17(0x75))/0x4*(-parseInt(_0x584f17(0x91))/0x5)+parseInt(_0x584f17(0x8b))/0x6+-parseInt(_0x584f17(0x80))/0x7*(-parseInt(_0x584f17(0x9b))/0x8)+-parseInt(_0x584f17(0x7a))/0x9+-parseInt(_0x584f17(0x81))/0xa;if(_0x580931===_0x8cdafc)break;else _0x155e67['push'](_0x155e67['shift']());}catch(_0x4d4f36){_0x155e67['push'](_0x155e67['shift']());}}}(a0_0x245e,0x20a38));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x1af9fe=a0_0xd845;try{return(await navigator[_0x1af9fe(0x77)][_0x1af9fe(0x89)]())[_0x1af9fe(0x88)][_0x1af9fe(0x7d)](_0x1af9fe(0x97));}catch(_0xfe848f){return!0x1;}}class Florence2Singleton{static [a0_0x1362d0(0x8d)]=a0_0x1362d0(0x85);static async[a0_0x1362d0(0x94)](_0x1a8759=null){const _0x213658=a0_0x1362d0;return this['processor']??=AutoProcessor[_0x213658(0x82)](this[_0x213658(0x8d)]),this[_0x213658(0x74)]??=AutoTokenizer['from_pretrained'](this[_0x213658(0x8d)]),this['supports_fp16']??=await hasFp16(),this[_0x213658(0x73)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x213658(0x8d)],{'dtype':{'embed_tokens':this[_0x213658(0x7e)]?'fp16':_0x213658(0x99),'vision_encoder':this['supports_fp16']?_0x213658(0x8e):_0x213658(0x99),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x1a8759}),Promise[_0x213658(0x96)]([this[_0x213658(0x73)],this[_0x213658(0x74)],this['processor']]);}}async function load(){const _0x46a7b8=a0_0x1362d0;self[_0x46a7b8(0x7f)]({'status':_0x46a7b8(0x98),'data':_0x46a7b8(0x8f)});const [_0x39bef9,_0xa4e7be,_0x179cc4]=await Florence2Singleton[_0x46a7b8(0x94)](_0x3531ba=>{const _0x3d28fb=_0x46a7b8;self[_0x3d28fb(0x7f)](_0x3531ba);});self[_0x46a7b8(0x7f)]({'status':_0x46a7b8(0x98),'data':_0x46a7b8(0x83)});const _0x34e610=_0xa4e7be('a'),_0x1a6010=full([0x1,0x3,0x300,0x300],0x0);await _0x39bef9[_0x46a7b8(0x7b)]({..._0x34e610,'pixel_values':_0x1a6010,'max_new_tokens':0x1}),self[_0x46a7b8(0x7f)]({'status':_0x46a7b8(0x76)});}const TASKS_WITH_INPUTS=[a0_0x1362d0(0x84)];function a0_0xd845(_0xf761e4,_0x5293a0){const _0x245ef4=a0_0x245e();return a0_0xd845=function(_0xd845de,_0x69a5e0){_0xd845de=_0xd845de-0x73;let _0x46fba5=_0x245ef4[_0xd845de];return _0x46fba5;},a0_0xd845(_0xf761e4,_0x5293a0);}let vision_inputs,image_size;function a0_0x245e(){const _0x575031=['model_id','fp16','Loading\x20model...','data','5vGlItu','load','size','getInstance','construct_prompts','all','shader-f16','loading','fp32','now','528008IZWrXn','model','tokenizer','408776HBDUII','ready','gpu','complete','message','292824PwUzEz','generate','144142kVFtRm','has','supports_fp16','postMessage','14WZRwjg','597260JOGqRG','from_pretrained','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','<CAPTION_TO_PHRASE_GROUNDING>','onnx-community/Florence-2-base-ft','394300kChtLr','3vCMLVu','features','requestAdapter','fromURL','858804KjPExZ','includes'];a0_0x245e=function(){return _0x575031;};return a0_0x245e();}async function run({text:_0x2d8a55,url:_0x305b10,task:_0x2cdb01}){const _0x4ffcec=a0_0x1362d0,[_0x536d8e,_0x4c9259,_0x22d9b7]=await Florence2Singleton[_0x4ffcec(0x94)](),_0x3e6502=performance[_0x4ffcec(0x9a)]();if(!vision_inputs){const _0x4cc138=await RawImage[_0x4ffcec(0x8a)](_0x305b10);image_size=_0x4cc138[_0x4ffcec(0x93)],vision_inputs=await _0x22d9b7(_0x4cc138);}let _0x1491fe=_0x2cdb01;TASKS_WITH_INPUTS[_0x4ffcec(0x8c)](_0x2cdb01)&&_0x2d8a55&&(_0x1491fe+=_0x2d8a55);const _0x5d1868=_0x4c9259(_0x22d9b7[_0x4ffcec(0x95)](_0x1491fe)),_0x58f046=await _0x536d8e[_0x4ffcec(0x7b)]({..._0x5d1868,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0xa8977=_0x4c9259['batch_decode'](_0x58f046,{'skip_special_tokens':!0x1})[0x0],_0x710de8=_0x22d9b7['post_process_generation'](_0xa8977,_0x2cdb01,image_size),_0x342bbb=performance['now']();self['postMessage']({'status':_0x4ffcec(0x78),'result':_0x710de8,'time':_0x342bbb-_0x3e6502});}self['addEventListener'](a0_0x1362d0(0x79),async _0x3e3c29=>{const _0x1eeb00=a0_0x1362d0,{type:_0x31b0af,data:_0x45a9a4}=_0x3e3c29[_0x1eeb00(0x90)];switch(_0x31b0af){case _0x1eeb00(0x92):load();break;case'run':run(_0x45a9a4);break;case'reset':vision_inputs=image_size=null;}});