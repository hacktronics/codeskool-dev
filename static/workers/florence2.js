const a0_0x3a2387=a0_0x1d75;(function(_0x273e86,_0xd69aad){const _0x4b86bd=a0_0x1d75,_0x1ee96e=_0x273e86();while(!![]){try{const _0x27db20=-parseInt(_0x4b86bd(0xe0))/0x1*(parseInt(_0x4b86bd(0xd8))/0x2)+parseInt(_0x4b86bd(0xe8))/0x3+parseInt(_0x4b86bd(0xf7))/0x4+parseInt(_0x4b86bd(0xe6))/0x5*(parseInt(_0x4b86bd(0xf3))/0x6)+-parseInt(_0x4b86bd(0xdd))/0x7*(-parseInt(_0x4b86bd(0xf5))/0x8)+-parseInt(_0x4b86bd(0xe1))/0x9+parseInt(_0x4b86bd(0xd6))/0xa;if(_0x27db20===_0xd69aad)break;else _0x1ee96e['push'](_0x1ee96e['shift']());}catch(_0x2f7ba1){_0x1ee96e['push'](_0x1ee96e['shift']());}}}(a0_0x1c00,0xde2f2));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x73b434=a0_0x1d75;try{return(await navigator[_0x73b434(0xf4)][_0x73b434(0xdc)]())['features'][_0x73b434(0xe7)](_0x73b434(0xf2));}catch(_0x15fcf8){return!0x1;}}function a0_0x1c00(){const _0x220f21=['all','requestAdapter','21elDxlH','model_id','fromURL','34512eMGcoX','7115958amxyYZ','getInstance','processor','webgpu','complete','5SqouIS','has','1789962uRpGCz','now','ready','reset','generate','loading','<CAPTION_TO_PHRASE_GROUNDING>','batch_decode','post_process_generation','load','shader-f16','3309036PLOIdz','gpu','1822320YmJgXZ','includes','3857868Tnqsxa','tokenizer','postMessage','supports_fp16','data','from_pretrained','message','3197230rXnMZR','addEventListener','82jlBFtY','model','fp32'];a0_0x1c00=function(){return _0x220f21;};return a0_0x1c00();}class Florence2Singleton{static [a0_0x3a2387(0xde)]='onnx-community/Florence-2-base-ft';static async[a0_0x3a2387(0xe2)](_0x41e096=null){const _0x59ed31=a0_0x3a2387;return this[_0x59ed31(0xe3)]??=AutoProcessor[_0x59ed31(0xd4)](this[_0x59ed31(0xde)]),this[_0x59ed31(0xd0)]??=AutoTokenizer[_0x59ed31(0xd4)](this[_0x59ed31(0xde)]),this[_0x59ed31(0xd2)]??=await hasFp16(),this[_0x59ed31(0xd9)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x59ed31(0xde)],{'dtype':{'embed_tokens':this[_0x59ed31(0xd2)]?'fp16':_0x59ed31(0xda),'vision_encoder':this[_0x59ed31(0xd2)]?'fp16':'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x59ed31(0xe4),'progress_callback':_0x41e096}),Promise[_0x59ed31(0xdb)]([this[_0x59ed31(0xd9)],this[_0x59ed31(0xd0)],this[_0x59ed31(0xe3)]]);}}async function load(){const _0x279d6f=a0_0x3a2387;self[_0x279d6f(0xd1)]({'status':_0x279d6f(0xed),'data':'Loading\x20model...'});const [_0x221f0a,_0x1d0d5e,_0x2edeb1]=await Florence2Singleton[_0x279d6f(0xe2)](_0x4c01d7=>{const _0x54c39e=_0x279d6f;self[_0x54c39e(0xd1)](_0x4c01d7);});self[_0x279d6f(0xd1)]({'status':'loading','data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x5770b2=_0x1d0d5e('a'),_0x5dbdba=full([0x1,0x3,0x300,0x300],0x0);await _0x221f0a[_0x279d6f(0xec)]({..._0x5770b2,'pixel_values':_0x5dbdba,'max_new_tokens':0x1}),self[_0x279d6f(0xd1)]({'status':_0x279d6f(0xea)});}function a0_0x1d75(_0x2fd32f,_0x5d28fc){const _0x1c0015=a0_0x1c00();return a0_0x1d75=function(_0x1d758d,_0x967639){_0x1d758d=_0x1d758d-0xd0;let _0x5b7edc=_0x1c0015[_0x1d758d];return _0x5b7edc;},a0_0x1d75(_0x2fd32f,_0x5d28fc);}const TASKS_WITH_INPUTS=[a0_0x3a2387(0xee)];let vision_inputs,image_size;async function run({text:_0x3b2986,url:_0x5aeb5f,task:_0x53123f}){const _0x3360d1=a0_0x3a2387,[_0x51ebba,_0x4f7e5,_0x146336]=await Florence2Singleton['getInstance'](),_0x30830c=performance[_0x3360d1(0xe9)]();if(!vision_inputs){const _0x3b95e8=await RawImage[_0x3360d1(0xdf)](_0x5aeb5f);image_size=_0x3b95e8['size'],vision_inputs=await _0x146336(_0x3b95e8);}let _0x1b370b=_0x53123f;TASKS_WITH_INPUTS[_0x3360d1(0xf6)](_0x53123f)&&_0x3b2986&&(_0x1b370b+=_0x3b2986);const _0x5359bf=_0x4f7e5(_0x146336['construct_prompts'](_0x1b370b)),_0xc09424=await _0x51ebba[_0x3360d1(0xec)]({..._0x5359bf,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x18870a=_0x4f7e5[_0x3360d1(0xef)](_0xc09424,{'skip_special_tokens':!0x1})[0x0],_0x4114bf=_0x146336[_0x3360d1(0xf0)](_0x18870a,_0x53123f,image_size),_0x4dcbc0=performance[_0x3360d1(0xe9)]();self[_0x3360d1(0xd1)]({'status':_0x3360d1(0xe5),'result':_0x4114bf,'time':_0x4dcbc0-_0x30830c});}self[a0_0x3a2387(0xd7)](a0_0x3a2387(0xd5),async _0x53853c=>{const _0x5a8629=a0_0x3a2387,{type:_0x37f67a,data:_0x5e28e7}=_0x53853c[_0x5a8629(0xd3)];switch(_0x37f67a){case _0x5a8629(0xf1):load();break;case'run':run(_0x5e28e7);break;case _0x5a8629(0xeb):vision_inputs=image_size=null;}});