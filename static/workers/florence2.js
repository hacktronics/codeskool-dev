const a0_0x2f455d=a0_0x3372;function a0_0x1816(){const _0x9053a8=['fp32','postMessage','37512gRKdQC','supports_fp16','31557955ygBChG','reset','1630530bEUOTT','now','8088bcyGHH','requestAdapter','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','model_id','load','2224akomLP','getInstance','batch_decode','model','<CAPTION_TO_PHRASE_GROUNDING>','from_pretrained','loading','fp16','1010NwmOsP','has','processor','post_process_generation','data','1743vahlJn','generate','64215pGoFzu','tokenizer','construct_prompts','971478DZfeFI','gpu','includes','shader-f16','910RkNbKh','all','370OrNVhV','webgpu','message'];a0_0x1816=function(){return _0x9053a8;};return a0_0x1816();}(function(_0x48cbf9,_0xfc0176){const _0x2726f6=a0_0x3372,_0xae4e18=_0x48cbf9();while(!![]){try{const _0x3453ee=parseInt(_0x2726f6(0x1a6))/0x1+-parseInt(_0x2726f6(0x194))/0x2*(-parseInt(_0x2726f6(0x1a1))/0x3)+parseInt(_0x2726f6(0x18f))/0x4*(parseInt(_0x2726f6(0x1ac))/0x5)+parseInt(_0x2726f6(0x18d))/0x6+-parseInt(_0x2726f6(0x1aa))/0x7*(-parseInt(_0x2726f6(0x189))/0x8)+-parseInt(_0x2726f6(0x1a3))/0x9*(-parseInt(_0x2726f6(0x19c))/0xa)+-parseInt(_0x2726f6(0x18b))/0xb;if(_0x3453ee===_0xfc0176)break;else _0xae4e18['push'](_0xae4e18['shift']());}catch(_0x166406){_0xae4e18['push'](_0xae4e18['shift']());}}}(a0_0x1816,0x7a209));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x233d31=a0_0x3372;try{return(await navigator[_0x233d31(0x1a7)][_0x233d31(0x190)]())['features'][_0x233d31(0x19d)](_0x233d31(0x1a9));}catch(_0x345b54){return!0x1;}}class Florence2Singleton{static ['model_id']='onnx-community/Florence-2-base-ft';static async[a0_0x2f455d(0x195)](_0x45739f=null){const _0x291be5=a0_0x2f455d;return this[_0x291be5(0x19e)]??=AutoProcessor[_0x291be5(0x199)](this['model_id']),this[_0x291be5(0x1a4)]??=AutoTokenizer[_0x291be5(0x199)](this[_0x291be5(0x192)]),this[_0x291be5(0x18a)]??=await hasFp16(),this[_0x291be5(0x197)]??=Florence2ForConditionalGeneration[_0x291be5(0x199)](this[_0x291be5(0x192)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':_0x291be5(0x187),'vision_encoder':this['supports_fp16']?_0x291be5(0x19b):_0x291be5(0x187),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x291be5(0x185),'progress_callback':_0x45739f}),Promise[_0x291be5(0x1ab)]([this[_0x291be5(0x197)],this[_0x291be5(0x1a4)],this['processor']]);}}async function load(){const _0x4aae15=a0_0x2f455d;self['postMessage']({'status':_0x4aae15(0x19a),'data':'Loading\x20model...'});const [_0x54659d,_0x1ae706,_0x5d9d59]=await Florence2Singleton['getInstance'](_0xf3626f=>{const _0x1ca73a=_0x4aae15;self[_0x1ca73a(0x188)](_0xf3626f);});self[_0x4aae15(0x188)]({'status':_0x4aae15(0x19a),'data':_0x4aae15(0x191)});const _0x301065=_0x1ae706('a'),_0x47dd79=full([0x1,0x3,0x300,0x300],0x0);await _0x54659d['generate']({..._0x301065,'pixel_values':_0x47dd79,'max_new_tokens':0x1}),self[_0x4aae15(0x188)]({'status':'ready'});}function a0_0x3372(_0xbb96d0,_0x1d24da){const _0x181666=a0_0x1816();return a0_0x3372=function(_0x337217,_0x50d69f){_0x337217=_0x337217-0x185;let _0x3c92dc=_0x181666[_0x337217];return _0x3c92dc;},a0_0x3372(_0xbb96d0,_0x1d24da);}const TASKS_WITH_INPUTS=[a0_0x2f455d(0x198)];let vision_inputs,image_size;async function run({text:_0x347517,url:_0x5c3a7f,task:_0x1de8ea}){const _0x6edb7b=a0_0x2f455d,[_0xa22b71,_0x50503c,_0x45b806]=await Florence2Singleton[_0x6edb7b(0x195)](),_0x548241=performance[_0x6edb7b(0x18e)]();if(!vision_inputs){const _0x2eac2c=await RawImage['fromURL'](_0x5c3a7f);image_size=_0x2eac2c['size'],vision_inputs=await _0x45b806(_0x2eac2c);}let _0x20cf4b=_0x1de8ea;TASKS_WITH_INPUTS[_0x6edb7b(0x1a8)](_0x1de8ea)&&_0x347517&&(_0x20cf4b+=_0x347517);const _0x265038=_0x50503c(_0x45b806[_0x6edb7b(0x1a5)](_0x20cf4b)),_0x1692e1=await _0xa22b71[_0x6edb7b(0x1a2)]({..._0x265038,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3df441=_0x50503c[_0x6edb7b(0x196)](_0x1692e1,{'skip_special_tokens':!0x1})[0x0],_0x496b47=_0x45b806[_0x6edb7b(0x19f)](_0x3df441,_0x1de8ea,image_size),_0x52f76c=performance[_0x6edb7b(0x18e)]();self['postMessage']({'status':'complete','result':_0x496b47,'time':_0x52f76c-_0x548241});}self['addEventListener'](a0_0x2f455d(0x186),async _0x124619=>{const _0x12a382=a0_0x2f455d,{type:_0x5868b7,data:_0x2f2f01}=_0x124619[_0x12a382(0x1a0)];switch(_0x5868b7){case _0x12a382(0x193):load();break;case'run':run(_0x2f2f01);break;case _0x12a382(0x18c):vision_inputs=image_size=null;}});