const a0_0x3fc16e=a0_0x42d3;(function(_0x22e836,_0x151533){const _0x58b94b=a0_0x42d3,_0x363507=_0x22e836();while(!![]){try{const _0x385ef1=parseInt(_0x58b94b(0x19d))/0x1*(parseInt(_0x58b94b(0x18c))/0x2)+parseInt(_0x58b94b(0x18b))/0x3+-parseInt(_0x58b94b(0x1a0))/0x4+parseInt(_0x58b94b(0x1a1))/0x5*(parseInt(_0x58b94b(0x191))/0x6)+-parseInt(_0x58b94b(0x195))/0x7+-parseInt(_0x58b94b(0x18a))/0x8*(-parseInt(_0x58b94b(0x1aa))/0x9)+-parseInt(_0x58b94b(0x193))/0xa;if(_0x385ef1===_0x151533)break;else _0x363507['push'](_0x363507['shift']());}catch(_0x1a93a3){_0x363507['push'](_0x363507['shift']());}}}(a0_0x1c5e,0x387da));function a0_0x42d3(_0x5e9184,_0x35fc8e){const _0x1c5e68=a0_0x1c5e();return a0_0x42d3=function(_0x42d337,_0x1ed8b2){_0x42d337=_0x42d337-0x182;let _0x3a7581=_0x1c5e68[_0x42d337];return _0x3a7581;},a0_0x42d3(_0x5e9184,_0x35fc8e);}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3/dist/transformers.min.js';function a0_0x1c5e(){const _0x19447e=['model_id','ready','310620eGcuvV','8705bDwRvA','construct_prompts','fromURL','fp32','addEventListener','reset','features','webgpu','loading','223092JbPdlv','Loading\x20model...','fp16','post_process_generation','data','shader-f16','has','from_pretrained','getInstance','model','size','includes','<CAPTION_TO_PHRASE_GROUNDING>','8qriDlv','1201260NlZiqn','2NVcbut','processor','run','complete','gpu','1398oCSklW','all','3541340HAOHZN','now','3035235xDTZeV','generate','tokenizer','requestAdapter','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','postMessage','message','onnx-community/Florence-2-base-ft','265919AUvEkB'];a0_0x1c5e=function(){return _0x19447e;};return a0_0x1c5e();}async function hasFp16(){const _0x481374=a0_0x42d3;try{return(await navigator[_0x481374(0x190)][_0x481374(0x198)]())[_0x481374(0x1a7)][_0x481374(0x183)](_0x481374(0x182));}catch(_0x284d68){return!0x1;}}class Florence2Singleton{static [a0_0x3fc16e(0x19e)]=a0_0x3fc16e(0x19c);static async[a0_0x3fc16e(0x185)](_0x5d4cdb=null){const _0x2b0f1c=a0_0x3fc16e;return this[_0x2b0f1c(0x18d)]??=AutoProcessor[_0x2b0f1c(0x184)](this[_0x2b0f1c(0x19e)]),this['tokenizer']??=AutoTokenizer[_0x2b0f1c(0x184)](this[_0x2b0f1c(0x19e)]),this['supports_fp16']??=await hasFp16(),this[_0x2b0f1c(0x186)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x2b0f1c(0x19e)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':_0x2b0f1c(0x1a4),'vision_encoder':this['supports_fp16']?_0x2b0f1c(0x1ac):_0x2b0f1c(0x1a4),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x2b0f1c(0x1a8),'progress_callback':_0x5d4cdb}),Promise[_0x2b0f1c(0x192)]([this[_0x2b0f1c(0x186)],this[_0x2b0f1c(0x197)],this[_0x2b0f1c(0x18d)]]);}}async function load(){const _0x420b66=a0_0x3fc16e;self[_0x420b66(0x19a)]({'status':_0x420b66(0x1a9),'data':_0x420b66(0x1ab)});const [_0x25b73c,_0x4782f1,_0x4c16de]=await Florence2Singleton[_0x420b66(0x185)](_0x3d1fa2=>{const _0x5e3515=_0x420b66;self[_0x5e3515(0x19a)](_0x3d1fa2);});self[_0x420b66(0x19a)]({'status':_0x420b66(0x1a9),'data':_0x420b66(0x199)});const _0x2f2eea=_0x4782f1('a'),_0x269ed1=full([0x1,0x3,0x300,0x300],0x0);await _0x25b73c[_0x420b66(0x196)]({..._0x2f2eea,'pixel_values':_0x269ed1,'max_new_tokens':0x1}),self[_0x420b66(0x19a)]({'status':_0x420b66(0x19f)});}const TASKS_WITH_INPUTS=[a0_0x3fc16e(0x189)];let vision_inputs,image_size;async function run({text:_0x32ae2c,url:_0x31e7bc,task:_0x39859b}){const _0x3eaf5d=a0_0x3fc16e,[_0x420f44,_0x511b8a,_0x260791]=await Florence2Singleton['getInstance'](),_0x4dff7a=performance[_0x3eaf5d(0x194)]();if(!vision_inputs){const _0x350762=await RawImage[_0x3eaf5d(0x1a3)](_0x31e7bc);image_size=_0x350762[_0x3eaf5d(0x187)],vision_inputs=await _0x260791(_0x350762);}let _0x4476d2=_0x39859b;TASKS_WITH_INPUTS[_0x3eaf5d(0x188)](_0x39859b)&&_0x32ae2c&&(_0x4476d2+=_0x32ae2c);const _0x16d7a5=_0x511b8a(_0x260791[_0x3eaf5d(0x1a2)](_0x4476d2)),_0x16366d=await _0x420f44['generate']({..._0x16d7a5,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x10437c=_0x511b8a['batch_decode'](_0x16366d,{'skip_special_tokens':!0x1})[0x0],_0x37fe0c=_0x260791[_0x3eaf5d(0x1ad)](_0x10437c,_0x39859b,image_size),_0x42fec6=performance[_0x3eaf5d(0x194)]();self[_0x3eaf5d(0x19a)]({'status':_0x3eaf5d(0x18f),'result':_0x37fe0c,'time':_0x42fec6-_0x4dff7a});}self[a0_0x3fc16e(0x1a5)](a0_0x3fc16e(0x19b),async _0xd36e6d=>{const _0x2443e9=a0_0x3fc16e,{type:_0x159a3a,data:_0x23bffd}=_0xd36e6d[_0x2443e9(0x1ae)];switch(_0x159a3a){case'load':load();break;case _0x2443e9(0x18e):run(_0x23bffd);break;case _0x2443e9(0x1a6):vision_inputs=image_size=null;}});