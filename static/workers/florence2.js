const a0_0x1092a8=a0_0xaaec;(function(_0x1a1132,_0x4d4371){const _0x56a344=a0_0xaaec,_0x54a050=_0x1a1132();while(!![]){try{const _0x1edfe8=-parseInt(_0x56a344(0x14c))/0x1+-parseInt(_0x56a344(0x15a))/0x2*(-parseInt(_0x56a344(0x16b))/0x3)+-parseInt(_0x56a344(0x14d))/0x4+parseInt(_0x56a344(0x14b))/0x5*(parseInt(_0x56a344(0x156))/0x6)+-parseInt(_0x56a344(0x173))/0x7+-parseInt(_0x56a344(0x16f))/0x8*(-parseInt(_0x56a344(0x14e))/0x9)+parseInt(_0x56a344(0x16d))/0xa*(parseInt(_0x56a344(0x15e))/0xb);if(_0x1edfe8===_0x4d4371)break;else _0x54a050['push'](_0x54a050['shift']());}catch(_0x309098){_0x54a050['push'](_0x54a050['shift']());}}}(a0_0x2b91,0xbd1d1));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x3ec884=a0_0xaaec;try{return(await navigator[_0x3ec884(0x157)]['requestAdapter']())[_0x3ec884(0x158)][_0x3ec884(0x16e)](_0x3ec884(0x152));}catch(_0x9140ac){return!0x1;}}function a0_0xaaec(_0x4ab9d6,_0x845d70){const _0x2b9138=a0_0x2b91();return a0_0xaaec=function(_0xaaec1f,_0x42c8dd){_0xaaec1f=_0xaaec1f-0x14a;let _0x999aad=_0x2b9138[_0xaaec1f];return _0x999aad;},a0_0xaaec(_0x4ab9d6,_0x845d70);}class Florence2Singleton{static [a0_0x1092a8(0x14f)]=a0_0x1092a8(0x15d);static async[a0_0x1092a8(0x14a)](_0x156918=null){const _0x550c46=a0_0x1092a8;return this[_0x550c46(0x163)]??=AutoProcessor[_0x550c46(0x151)](this['model_id']),this['tokenizer']??=AutoTokenizer[_0x550c46(0x151)](this[_0x550c46(0x14f)]),this[_0x550c46(0x150)]??=await hasFp16(),this[_0x550c46(0x168)]??=Florence2ForConditionalGeneration['from_pretrained'](this['model_id'],{'dtype':{'embed_tokens':this[_0x550c46(0x150)]?'fp16':'fp32','vision_encoder':this[_0x550c46(0x150)]?_0x550c46(0x161):_0x550c46(0x155),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x550c46(0x171),'progress_callback':_0x156918}),Promise[_0x550c46(0x167)]([this[_0x550c46(0x168)],this[_0x550c46(0x16a)],this['processor']]);}}async function load(){const _0xaade11=a0_0x1092a8;self[_0xaade11(0x159)]({'status':'loading','data':'Loading\x20model...'});const [_0x36a019,_0x132d35,_0x4a9933]=await Florence2Singleton[_0xaade11(0x14a)](_0x3ece72=>{const _0x5e137f=_0xaade11;self[_0x5e137f(0x159)](_0x3ece72);});self['postMessage']({'status':'loading','data':_0xaade11(0x166)});const _0x12a5fc=_0x132d35('a'),_0x5dc34a=full([0x1,0x3,0x300,0x300],0x0);await _0x36a019[_0xaade11(0x170)]({..._0x12a5fc,'pixel_values':_0x5dc34a,'max_new_tokens':0x1}),self[_0xaade11(0x159)]({'status':_0xaade11(0x154)});}function a0_0x2b91(){const _0x2fcb60=['includes','message','fp16','size','processor','run','data','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','all','model','fromURL','tokenizer','3GcwgsR','reset','730raYcDR','has','1344LZQEHL','generate','webgpu','now','5962271LRfwuj','addEventListener','getInstance','5EywwjL','166645fQhtKI','2106252joNHbB','16101DkQwGj','model_id','supports_fp16','from_pretrained','shader-f16','complete','ready','fp32','1191156KfsweS','gpu','features','postMessage','511766EymlRX','construct_prompts','post_process_generation','onnx-community/Florence-2-base-ft','235763EsapSw'];a0_0x2b91=function(){return _0x2fcb60;};return a0_0x2b91();}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x155d34,url:_0x3a4fb3,task:_0x397447}){const _0x5e4720=a0_0x1092a8,[_0x460ae4,_0x1fbee1,_0x193a11]=await Florence2Singleton[_0x5e4720(0x14a)](),_0x476992=performance[_0x5e4720(0x172)]();if(!vision_inputs){const _0x59bc58=await RawImage[_0x5e4720(0x169)](_0x3a4fb3);image_size=_0x59bc58[_0x5e4720(0x162)],vision_inputs=await _0x193a11(_0x59bc58);}let _0x302b46=_0x397447;TASKS_WITH_INPUTS[_0x5e4720(0x15f)](_0x397447)&&_0x155d34&&(_0x302b46+=_0x155d34);const _0x585206=_0x1fbee1(_0x193a11[_0x5e4720(0x15b)](_0x302b46)),_0x1d6a5f=await _0x460ae4[_0x5e4720(0x170)]({..._0x585206,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x29e3ad=_0x1fbee1['batch_decode'](_0x1d6a5f,{'skip_special_tokens':!0x1})[0x0],_0x482736=_0x193a11[_0x5e4720(0x15c)](_0x29e3ad,_0x397447,image_size),_0x1fa113=performance['now']();self[_0x5e4720(0x159)]({'status':_0x5e4720(0x153),'result':_0x482736,'time':_0x1fa113-_0x476992});}self[a0_0x1092a8(0x174)](a0_0x1092a8(0x160),async _0x1e2467=>{const _0x48ee8a=a0_0x1092a8,{type:_0xfecc1a,data:_0x20e5fe}=_0x1e2467[_0x48ee8a(0x165)];switch(_0xfecc1a){case'load':load();break;case _0x48ee8a(0x164):run(_0x20e5fe);break;case _0x48ee8a(0x16c):vision_inputs=image_size=null;}});