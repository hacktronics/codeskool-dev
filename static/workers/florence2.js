const a0_0x12e663=a0_0x3a5c;(function(_0x342e20,_0x58cd94){const _0x226736=a0_0x3a5c,_0x1fe4bb=_0x342e20();while(!![]){try{const _0x507ad2=parseInt(_0x226736(0x110))/0x1*(parseInt(_0x226736(0x121))/0x2)+parseInt(_0x226736(0x11b))/0x3+parseInt(_0x226736(0x103))/0x4*(parseInt(_0x226736(0x104))/0x5)+-parseInt(_0x226736(0x11a))/0x6*(parseInt(_0x226736(0x129))/0x7)+parseInt(_0x226736(0x102))/0x8*(parseInt(_0x226736(0x124))/0x9)+parseInt(_0x226736(0x116))/0xa*(-parseInt(_0x226736(0x11d))/0xb)+-parseInt(_0x226736(0x107))/0xc*(parseInt(_0x226736(0x118))/0xd);if(_0x507ad2===_0x58cd94)break;else _0x1fe4bb['push'](_0x1fe4bb['shift']());}catch(_0x30bb06){_0x1fe4bb['push'](_0x1fe4bb['shift']());}}}(a0_0x7091,0x8d21e));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x29d46a=a0_0x3a5c;try{return(await navigator[_0x29d46a(0x11c)][_0x29d46a(0x12b)]())[_0x29d46a(0x11e)]['has']('shader-f16');}catch(_0x364180){return!0x1;}}class Florence2Singleton{static [a0_0x12e663(0x11f)]='onnx-community/Florence-2-base-ft';static async[a0_0x12e663(0x120)](_0x3106b3=null){const _0x1d317d=a0_0x12e663;return this['processor']??=AutoProcessor[_0x1d317d(0x12a)](this['model_id']),this[_0x1d317d(0x108)]??=AutoTokenizer[_0x1d317d(0x12a)](this[_0x1d317d(0x11f)]),this[_0x1d317d(0x115)]??=await hasFp16(),this[_0x1d317d(0x119)]??=Florence2ForConditionalGeneration[_0x1d317d(0x12a)](this[_0x1d317d(0x11f)],{'dtype':{'embed_tokens':this[_0x1d317d(0x115)]?_0x1d317d(0x125):_0x1d317d(0x10c),'vision_encoder':this['supports_fp16']?_0x1d317d(0x125):_0x1d317d(0x10c),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x1d317d(0x111),'progress_callback':_0x3106b3}),Promise[_0x1d317d(0x109)]([this[_0x1d317d(0x119)],this['tokenizer'],this['processor']]);}}async function load(){const _0x1ed02b=a0_0x12e663;self[_0x1ed02b(0x122)]({'status':_0x1ed02b(0x105),'data':_0x1ed02b(0x106)});const [_0x1ccef1,_0x342bd1,_0x5bcc90]=await Florence2Singleton[_0x1ed02b(0x120)](_0xf48e1a=>{const _0x39f195=_0x1ed02b;self[_0x39f195(0x122)](_0xf48e1a);});self[_0x1ed02b(0x122)]({'status':_0x1ed02b(0x105),'data':_0x1ed02b(0x10e)});const _0x2a8928=_0x342bd1('a'),_0x4a58fd=full([0x1,0x3,0x300,0x300],0x0);await _0x1ccef1[_0x1ed02b(0x128)]({..._0x2a8928,'pixel_values':_0x4a58fd,'max_new_tokens':0x1}),self[_0x1ed02b(0x122)]({'status':_0x1ed02b(0x126)});}const TASKS_WITH_INPUTS=[a0_0x12e663(0x10a)];function a0_0x3a5c(_0x574591,_0x2f7b2f){const _0x70912=a0_0x7091();return a0_0x3a5c=function(_0x3a5c40,_0x427122){_0x3a5c40=_0x3a5c40-0x102;let _0x3c30d5=_0x70912[_0x3a5c40];return _0x3c30d5;},a0_0x3a5c(_0x574591,_0x2f7b2f);}function a0_0x7091(){const _0x35bb8a=['from_pretrained','requestAdapter','789464ErGfqU','3888972OvhZrh','5YubPdH','loading','Loading\x20model...','72fOFDyc','tokenizer','all','<CAPTION_TO_PHRASE_GROUNDING>','load','fp32','message','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','size','10dNEkhR','webgpu','reset','complete','run','supports_fp16','222350UeSXzs','data','5867446YqAtkC','model','112458cacRZT','2758101QPNJqX','gpu','77aqAjjd','features','model_id','getInstance','206382oBhUeQ','postMessage','post_process_generation','90nMfzDW','fp16','ready','now','generate','175HBrTzE'];a0_0x7091=function(){return _0x35bb8a;};return a0_0x7091();}let vision_inputs,image_size;async function run({text:_0x3d8f5a,url:_0x333e7a,task:_0x50a679}){const _0x3009ab=a0_0x12e663,[_0x342576,_0x472b01,_0x56be0a]=await Florence2Singleton[_0x3009ab(0x120)](),_0x4d21da=performance['now']();if(!vision_inputs){const _0x3d4282=await RawImage['fromURL'](_0x333e7a);image_size=_0x3d4282[_0x3009ab(0x10f)],vision_inputs=await _0x56be0a(_0x3d4282);}let _0x348388=_0x50a679;TASKS_WITH_INPUTS['includes'](_0x50a679)&&_0x3d8f5a&&(_0x348388+=_0x3d8f5a);const _0x41e65d=_0x472b01(_0x56be0a['construct_prompts'](_0x348388)),_0x5c618a=await _0x342576[_0x3009ab(0x128)]({..._0x41e65d,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3374a7=_0x472b01['batch_decode'](_0x5c618a,{'skip_special_tokens':!0x1})[0x0],_0x44e637=_0x56be0a[_0x3009ab(0x123)](_0x3374a7,_0x50a679,image_size),_0x4f6b8e=performance[_0x3009ab(0x127)]();self['postMessage']({'status':_0x3009ab(0x113),'result':_0x44e637,'time':_0x4f6b8e-_0x4d21da});}self['addEventListener'](a0_0x12e663(0x10d),async _0x125838=>{const _0x36d82d=a0_0x12e663,{type:_0x27d94e,data:_0x1fe62d}=_0x125838[_0x36d82d(0x117)];switch(_0x27d94e){case _0x36d82d(0x10b):load();break;case _0x36d82d(0x114):run(_0x1fe62d);break;case _0x36d82d(0x112):vision_inputs=image_size=null;}});