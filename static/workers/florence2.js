const a0_0x1e2c61=a0_0x5e7a;(function(_0x23d42f,_0x3c3b35){const _0xcf3558=a0_0x5e7a,_0x417137=_0x23d42f();while(!![]){try{const _0x45308e=parseInt(_0xcf3558(0x215))/0x1+-parseInt(_0xcf3558(0x1f5))/0x2+-parseInt(_0xcf3558(0x1fd))/0x3+-parseInt(_0xcf3558(0x202))/0x4*(parseInt(_0xcf3558(0x1f9))/0x5)+parseInt(_0xcf3558(0x20c))/0x6*(-parseInt(_0xcf3558(0x212))/0x7)+-parseInt(_0xcf3558(0x20d))/0x8+parseInt(_0xcf3558(0x20b))/0x9;if(_0x45308e===_0x3c3b35)break;else _0x417137['push'](_0x417137['shift']());}catch(_0x58526e){_0x417137['push'](_0x417137['shift']());}}}(a0_0x5993,0xe8d60));function a0_0x5993(){const _0x17df03=['generate','batch_decode','30814587yPVJuC','94410EyKCQD','1669936ZaIRvS','tokenizer','<CAPTION_TO_PHRASE_GROUNDING>','load','message','238pVXKrF','ready','model_id','1707184PHzrtu','webgpu','from_pretrained','model','onnx-community/Florence-2-base-ft','2832932OLAyCs','postMessage','fromURL','loading','5kPvZOT','construct_prompts','gpu','shader-f16','1551774AHqwgu','has','now','fp16','getInstance','5999500UvgxPX','requestAdapter','supports_fp16','all','processor','size','post_process_generation'];a0_0x5993=function(){return _0x17df03;};return a0_0x5993();}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x5e7a(_0x3fc2d7,_0x4aac12){const _0x5993c9=a0_0x5993();return a0_0x5e7a=function(_0x5e7a68,_0x1fc508){_0x5e7a68=_0x5e7a68-0x1f2;let _0x17e06c=_0x5993c9[_0x5e7a68];return _0x17e06c;},a0_0x5e7a(_0x3fc2d7,_0x4aac12);}async function hasFp16(){const _0x3a7386=a0_0x5e7a;try{return(await navigator[_0x3a7386(0x1fb)][_0x3a7386(0x203)]())['features'][_0x3a7386(0x1fe)](_0x3a7386(0x1fc));}catch(_0x2d7a84){return!0x1;}}class Florence2Singleton{static [a0_0x1e2c61(0x214)]=a0_0x1e2c61(0x1f4);static async[a0_0x1e2c61(0x201)](_0x31b74d=null){const _0x579aa7=a0_0x1e2c61;return this[_0x579aa7(0x206)]??=AutoProcessor['from_pretrained'](this[_0x579aa7(0x214)]),this[_0x579aa7(0x20e)]??=AutoTokenizer[_0x579aa7(0x1f2)](this[_0x579aa7(0x214)]),this[_0x579aa7(0x204)]??=await hasFp16(),this[_0x579aa7(0x1f3)]??=Florence2ForConditionalGeneration[_0x579aa7(0x1f2)](this[_0x579aa7(0x214)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x579aa7(0x200):'fp32','vision_encoder':this[_0x579aa7(0x204)]?_0x579aa7(0x200):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x579aa7(0x216),'progress_callback':_0x31b74d}),Promise[_0x579aa7(0x205)]([this[_0x579aa7(0x1f3)],this[_0x579aa7(0x20e)],this[_0x579aa7(0x206)]]);}}async function load(){const _0x43c472=a0_0x1e2c61;self[_0x43c472(0x1f6)]({'status':_0x43c472(0x1f8),'data':'Loading\x20model...'});const [_0x1e3630,_0x11625f,_0x38eeeb]=await Florence2Singleton[_0x43c472(0x201)](_0xdb5e19=>{const _0x2888e3=_0x43c472;self[_0x2888e3(0x1f6)](_0xdb5e19);});self[_0x43c472(0x1f6)]({'status':'loading','data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x364e32=_0x11625f('a'),_0x52122e=full([0x1,0x3,0x300,0x300],0x0);await _0x1e3630['generate']({..._0x364e32,'pixel_values':_0x52122e,'max_new_tokens':0x1}),self['postMessage']({'status':_0x43c472(0x213)});}const TASKS_WITH_INPUTS=[a0_0x1e2c61(0x20f)];let vision_inputs,image_size;async function run({text:_0x5d95d3,url:_0x3f17ac,task:_0x1c6a93}){const _0x1c6bf6=a0_0x1e2c61,[_0x3f0888,_0x2ed554,_0x3e6d8f]=await Florence2Singleton[_0x1c6bf6(0x201)](),_0x2395a5=performance['now']();if(!vision_inputs){const _0x5d1b06=await RawImage[_0x1c6bf6(0x1f7)](_0x3f17ac);image_size=_0x5d1b06[_0x1c6bf6(0x207)],vision_inputs=await _0x3e6d8f(_0x5d1b06);}let _0x25f79a=_0x1c6a93;TASKS_WITH_INPUTS['includes'](_0x1c6a93)&&_0x5d95d3&&(_0x25f79a+=_0x5d95d3);const _0x2b9407=_0x2ed554(_0x3e6d8f[_0x1c6bf6(0x1fa)](_0x25f79a)),_0x163f70=await _0x3f0888[_0x1c6bf6(0x209)]({..._0x2b9407,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1b2830=_0x2ed554[_0x1c6bf6(0x20a)](_0x163f70,{'skip_special_tokens':!0x1})[0x0],_0x20a328=_0x3e6d8f[_0x1c6bf6(0x208)](_0x1b2830,_0x1c6a93,image_size),_0x3be08e=performance[_0x1c6bf6(0x1ff)]();self[_0x1c6bf6(0x1f6)]({'status':'complete','result':_0x20a328,'time':_0x3be08e-_0x2395a5});}self['addEventListener'](a0_0x1e2c61(0x211),async _0x480b9f=>{const _0x373a2d=a0_0x1e2c61,{type:_0x34fdbd,data:_0x361dfa}=_0x480b9f['data'];switch(_0x34fdbd){case _0x373a2d(0x210):load();break;case'run':run(_0x361dfa);break;case'reset':vision_inputs=image_size=null;}});