const a0_0x9ca3ec=a0_0x5312;(function(_0xa10230,_0x36b85c){const _0x2e1f3c=a0_0x5312,_0x12183c=_0xa10230();while(!![]){try{const _0x169dc1=-parseInt(_0x2e1f3c(0x140))/0x1*(-parseInt(_0x2e1f3c(0x149))/0x2)+parseInt(_0x2e1f3c(0x141))/0x3*(parseInt(_0x2e1f3c(0x15c))/0x4)+-parseInt(_0x2e1f3c(0x156))/0x5*(-parseInt(_0x2e1f3c(0x15a))/0x6)+-parseInt(_0x2e1f3c(0x151))/0x7*(-parseInt(_0x2e1f3c(0x13c))/0x8)+parseInt(_0x2e1f3c(0x15d))/0x9+parseInt(_0x2e1f3c(0x153))/0xa*(-parseInt(_0x2e1f3c(0x145))/0xb)+parseInt(_0x2e1f3c(0x142))/0xc;if(_0x169dc1===_0x36b85c)break;else _0x12183c['push'](_0x12183c['shift']());}catch(_0x9f06ef){_0x12183c['push'](_0x12183c['shift']());}}}(a0_0x5bce,0xd2a24));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x5ed38c=a0_0x5312;try{return(await navigator[_0x5ed38c(0x14b)]['requestAdapter']())['features'][_0x5ed38c(0x143)](_0x5ed38c(0x15b));}catch(_0x2a3e07){return!0x1;}}class Florence2Singleton{static [a0_0x9ca3ec(0x146)]=a0_0x9ca3ec(0x138);static async[a0_0x9ca3ec(0x13b)](_0x119452=null){const _0x1b29fc=a0_0x9ca3ec;return this[_0x1b29fc(0x13a)]??=AutoProcessor[_0x1b29fc(0x13f)](this[_0x1b29fc(0x146)]),this[_0x1b29fc(0x144)]??=AutoTokenizer[_0x1b29fc(0x13f)](this['model_id']),this[_0x1b29fc(0x139)]??=await hasFp16(),this[_0x1b29fc(0x15e)]??=Florence2ForConditionalGeneration[_0x1b29fc(0x13f)](this[_0x1b29fc(0x146)],{'dtype':{'embed_tokens':this[_0x1b29fc(0x139)]?_0x1b29fc(0x13e):_0x1b29fc(0x148),'vision_encoder':this['supports_fp16']?_0x1b29fc(0x13e):_0x1b29fc(0x148),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x1b29fc(0x14c),'progress_callback':_0x119452}),Promise[_0x1b29fc(0x13d)]([this[_0x1b29fc(0x15e)],this[_0x1b29fc(0x144)],this[_0x1b29fc(0x13a)]]);}}async function load(){const _0x3951a3=a0_0x9ca3ec;self['postMessage']({'status':_0x3951a3(0x14f),'data':'Loading\x20model...'});const [_0x54de92,_0x3e0124,_0x372ff1]=await Florence2Singleton[_0x3951a3(0x13b)](_0x1ef1b9=>{const _0x277e1e=_0x3951a3;self[_0x277e1e(0x158)](_0x1ef1b9);});self[_0x3951a3(0x158)]({'status':_0x3951a3(0x14f),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x4b6739=_0x3e0124('a'),_0x51c06b=full([0x1,0x3,0x300,0x300],0x0);await _0x54de92['generate']({..._0x4b6739,'pixel_values':_0x51c06b,'max_new_tokens':0x1}),self[_0x3951a3(0x158)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x9ca3ec(0x154)];function a0_0x5bce(){const _0x39eebe=['48EnwCJh','fromURL','gpu','webgpu','addEventListener','data','loading','includes','14DgypJx','construct_prompts','10cuVmxf','<CAPTION_TO_PHRASE_GROUNDING>','size','130tgAHZm','generate','postMessage','now','40530tHxnsV','shader-f16','4BiXrST','15526908BhbwXC','model','onnx-community/Florence-2-base-ft','supports_fp16','processor','getInstance','1107224CjydBm','all','fp16','from_pretrained','5297JDEIKD','263604oTZjfL','1146912ELILNB','has','tokenizer','17880104YSWcJJ','model_id','batch_decode','fp32'];a0_0x5bce=function(){return _0x39eebe;};return a0_0x5bce();}let vision_inputs,image_size;function a0_0x5312(_0x298505,_0x1e142d){const _0x5bce03=a0_0x5bce();return a0_0x5312=function(_0x531284,_0x401455){_0x531284=_0x531284-0x138;let _0x3c98a2=_0x5bce03[_0x531284];return _0x3c98a2;},a0_0x5312(_0x298505,_0x1e142d);}async function run({text:_0x53b641,url:_0x30b814,task:_0x202d5e}){const _0x39106b=a0_0x9ca3ec,[_0xddf219,_0x28adc1,_0x32c576]=await Florence2Singleton['getInstance'](),_0x3935a3=performance['now']();if(!vision_inputs){const _0x4601e9=await RawImage[_0x39106b(0x14a)](_0x30b814);image_size=_0x4601e9[_0x39106b(0x155)],vision_inputs=await _0x32c576(_0x4601e9);}let _0x4f3c12=_0x202d5e;TASKS_WITH_INPUTS[_0x39106b(0x150)](_0x202d5e)&&_0x53b641&&(_0x4f3c12+=_0x53b641);const _0x18c348=_0x28adc1(_0x32c576[_0x39106b(0x152)](_0x4f3c12)),_0x45046b=await _0xddf219[_0x39106b(0x157)]({..._0x18c348,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x59e248=_0x28adc1[_0x39106b(0x147)](_0x45046b,{'skip_special_tokens':!0x1})[0x0],_0x2af4ce=_0x32c576['post_process_generation'](_0x59e248,_0x202d5e,image_size),_0x544721=performance[_0x39106b(0x159)]();self[_0x39106b(0x158)]({'status':'complete','result':_0x2af4ce,'time':_0x544721-_0x3935a3});}self[a0_0x9ca3ec(0x14d)]('message',async _0x4769d7=>{const _0xf91c3=a0_0x9ca3ec,{type:_0x1e70dc,data:_0x499f6d}=_0x4769d7[_0xf91c3(0x14e)];switch(_0x1e70dc){case'load':load();break;case'run':run(_0x499f6d);break;case'reset':vision_inputs=image_size=null;}});