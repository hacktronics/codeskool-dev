const a0_0x3a3f05=a0_0x22cc;(function(_0x38ad59,_0x2c2f63){const _0x37ba32=a0_0x22cc,_0x21b495=_0x38ad59();while(!![]){try{const _0x21070c=parseInt(_0x37ba32(0x118))/0x1*(parseInt(_0x37ba32(0x10f))/0x2)+-parseInt(_0x37ba32(0x120))/0x3+-parseInt(_0x37ba32(0x115))/0x4+-parseInt(_0x37ba32(0x121))/0x5*(parseInt(_0x37ba32(0x11c))/0x6)+-parseInt(_0x37ba32(0x10d))/0x7+-parseInt(_0x37ba32(0x126))/0x8+parseInt(_0x37ba32(0x12e))/0x9;if(_0x21070c===_0x2c2f63)break;else _0x21b495['push'](_0x21b495['shift']());}catch(_0x46d590){_0x21b495['push'](_0x21b495['shift']());}}}(a0_0x5ad2,0x33646));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x3e5772=a0_0x22cc;try{return(await navigator[_0x3e5772(0x12c)][_0x3e5772(0x114)]())[_0x3e5772(0x12d)]['has'](_0x3e5772(0x129));}catch(_0x551ccc){return!0x1;}}class Florence2Singleton{static [a0_0x3a3f05(0x123)]='onnx-community/Florence-2-base-ft';static async[a0_0x3a3f05(0x116)](_0x20e781=null){const _0x3de560=a0_0x3a3f05;return this[_0x3de560(0x122)]??=AutoProcessor['from_pretrained'](this['model_id']),this['tokenizer']??=AutoTokenizer[_0x3de560(0x111)](this['model_id']),this[_0x3de560(0x12a)]??=await hasFp16(),this[_0x3de560(0x11e)]??=Florence2ForConditionalGeneration[_0x3de560(0x111)](this[_0x3de560(0x123)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':_0x3de560(0x10c),'vision_encoder':this[_0x3de560(0x12a)]?_0x3de560(0x11b):_0x3de560(0x10c),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x3de560(0x117),'progress_callback':_0x20e781}),Promise[_0x3de560(0x110)]([this[_0x3de560(0x11e)],this[_0x3de560(0x130)],this['processor']]);}}async function load(){const _0x50e7a2=a0_0x3a3f05;self[_0x50e7a2(0x113)]({'status':_0x50e7a2(0x125),'data':_0x50e7a2(0x11a)});const [_0x10b04f,_0x54d892,_0x45501a]=await Florence2Singleton[_0x50e7a2(0x116)](_0x4a39ec=>{const _0x22c5b8=_0x50e7a2;self[_0x22c5b8(0x113)](_0x4a39ec);});self['postMessage']({'status':_0x50e7a2(0x125),'data':_0x50e7a2(0x132)});const _0xe49152=_0x54d892('a'),_0x5cddc0=full([0x1,0x3,0x300,0x300],0x0);await _0x10b04f[_0x50e7a2(0x11f)]({..._0xe49152,'pixel_values':_0x5cddc0,'max_new_tokens':0x1}),self[_0x50e7a2(0x113)]({'status':_0x50e7a2(0x112)});}const TASKS_WITH_INPUTS=[a0_0x3a3f05(0x11d)];function a0_0x5ad2(){const _0x213548=['post_process_generation','shader-f16','supports_fp16','includes','gpu','features','5159646ZSysLW','now','tokenizer','complete','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','fromURL','fp32','570724xZLyqo','construct_prompts','2pkhZaY','all','from_pretrained','ready','postMessage','requestAdapter','208080xJBjDA','getInstance','webgpu','346814qCBlvO','addEventListener','Loading\x20model...','fp16','42YjxDLi','<CAPTION_TO_PHRASE_GROUNDING>','model','generate','828222hXhRnR','65345xRjglY','processor','model_id','message','loading','1667976gDzhxD','batch_decode'];a0_0x5ad2=function(){return _0x213548;};return a0_0x5ad2();}let vision_inputs,image_size;async function run({text:_0x2e2bc9,url:_0x15ac1b,task:_0x555aed}){const _0x22c68c=a0_0x3a3f05,[_0x1eb5b0,_0x401edc,_0x2ee44c]=await Florence2Singleton[_0x22c68c(0x116)](),_0x567bc1=performance[_0x22c68c(0x12f)]();if(!vision_inputs){const _0x544552=await RawImage[_0x22c68c(0x133)](_0x15ac1b);image_size=_0x544552['size'],vision_inputs=await _0x2ee44c(_0x544552);}let _0x1b9858=_0x555aed;TASKS_WITH_INPUTS[_0x22c68c(0x12b)](_0x555aed)&&_0x2e2bc9&&(_0x1b9858+=_0x2e2bc9);const _0x5efd50=_0x401edc(_0x2ee44c[_0x22c68c(0x10e)](_0x1b9858)),_0x494b5f=await _0x1eb5b0[_0x22c68c(0x11f)]({..._0x5efd50,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x5bc7e6=_0x401edc[_0x22c68c(0x127)](_0x494b5f,{'skip_special_tokens':!0x1})[0x0],_0x2f902f=_0x2ee44c[_0x22c68c(0x128)](_0x5bc7e6,_0x555aed,image_size),_0xf718ab=performance[_0x22c68c(0x12f)]();self['postMessage']({'status':_0x22c68c(0x131),'result':_0x2f902f,'time':_0xf718ab-_0x567bc1});}function a0_0x22cc(_0x2f351c,_0x57ec36){const _0x5ad20d=a0_0x5ad2();return a0_0x22cc=function(_0x22cc8e,_0x49e6bf){_0x22cc8e=_0x22cc8e-0x10c;let _0x45baeb=_0x5ad20d[_0x22cc8e];return _0x45baeb;},a0_0x22cc(_0x2f351c,_0x57ec36);}self[a0_0x3a3f05(0x119)](a0_0x3a3f05(0x124),async _0x506685=>{const {type:_0x19dc7c,data:_0x8af90e}=_0x506685['data'];switch(_0x19dc7c){case'load':load();break;case'run':run(_0x8af90e);break;case'reset':vision_inputs=image_size=null;}});