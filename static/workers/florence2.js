const a0_0x4118cc=a0_0x2e99;(function(_0x7e0586,_0x2dd98b){const _0x47231e=a0_0x2e99,_0x53c670=_0x7e0586();while(!![]){try{const _0x4af0fa=parseInt(_0x47231e(0xaa))/0x1+-parseInt(_0x47231e(0x9d))/0x2+parseInt(_0x47231e(0x99))/0x3+-parseInt(_0x47231e(0xac))/0x4+-parseInt(_0x47231e(0xb9))/0x5+-parseInt(_0x47231e(0xb3))/0x6+parseInt(_0x47231e(0xb5))/0x7;if(_0x4af0fa===_0x2dd98b)break;else _0x53c670['push'](_0x53c670['shift']());}catch(_0x3933cc){_0x53c670['push'](_0x53c670['shift']());}}}(a0_0x14d0,0xf1ca1));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x5a5d76=a0_0x2e99;try{return(await navigator[_0x5a5d76(0x9c)][_0x5a5d76(0xb0)]())['features']['has'](_0x5a5d76(0xae));}catch(_0x254425){return!0x1;}}class Florence2Singleton{static [a0_0x4118cc(0xbe)]=a0_0x4118cc(0xa2);static async[a0_0x4118cc(0xa1)](_0xe40afb=null){const _0xed60f3=a0_0x4118cc;return this['processor']??=AutoProcessor[_0xed60f3(0xb2)](this[_0xed60f3(0xbe)]),this[_0xed60f3(0x9f)]??=AutoTokenizer[_0xed60f3(0xb2)](this[_0xed60f3(0xbe)]),this[_0xed60f3(0xa9)]??=await hasFp16(),this[_0xed60f3(0xb7)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0xed60f3(0xbe)],{'dtype':{'embed_tokens':this[_0xed60f3(0xa9)]?_0xed60f3(0xb1):_0xed60f3(0xbf),'vision_encoder':this[_0xed60f3(0xa9)]?_0xed60f3(0xb1):_0xed60f3(0xbf),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0xed60f3(0xb4),'progress_callback':_0xe40afb}),Promise[_0xed60f3(0xbc)]([this[_0xed60f3(0xb7)],this[_0xed60f3(0x9f)],this[_0xed60f3(0xab)]]);}}async function load(){const _0x1c8c7c=a0_0x4118cc;self[_0x1c8c7c(0xa4)]({'status':_0x1c8c7c(0x9a),'data':'Loading\x20model...'});const [_0x4eb5b3,_0x3ffdb3,_0x52b6a2]=await Florence2Singleton[_0x1c8c7c(0xa1)](_0x2f31b0=>{const _0x536b51=_0x1c8c7c;self[_0x536b51(0xa4)](_0x2f31b0);});self[_0x1c8c7c(0xa4)]({'status':'loading','data':_0x1c8c7c(0xb8)});const _0x46401c=_0x3ffdb3('a'),_0x58ffd3=full([0x1,0x3,0x300,0x300],0x0);await _0x4eb5b3[_0x1c8c7c(0xa8)]({..._0x46401c,'pixel_values':_0x58ffd3,'max_new_tokens':0x1}),self[_0x1c8c7c(0xa4)]({'status':_0x1c8c7c(0xa3)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x334726,url:_0x31d452,task:_0xb6310e}){const _0x16bcb7=a0_0x4118cc,[_0x364ac9,_0x4b6a18,_0x129c2b]=await Florence2Singleton[_0x16bcb7(0xa1)](),_0xdf491=performance[_0x16bcb7(0x9b)]();if(!vision_inputs){const _0x566ef8=await RawImage[_0x16bcb7(0xaf)](_0x31d452);image_size=_0x566ef8['size'],vision_inputs=await _0x129c2b(_0x566ef8);}let _0x54604c=_0xb6310e;TASKS_WITH_INPUTS[_0x16bcb7(0x9e)](_0xb6310e)&&_0x334726&&(_0x54604c+=_0x334726);const _0x25a92c=_0x4b6a18(_0x129c2b[_0x16bcb7(0xbb)](_0x54604c)),_0x35ed96=await _0x364ac9[_0x16bcb7(0xa8)]({..._0x25a92c,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x4ca2cd=_0x4b6a18[_0x16bcb7(0xa7)](_0x35ed96,{'skip_special_tokens':!0x1})[0x0],_0x178072=_0x129c2b[_0x16bcb7(0xb6)](_0x4ca2cd,_0xb6310e,image_size),_0x5c3581=performance['now']();self[_0x16bcb7(0xa4)]({'status':_0x16bcb7(0xa0),'result':_0x178072,'time':_0x5c3581-_0xdf491});}function a0_0x14d0(){const _0x1d4561=['860808PkRqoW','webgpu','4552380kzDlPc','post_process_generation','model','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','5008200KtErBr','addEventListener','construct_prompts','all','data','model_id','fp32','4838547AXuDMF','loading','now','gpu','1028692VJEmqq','includes','tokenizer','complete','getInstance','onnx-community/Florence-2-base-ft','ready','postMessage','run','reset','batch_decode','generate','supports_fp16','1259402fmkWxZ','processor','3491072cgvHmn','message','shader-f16','fromURL','requestAdapter','fp16','from_pretrained'];a0_0x14d0=function(){return _0x1d4561;};return a0_0x14d0();}function a0_0x2e99(_0x5785ef,_0x466677){const _0x14d073=a0_0x14d0();return a0_0x2e99=function(_0x2e9972,_0x27017c){_0x2e9972=_0x2e9972-0x99;let _0x13eaef=_0x14d073[_0x2e9972];return _0x13eaef;},a0_0x2e99(_0x5785ef,_0x466677);}self[a0_0x4118cc(0xba)](a0_0x4118cc(0xad),async _0x46ecc7=>{const _0x4455e9=a0_0x4118cc,{type:_0x479668,data:_0x382f89}=_0x46ecc7[_0x4455e9(0xbd)];switch(_0x479668){case'load':load();break;case _0x4455e9(0xa5):run(_0x382f89);break;case _0x4455e9(0xa6):vision_inputs=image_size=null;}});