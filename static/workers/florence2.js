const a0_0x574bf3=a0_0x4f64;(function(_0x31a016,_0xc6499f){const _0x3e9b9e=a0_0x4f64,_0x16e218=_0x31a016();while(!![]){try{const _0x3f0e5b=parseInt(_0x3e9b9e(0x1c8))/0x1*(parseInt(_0x3e9b9e(0x1ca))/0x2)+parseInt(_0x3e9b9e(0x1db))/0x3+-parseInt(_0x3e9b9e(0x1e2))/0x4+-parseInt(_0x3e9b9e(0x1e5))/0x5+parseInt(_0x3e9b9e(0x1c9))/0x6+parseInt(_0x3e9b9e(0x1e8))/0x7+parseInt(_0x3e9b9e(0x1ce))/0x8*(-parseInt(_0x3e9b9e(0x1c5))/0x9);if(_0x3f0e5b===_0xc6499f)break;else _0x16e218['push'](_0x16e218['shift']());}catch(_0x4ba50e){_0x16e218['push'](_0x16e218['shift']());}}}(a0_0x5f32,0x5c477));function a0_0x5f32(){const _0x489c99=['fp32','1642355FvVbIV','Loading\x20model...','complete','1408253mkvwQn','features','all','2007rHFJan','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','now','4iObVGf','1345860BYmZcI','175678XdaZIu','postMessage','generate','loading','4592xVYOxe','tokenizer','ready','processor','message','getInstance','fromURL','batch_decode','has','post_process_generation','onnx-community/Florence-2-base-ft','run','from_pretrained','1341501MudYGh','supports_fp16','model_id','<CAPTION_TO_PHRASE_GROUNDING>','fp16','requestAdapter','load','1558256tANtwe','data'];a0_0x5f32=function(){return _0x489c99;};return a0_0x5f32();}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3/dist/transformers.min.js';async function hasFp16(){const _0x14bde9=a0_0x4f64;try{return(await navigator['gpu'][_0x14bde9(0x1e0)]())[_0x14bde9(0x1e9)][_0x14bde9(0x1d6)]('shader-f16');}catch(_0x2766b5){return!0x1;}}class Florence2Singleton{static [a0_0x574bf3(0x1dd)]=a0_0x574bf3(0x1d8);static async[a0_0x574bf3(0x1d3)](_0x4c3e2a=null){const _0x4528e0=a0_0x574bf3;return this[_0x4528e0(0x1d1)]??=AutoProcessor[_0x4528e0(0x1da)](this['model_id']),this[_0x4528e0(0x1cf)]??=AutoTokenizer[_0x4528e0(0x1da)](this[_0x4528e0(0x1dd)]),this['supports_fp16']??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x4528e0(0x1da)](this['model_id'],{'dtype':{'embed_tokens':this[_0x4528e0(0x1dc)]?'fp16':'fp32','vision_encoder':this[_0x4528e0(0x1dc)]?_0x4528e0(0x1df):_0x4528e0(0x1e4),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x4c3e2a}),Promise[_0x4528e0(0x1c4)]([this['model'],this[_0x4528e0(0x1cf)],this['processor']]);}}async function load(){const _0x55cfea=a0_0x574bf3;self[_0x55cfea(0x1cb)]({'status':_0x55cfea(0x1cd),'data':_0x55cfea(0x1e6)});const [_0x2c1920,_0x1342ae,_0x37ea15]=await Florence2Singleton[_0x55cfea(0x1d3)](_0x4d3e6b=>{const _0x3e562a=_0x55cfea;self[_0x3e562a(0x1cb)](_0x4d3e6b);});self[_0x55cfea(0x1cb)]({'status':_0x55cfea(0x1cd),'data':_0x55cfea(0x1c6)});const _0x3a4356=_0x1342ae('a'),_0x350595=full([0x1,0x3,0x300,0x300],0x0);await _0x2c1920[_0x55cfea(0x1cc)]({..._0x3a4356,'pixel_values':_0x350595,'max_new_tokens':0x1}),self[_0x55cfea(0x1cb)]({'status':_0x55cfea(0x1d0)});}const TASKS_WITH_INPUTS=[a0_0x574bf3(0x1de)];let vision_inputs,image_size;function a0_0x4f64(_0x32debd,_0x6fad5){const _0x5f32d4=a0_0x5f32();return a0_0x4f64=function(_0x4f646e,_0x5a9b27){_0x4f646e=_0x4f646e-0x1c4;let _0xe84e1c=_0x5f32d4[_0x4f646e];return _0xe84e1c;},a0_0x4f64(_0x32debd,_0x6fad5);}async function run({text:_0x183855,url:_0x1f0132,task:_0x4e189d}){const _0x101e3e=a0_0x574bf3,[_0x20b08c,_0x943550,_0x1e0a4c]=await Florence2Singleton[_0x101e3e(0x1d3)](),_0xe3b581=performance['now']();if(!vision_inputs){const _0x2e34e3=await RawImage[_0x101e3e(0x1d4)](_0x1f0132);image_size=_0x2e34e3['size'],vision_inputs=await _0x1e0a4c(_0x2e34e3);}let _0x19003f=_0x4e189d;TASKS_WITH_INPUTS['includes'](_0x4e189d)&&_0x183855&&(_0x19003f+=_0x183855);const _0x1bb95a=_0x943550(_0x1e0a4c['construct_prompts'](_0x19003f)),_0x2b98ee=await _0x20b08c[_0x101e3e(0x1cc)]({..._0x1bb95a,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3ff4c5=_0x943550[_0x101e3e(0x1d5)](_0x2b98ee,{'skip_special_tokens':!0x1})[0x0],_0x22c422=_0x1e0a4c[_0x101e3e(0x1d7)](_0x3ff4c5,_0x4e189d,image_size),_0x209dd7=performance[_0x101e3e(0x1c7)]();self[_0x101e3e(0x1cb)]({'status':_0x101e3e(0x1e7),'result':_0x22c422,'time':_0x209dd7-_0xe3b581});}self['addEventListener'](a0_0x574bf3(0x1d2),async _0x318490=>{const _0x1f11aa=a0_0x574bf3,{type:_0x166928,data:_0x228828}=_0x318490[_0x1f11aa(0x1e3)];switch(_0x166928){case _0x1f11aa(0x1e1):load();break;case _0x1f11aa(0x1d9):run(_0x228828);break;case'reset':vision_inputs=image_size=null;}});