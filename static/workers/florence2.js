const a0_0x1653d3=a0_0x5604;(function(_0x17dfd8,_0x4814f8){const _0x484687=a0_0x5604,_0x595b2e=_0x17dfd8();while(!![]){try{const _0x3c9145=-parseInt(_0x484687(0x1e0))/0x1+-parseInt(_0x484687(0x1fa))/0x2*(parseInt(_0x484687(0x1ee))/0x3)+parseInt(_0x484687(0x1e2))/0x4+-parseInt(_0x484687(0x1e7))/0x5*(parseInt(_0x484687(0x1fe))/0x6)+-parseInt(_0x484687(0x1f3))/0x7*(-parseInt(_0x484687(0x1eb))/0x8)+parseInt(_0x484687(0x207))/0x9*(-parseInt(_0x484687(0x208))/0xa)+-parseInt(_0x484687(0x1e4))/0xb*(-parseInt(_0x484687(0x20c))/0xc);if(_0x3c9145===_0x4814f8)break;else _0x595b2e['push'](_0x595b2e['shift']());}catch(_0x2323be){_0x595b2e['push'](_0x595b2e['shift']());}}}(a0_0x3806,0x42abf));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x5604(_0x5e79a0,_0x40e5c3){const _0x380619=a0_0x3806();return a0_0x5604=function(_0x560434,_0x3e4451){_0x560434=_0x560434-0x1e0;let _0x3bb14a=_0x380619[_0x560434];return _0x3bb14a;},a0_0x5604(_0x5e79a0,_0x40e5c3);}async function hasFp16(){const _0x3a1782=a0_0x5604;try{return(await navigator['gpu'][_0x3a1782(0x1ed)]())[_0x3a1782(0x1ea)][_0x3a1782(0x1e1)](_0x3a1782(0x1f8));}catch(_0x4acc3f){return!0x1;}}class Florence2Singleton{static [a0_0x1653d3(0x20d)]=a0_0x1653d3(0x1e6);static async['getInstance'](_0x14eaee=null){const _0x5c8321=a0_0x1653d3;return this[_0x5c8321(0x1e3)]??=AutoProcessor[_0x5c8321(0x1f7)](this[_0x5c8321(0x20d)]),this[_0x5c8321(0x205)]??=AutoTokenizer[_0x5c8321(0x1f7)](this[_0x5c8321(0x20d)]),this['supports_fp16']??=await hasFp16(),this[_0x5c8321(0x20a)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x5c8321(0x20d)],{'dtype':{'embed_tokens':this[_0x5c8321(0x1ec)]?_0x5c8321(0x204):_0x5c8321(0x1ef),'vision_encoder':this[_0x5c8321(0x1ec)]?_0x5c8321(0x204):_0x5c8321(0x1ef),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5c8321(0x1f6),'progress_callback':_0x14eaee}),Promise[_0x5c8321(0x1f1)]([this[_0x5c8321(0x20a)],this[_0x5c8321(0x205)],this['processor']]);}}async function load(){const _0x368a87=a0_0x1653d3;self[_0x368a87(0x1f4)]({'status':'loading','data':_0x368a87(0x201)});const [_0x18631a,_0x235b6e,_0x6b236d]=await Florence2Singleton[_0x368a87(0x1ff)](_0x16d027=>{const _0x41ece1=_0x368a87;self[_0x41ece1(0x1f4)](_0x16d027);});self['postMessage']({'status':'loading','data':_0x368a87(0x1f0)});const _0xa0a6ef=_0x235b6e('a'),_0x5cc2ea=full([0x1,0x3,0x300,0x300],0x0);await _0x18631a['generate']({..._0xa0a6ef,'pixel_values':_0x5cc2ea,'max_new_tokens':0x1}),self[_0x368a87(0x1f4)]({'status':_0x368a87(0x1fd)});}const TASKS_WITH_INPUTS=[a0_0x1653d3(0x200)];let vision_inputs,image_size;async function run({text:_0x2a333c,url:_0x5e3e7c,task:_0x898b0d}){const _0x586a36=a0_0x1653d3,[_0x3d7230,_0x204be2,_0x97ecd9]=await Florence2Singleton[_0x586a36(0x1ff)](),_0x1bdb12=performance['now']();if(!vision_inputs){const _0x3fbcda=await RawImage[_0x586a36(0x1f5)](_0x5e3e7c);image_size=_0x3fbcda[_0x586a36(0x1f2)],vision_inputs=await _0x97ecd9(_0x3fbcda);}let _0x461ddb=_0x898b0d;TASKS_WITH_INPUTS[_0x586a36(0x1e9)](_0x898b0d)&&_0x2a333c&&(_0x461ddb+=_0x2a333c);const _0x1b9821=_0x204be2(_0x97ecd9['construct_prompts'](_0x461ddb)),_0x3f7319=await _0x3d7230[_0x586a36(0x203)]({..._0x1b9821,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3e60db=_0x204be2[_0x586a36(0x202)](_0x3f7319,{'skip_special_tokens':!0x1})[0x0],_0xb43585=_0x97ecd9[_0x586a36(0x1e5)](_0x3e60db,_0x898b0d,image_size),_0x16be08=performance[_0x586a36(0x206)]();self[_0x586a36(0x1f4)]({'status':_0x586a36(0x1fc),'result':_0xb43585,'time':_0x16be08-_0x1bdb12});}function a0_0x3806(){const _0x36a729=['fp32','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','all','size','7xdEjRA','postMessage','fromURL','webgpu','from_pretrained','shader-f16','data','2mDYAnQ','run','complete','ready','846QDnGcm','getInstance','<CAPTION_TO_PHRASE_GROUNDING>','Loading\x20model...','batch_decode','generate','fp16','tokenizer','now','63oVSIsb','56930Avjfbs','addEventListener','model','load','9147696CBLLQg','model_id','435031nnEWFy','has','1155880fZDYce','processor','11IXMcjR','post_process_generation','onnx-community/Florence-2-base-ft','12355WZanrw','message','includes','features','3762488VnImxL','supports_fp16','requestAdapter','1275627FJIzfl'];a0_0x3806=function(){return _0x36a729;};return a0_0x3806();}self[a0_0x1653d3(0x209)](a0_0x1653d3(0x1e8),async _0x1e9f17=>{const _0x224017=a0_0x1653d3,{type:_0x3cf2b4,data:_0x42d55d}=_0x1e9f17[_0x224017(0x1f9)];switch(_0x3cf2b4){case _0x224017(0x20b):load();break;case _0x224017(0x1fb):run(_0x42d55d);break;case'reset':vision_inputs=image_size=null;}});