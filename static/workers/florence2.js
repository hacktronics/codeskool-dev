const a0_0x1b58e9=a0_0x1447;(function(_0x4eca6d,_0x715f1e){const _0x533986=a0_0x1447,_0x259cf5=_0x4eca6d();while(!![]){try{const _0x3b8f3b=parseInt(_0x533986(0xd9))/0x1*(parseInt(_0x533986(0xdb))/0x2)+parseInt(_0x533986(0xe3))/0x3+parseInt(_0x533986(0xcf))/0x4*(-parseInt(_0x533986(0xc1))/0x5)+-parseInt(_0x533986(0xd1))/0x6+parseInt(_0x533986(0xdd))/0x7+parseInt(_0x533986(0xe4))/0x8*(-parseInt(_0x533986(0xcd))/0x9)+parseInt(_0x533986(0xd8))/0xa;if(_0x3b8f3b===_0x715f1e)break;else _0x259cf5['push'](_0x259cf5['shift']());}catch(_0x11ed73){_0x259cf5['push'](_0x259cf5['shift']());}}}(a0_0x3510,0xaf79a));function a0_0x3510(){const _0x566743=['all','model_id','fp32','fromURL','fp16','21405080ESDRgz','566UtssxE','processor','1010lgmfhm','now','4325230ONYeJk','load','model','includes','supports_fp16','message','810399VGgfQn','120JhmIOF','ready','batch_decode','tokenizer','from_pretrained','construct_prompts','shader-f16','onnx-community/Florence-2-base-ft','3435XFohlB','post_process_generation','features','gpu','getInstance','run','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','requestAdapter','addEventListener','generate','Loading\x20model...','<CAPTION_TO_PHRASE_GROUNDING>','712683yLeEjQ','data','1004iFZkQR','has','7412238HCjOQg','postMessage'];a0_0x3510=function(){return _0x566743;};return a0_0x3510();}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x1447(_0x3d1c07,_0x331fae){const _0x3510ce=a0_0x3510();return a0_0x1447=function(_0x1447ca,_0x3ca059){_0x1447ca=_0x1447ca-0xba;let _0x5a0d44=_0x3510ce[_0x1447ca];return _0x5a0d44;},a0_0x1447(_0x3d1c07,_0x331fae);}async function hasFp16(){const _0x29a9de=a0_0x1447;try{return(await navigator[_0x29a9de(0xc4)][_0x29a9de(0xc8)]())[_0x29a9de(0xc3)][_0x29a9de(0xd0)](_0x29a9de(0xbf));}catch(_0x251dff){return!0x1;}}class Florence2Singleton{static [a0_0x1b58e9(0xd4)]=a0_0x1b58e9(0xc0);static async[a0_0x1b58e9(0xc5)](_0x1ea514=null){const _0x36ec43=a0_0x1b58e9;return this[_0x36ec43(0xda)]??=AutoProcessor['from_pretrained'](this[_0x36ec43(0xd4)]),this['tokenizer']??=AutoTokenizer[_0x36ec43(0xbd)](this[_0x36ec43(0xd4)]),this[_0x36ec43(0xe1)]??=await hasFp16(),this[_0x36ec43(0xdf)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x36ec43(0xd4)],{'dtype':{'embed_tokens':this[_0x36ec43(0xe1)]?_0x36ec43(0xd7):'fp32','vision_encoder':this[_0x36ec43(0xe1)]?_0x36ec43(0xd7):_0x36ec43(0xd5),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x1ea514}),Promise[_0x36ec43(0xd3)]([this['model'],this[_0x36ec43(0xbc)],this['processor']]);}}async function load(){const _0x3a4d4b=a0_0x1b58e9;self['postMessage']({'status':'loading','data':_0x3a4d4b(0xcb)});const [_0x19f2df,_0x4742d5,_0x3a0eec]=await Florence2Singleton[_0x3a4d4b(0xc5)](_0x2961b3=>{const _0x1e1657=_0x3a4d4b;self[_0x1e1657(0xd2)](_0x2961b3);});self['postMessage']({'status':'loading','data':_0x3a4d4b(0xc7)});const _0x22a501=_0x4742d5('a'),_0x593d14=full([0x1,0x3,0x300,0x300],0x0);await _0x19f2df[_0x3a4d4b(0xca)]({..._0x22a501,'pixel_values':_0x593d14,'max_new_tokens':0x1}),self[_0x3a4d4b(0xd2)]({'status':_0x3a4d4b(0xba)});}const TASKS_WITH_INPUTS=[a0_0x1b58e9(0xcc)];let vision_inputs,image_size;async function run({text:_0x40402e,url:_0x5ac3e4,task:_0x3c595a}){const _0x41c53b=a0_0x1b58e9,[_0x29016a,_0x476828,_0x8747af]=await Florence2Singleton[_0x41c53b(0xc5)](),_0x1b038e=performance[_0x41c53b(0xdc)]();if(!vision_inputs){const _0x2d3c98=await RawImage[_0x41c53b(0xd6)](_0x5ac3e4);image_size=_0x2d3c98['size'],vision_inputs=await _0x8747af(_0x2d3c98);}let _0x10e2ba=_0x3c595a;TASKS_WITH_INPUTS[_0x41c53b(0xe0)](_0x3c595a)&&_0x40402e&&(_0x10e2ba+=_0x40402e);const _0x2bb568=_0x476828(_0x8747af[_0x41c53b(0xbe)](_0x10e2ba)),_0x33d40c=await _0x29016a[_0x41c53b(0xca)]({..._0x2bb568,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x474766=_0x476828[_0x41c53b(0xbb)](_0x33d40c,{'skip_special_tokens':!0x1})[0x0],_0x410df0=_0x8747af[_0x41c53b(0xc2)](_0x474766,_0x3c595a,image_size),_0xef8781=performance[_0x41c53b(0xdc)]();self['postMessage']({'status':'complete','result':_0x410df0,'time':_0xef8781-_0x1b038e});}self[a0_0x1b58e9(0xc9)](a0_0x1b58e9(0xe2),async _0x4c6410=>{const _0x19c436=a0_0x1b58e9,{type:_0x2f0403,data:_0x5cd099}=_0x4c6410[_0x19c436(0xce)];switch(_0x2f0403){case _0x19c436(0xde):load();break;case _0x19c436(0xc6):run(_0x5cd099);break;case'reset':vision_inputs=image_size=null;}});