const a0_0x546382=a0_0xc691;function a0_0x1fc5(){const _0x1c7eca=['webgpu','9205YabQRQ','processor','ready','onnx-community/Florence-2-base-ft','from_pretrained','fp16','fp32','data','generate','all','now','model','1203489NGcCTP','construct_prompts','96nUBjTI','shader-f16','Loading\x20model...','loading','postMessage','8WgqqCX','1579795FbrarU','20pAJHtr','85176ZzvrzF','run','775962Ohsiuj','model_id','addEventListener','load','fromURL','features','getInstance','complete','supports_fp16','1927110jcvTwY','116blZBzR','39ujeAaQ','reset','tokenizer','batch_decode','message','gpu','post_process_generation','82282dgBbyU','size','<CAPTION_TO_PHRASE_GROUNDING>','requestAdapter'];a0_0x1fc5=function(){return _0x1c7eca;};return a0_0x1fc5();}function a0_0xc691(_0x55d3a5,_0x5420cc){const _0x1fc5a9=a0_0x1fc5();return a0_0xc691=function(_0xc691c9,_0x6a24df){_0xc691c9=_0xc691c9-0x147;let _0x137703=_0x1fc5a9[_0xc691c9];return _0x137703;},a0_0xc691(_0x55d3a5,_0x5420cc);}(function(_0xf3d259,_0x322311){const _0x42eacb=a0_0xc691,_0x4afa07=_0xf3d259();while(!![]){try{const _0x36f87c=parseInt(_0x42eacb(0x175))/0x1+-parseInt(_0x42eacb(0x15a))/0x2*(-parseInt(_0x42eacb(0x153))/0x3)+parseInt(_0x42eacb(0x152))/0x4*(-parseInt(_0x42eacb(0x15f))/0x5)+-parseInt(_0x42eacb(0x151))/0x6+-parseInt(_0x42eacb(0x173))/0x7*(parseInt(_0x42eacb(0x172))/0x8)+parseInt(_0x42eacb(0x16b))/0x9*(-parseInt(_0x42eacb(0x174))/0xa)+-parseInt(_0x42eacb(0x148))/0xb*(-parseInt(_0x42eacb(0x16d))/0xc);if(_0x36f87c===_0x322311)break;else _0x4afa07['push'](_0x4afa07['shift']());}catch(_0x37d46d){_0x4afa07['push'](_0x4afa07['shift']());}}}(a0_0x1fc5,0x4d4e4));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x22ff64=a0_0xc691;try{return(await navigator[_0x22ff64(0x158)][_0x22ff64(0x15d)]())[_0x22ff64(0x14d)]['has'](_0x22ff64(0x16e));}catch(_0xcb3f7e){return!0x1;}}class Florence2Singleton{static [a0_0x546382(0x149)]=a0_0x546382(0x162);static async[a0_0x546382(0x14e)](_0x4ac9db=null){const _0x242f6e=a0_0x546382;return this['processor']??=AutoProcessor[_0x242f6e(0x163)](this[_0x242f6e(0x149)]),this[_0x242f6e(0x155)]??=AutoTokenizer[_0x242f6e(0x163)](this[_0x242f6e(0x149)]),this[_0x242f6e(0x150)]??=await hasFp16(),this[_0x242f6e(0x16a)]??=Florence2ForConditionalGeneration[_0x242f6e(0x163)](this[_0x242f6e(0x149)],{'dtype':{'embed_tokens':this[_0x242f6e(0x150)]?_0x242f6e(0x164):_0x242f6e(0x165),'vision_encoder':this[_0x242f6e(0x150)]?_0x242f6e(0x164):_0x242f6e(0x165),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x242f6e(0x15e),'progress_callback':_0x4ac9db}),Promise[_0x242f6e(0x168)]([this['model'],this[_0x242f6e(0x155)],this[_0x242f6e(0x160)]]);}}async function load(){const _0x7c3d29=a0_0x546382;self[_0x7c3d29(0x171)]({'status':'loading','data':_0x7c3d29(0x16f)});const [_0xdd5c62,_0x56d07b,_0x25fa8c]=await Florence2Singleton[_0x7c3d29(0x14e)](_0x3048a0=>{const _0x2be68b=_0x7c3d29;self[_0x2be68b(0x171)](_0x3048a0);});self[_0x7c3d29(0x171)]({'status':_0x7c3d29(0x170),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x54dd8b=_0x56d07b('a'),_0x166989=full([0x1,0x3,0x300,0x300],0x0);await _0xdd5c62['generate']({..._0x54dd8b,'pixel_values':_0x166989,'max_new_tokens':0x1}),self[_0x7c3d29(0x171)]({'status':_0x7c3d29(0x161)});}const TASKS_WITH_INPUTS=[a0_0x546382(0x15c)];let vision_inputs,image_size;async function run({text:_0x1e16a7,url:_0x3b4ee9,task:_0x3b0b86}){const _0x3a921b=a0_0x546382,[_0x3e2fb3,_0x4b76d4,_0xaa2f8e]=await Florence2Singleton[_0x3a921b(0x14e)](),_0x1c442b=performance[_0x3a921b(0x169)]();if(!vision_inputs){const _0x296c24=await RawImage[_0x3a921b(0x14c)](_0x3b4ee9);image_size=_0x296c24[_0x3a921b(0x15b)],vision_inputs=await _0xaa2f8e(_0x296c24);}let _0x1ac99b=_0x3b0b86;TASKS_WITH_INPUTS['includes'](_0x3b0b86)&&_0x1e16a7&&(_0x1ac99b+=_0x1e16a7);const _0x4dc762=_0x4b76d4(_0xaa2f8e[_0x3a921b(0x16c)](_0x1ac99b)),_0x17b434=await _0x3e2fb3[_0x3a921b(0x167)]({..._0x4dc762,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x4f1ec0=_0x4b76d4[_0x3a921b(0x156)](_0x17b434,{'skip_special_tokens':!0x1})[0x0],_0x204f5c=_0xaa2f8e[_0x3a921b(0x159)](_0x4f1ec0,_0x3b0b86,image_size),_0x5882e6=performance[_0x3a921b(0x169)]();self[_0x3a921b(0x171)]({'status':_0x3a921b(0x14f),'result':_0x204f5c,'time':_0x5882e6-_0x1c442b});}self[a0_0x546382(0x14a)](a0_0x546382(0x157),async _0x2e98d4=>{const _0x3a2b09=a0_0x546382,{type:_0x2fc8fa,data:_0x17a61f}=_0x2e98d4[_0x3a2b09(0x166)];switch(_0x2fc8fa){case _0x3a2b09(0x14b):load();break;case _0x3a2b09(0x147):run(_0x17a61f);break;case _0x3a2b09(0x154):vision_inputs=image_size=null;}});