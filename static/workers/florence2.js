const a0_0x14621c=a0_0x5bc4;(function(_0xfd5b73,_0x4b15df){const _0x2f5e9a=a0_0x5bc4,_0x56d9b6=_0xfd5b73();while(!![]){try{const _0xb503d9=-parseInt(_0x2f5e9a(0x177))/0x1+-parseInt(_0x2f5e9a(0x15d))/0x2*(-parseInt(_0x2f5e9a(0x17a))/0x3)+-parseInt(_0x2f5e9a(0x161))/0x4*(-parseInt(_0x2f5e9a(0x16d))/0x5)+-parseInt(_0x2f5e9a(0x173))/0x6+parseInt(_0x2f5e9a(0x17d))/0x7+-parseInt(_0x2f5e9a(0x167))/0x8+-parseInt(_0x2f5e9a(0x17f))/0x9*(parseInt(_0x2f5e9a(0x17e))/0xa);if(_0xb503d9===_0x4b15df)break;else _0x56d9b6['push'](_0x56d9b6['shift']());}catch(_0x5396f0){_0x56d9b6['push'](_0x56d9b6['shift']());}}}(a0_0x5aec,0xbd8c9));function a0_0x5bc4(_0x389088,_0x3d467e){const _0x5aec9c=a0_0x5aec();return a0_0x5bc4=function(_0x5bc4b9,_0x4f6b0d){_0x5bc4b9=_0x5bc4b9-0x15d;let _0x37440d=_0x5aec9c[_0x5bc4b9];return _0x37440d;},a0_0x5bc4(_0x389088,_0x3d467e);}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x39880d=a0_0x5bc4;try{return(await navigator['gpu'][_0x39880d(0x15e)]())[_0x39880d(0x17c)][_0x39880d(0x171)]('shader-f16');}catch(_0x48fc7a){return!0x1;}}class Florence2Singleton{static [a0_0x14621c(0x174)]=a0_0x14621c(0x16b);static async[a0_0x14621c(0x16e)](_0x3dfd7e=null){const _0x85a509=a0_0x14621c;return this[_0x85a509(0x168)]??=AutoProcessor[_0x85a509(0x169)](this[_0x85a509(0x174)]),this[_0x85a509(0x170)]??=AutoTokenizer[_0x85a509(0x169)](this['model_id']),this['supports_fp16']??=await hasFp16(),this[_0x85a509(0x179)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x85a509(0x174)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':'fp32','vision_encoder':this['supports_fp16']?'fp16':_0x85a509(0x16f),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x3dfd7e}),Promise['all']([this[_0x85a509(0x179)],this[_0x85a509(0x170)],this['processor']]);}}function a0_0x5aec(){const _0x521508=['1121832VvBWJV','post_process_generation','load','generate','ready','includes','3634408rAeYvy','processor','from_pretrained','<CAPTION_TO_PHRASE_GROUNDING>','onnx-community/Florence-2-base-ft','now','15fyNxtl','getInstance','fp32','tokenizer','has','postMessage','2318580deULGy','model_id','data','addEventListener','991554WlSAOT','run','model','4128414PKcPYp','fromURL','features','2827804XxhIle','380ZQkNWD','3033KButvh','2GWnEea','requestAdapter','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','loading'];a0_0x5aec=function(){return _0x521508;};return a0_0x5aec();}async function load(){const _0x4cdecc=a0_0x14621c;self['postMessage']({'status':_0x4cdecc(0x160),'data':'Loading\x20model...'});const [_0x1f54b9,_0x188000,_0x4040c5]=await Florence2Singleton[_0x4cdecc(0x16e)](_0x589e68=>{const _0x5e27f2=_0x4cdecc;self[_0x5e27f2(0x172)](_0x589e68);});self['postMessage']({'status':_0x4cdecc(0x160),'data':_0x4cdecc(0x15f)});const _0x5ce872=_0x188000('a'),_0x543b1a=full([0x1,0x3,0x300,0x300],0x0);await _0x1f54b9['generate']({..._0x5ce872,'pixel_values':_0x543b1a,'max_new_tokens':0x1}),self[_0x4cdecc(0x172)]({'status':_0x4cdecc(0x165)});}const TASKS_WITH_INPUTS=[a0_0x14621c(0x16a)];let vision_inputs,image_size;async function run({text:_0x31cfb8,url:_0xd47fdc,task:_0x3be2fd}){const _0x3ee791=a0_0x14621c,[_0x349903,_0x33b674,_0x2d31b4]=await Florence2Singleton[_0x3ee791(0x16e)](),_0xaad546=performance[_0x3ee791(0x16c)]();if(!vision_inputs){const _0xeba016=await RawImage[_0x3ee791(0x17b)](_0xd47fdc);image_size=_0xeba016['size'],vision_inputs=await _0x2d31b4(_0xeba016);}let _0x20b406=_0x3be2fd;TASKS_WITH_INPUTS[_0x3ee791(0x166)](_0x3be2fd)&&_0x31cfb8&&(_0x20b406+=_0x31cfb8);const _0x36d26d=_0x33b674(_0x2d31b4['construct_prompts'](_0x20b406)),_0x4c9a2d=await _0x349903[_0x3ee791(0x164)]({..._0x36d26d,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3eb4d2=_0x33b674['batch_decode'](_0x4c9a2d,{'skip_special_tokens':!0x1})[0x0],_0x3e2667=_0x2d31b4[_0x3ee791(0x162)](_0x3eb4d2,_0x3be2fd,image_size),_0x1b9fff=performance['now']();self[_0x3ee791(0x172)]({'status':'complete','result':_0x3e2667,'time':_0x1b9fff-_0xaad546});}self[a0_0x14621c(0x176)]('message',async _0x33e88e=>{const _0x5bd651=a0_0x14621c,{type:_0x4eeb10,data:_0x339be1}=_0x33e88e[_0x5bd651(0x175)];switch(_0x4eeb10){case _0x5bd651(0x163):load();break;case _0x5bd651(0x178):run(_0x339be1);break;case'reset':vision_inputs=image_size=null;}});