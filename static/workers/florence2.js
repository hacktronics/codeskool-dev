const a0_0x2032c8=a0_0x3a89;function a0_0x18cf(){const _0x2dd4c9=['20ykvsVl','webgpu','7893243JgtHmE','post_process_generation','1135048JPQiDj','1AyDNZv','onnx-community/Florence-2-base-ft','fromURL','reset','shader-f16','generate','supports_fp16','3061955qQNhKU','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','addEventListener','from_pretrained','tokenizer','data','load','size','loading','getInstance','3YdGydl','474RVEXyr','fp16','has','processor','67277RbjbLW','fp32','postMessage','8tkMSBp','run','model_id','5648599KnQfGV','requestAdapter','model','gpu','all','features','16836228NOvIWs','974026kTRmjC','now','complete','ready','<CAPTION_TO_PHRASE_GROUNDING>','includes'];a0_0x18cf=function(){return _0x2dd4c9;};return a0_0x18cf();}(function(_0x541e77,_0x2f3e30){const _0x2ab9b2=a0_0x3a89,_0x506099=_0x541e77();while(!![]){try{const _0x4cf5d8=-parseInt(_0x2ab9b2(0x14d))/0x1*(-parseInt(_0x2ab9b2(0x142))/0x2)+-parseInt(_0x2ab9b2(0x15e))/0x3*(-parseInt(_0x2ab9b2(0x14c))/0x4)+parseInt(_0x2ab9b2(0x154))/0x5+-parseInt(_0x2ab9b2(0x15f))/0x6*(-parseInt(_0x2ab9b2(0x163))/0x7)+parseInt(_0x2ab9b2(0x166))/0x8*(parseInt(_0x2ab9b2(0x14a))/0x9)+-parseInt(_0x2ab9b2(0x148))/0xa*(parseInt(_0x2ab9b2(0x169))/0xb)+-parseInt(_0x2ab9b2(0x141))/0xc;if(_0x4cf5d8===_0x2f3e30)break;else _0x506099['push'](_0x506099['shift']());}catch(_0x26c3fc){_0x506099['push'](_0x506099['shift']());}}}(a0_0x18cf,0x8fe71));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x2716f9=a0_0x3a89;try{return(await navigator[_0x2716f9(0x16c)][_0x2716f9(0x16a)]())[_0x2716f9(0x140)][_0x2716f9(0x161)](_0x2716f9(0x151));}catch(_0x1dfb43){return!0x1;}}class Florence2Singleton{static [a0_0x2032c8(0x168)]=a0_0x2032c8(0x14e);static async[a0_0x2032c8(0x15d)](_0x4f543e=null){const _0x195963=a0_0x2032c8;return this[_0x195963(0x162)]??=AutoProcessor[_0x195963(0x157)](this['model_id']),this[_0x195963(0x158)]??=AutoTokenizer[_0x195963(0x157)](this[_0x195963(0x168)]),this[_0x195963(0x153)]??=await hasFp16(),this[_0x195963(0x16b)]??=Florence2ForConditionalGeneration[_0x195963(0x157)](this[_0x195963(0x168)],{'dtype':{'embed_tokens':this[_0x195963(0x153)]?_0x195963(0x160):'fp32','vision_encoder':this[_0x195963(0x153)]?_0x195963(0x160):_0x195963(0x164),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x195963(0x149),'progress_callback':_0x4f543e}),Promise[_0x195963(0x16d)]([this[_0x195963(0x16b)],this[_0x195963(0x158)],this[_0x195963(0x162)]]);}}async function load(){const _0x2267a0=a0_0x2032c8;self['postMessage']({'status':_0x2267a0(0x15c),'data':'Loading\x20model...'});const [_0x3a8d75,_0x37922f,_0x298d49]=await Florence2Singleton[_0x2267a0(0x15d)](_0x403392=>{self['postMessage'](_0x403392);});self['postMessage']({'status':_0x2267a0(0x15c),'data':_0x2267a0(0x155)});const _0x2c3c53=_0x37922f('a'),_0x960b98=full([0x1,0x3,0x300,0x300],0x0);await _0x3a8d75[_0x2267a0(0x152)]({..._0x2c3c53,'pixel_values':_0x960b98,'max_new_tokens':0x1}),self['postMessage']({'status':_0x2267a0(0x145)});}function a0_0x3a89(_0x5590a9,_0x4164dc){const _0x18cf72=a0_0x18cf();return a0_0x3a89=function(_0x3a8953,_0x361f3d){_0x3a8953=_0x3a8953-0x140;let _0x1c3db6=_0x18cf72[_0x3a8953];return _0x1c3db6;},a0_0x3a89(_0x5590a9,_0x4164dc);}const TASKS_WITH_INPUTS=[a0_0x2032c8(0x146)];let vision_inputs,image_size;async function run({text:_0x301949,url:_0x206a05,task:_0x46f395}){const _0x42a9ab=a0_0x2032c8,[_0x59debd,_0x3694f7,_0x289ab3]=await Florence2Singleton[_0x42a9ab(0x15d)](),_0x2c01be=performance['now']();if(!vision_inputs){const _0x18b994=await RawImage[_0x42a9ab(0x14f)](_0x206a05);image_size=_0x18b994[_0x42a9ab(0x15b)],vision_inputs=await _0x289ab3(_0x18b994);}let _0x4aed0a=_0x46f395;TASKS_WITH_INPUTS[_0x42a9ab(0x147)](_0x46f395)&&_0x301949&&(_0x4aed0a+=_0x301949);const _0x38694d=_0x3694f7(_0x289ab3['construct_prompts'](_0x4aed0a)),_0x459a09=await _0x59debd['generate']({..._0x38694d,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x2bf37e=_0x3694f7['batch_decode'](_0x459a09,{'skip_special_tokens':!0x1})[0x0],_0x1da0a5=_0x289ab3[_0x42a9ab(0x14b)](_0x2bf37e,_0x46f395,image_size),_0x542794=performance[_0x42a9ab(0x143)]();self[_0x42a9ab(0x165)]({'status':_0x42a9ab(0x144),'result':_0x1da0a5,'time':_0x542794-_0x2c01be});}self[a0_0x2032c8(0x156)]('message',async _0x493497=>{const _0x464ff6=a0_0x2032c8,{type:_0xa7ce84,data:_0x2c6b4d}=_0x493497[_0x464ff6(0x159)];switch(_0xa7ce84){case _0x464ff6(0x15a):load();break;case _0x464ff6(0x167):run(_0x2c6b4d);break;case _0x464ff6(0x150):vision_inputs=image_size=null;}});