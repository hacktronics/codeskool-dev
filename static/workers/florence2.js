const a0_0x7234a6=a0_0x4f3b;function a0_0x7cf0(){const _0x2becba=['onnx-community/Florence-2-base-ft','shader-f16','addEventListener','requestAdapter','features','post_process_generation','3415455sKyquZ','1884474CxXADE','260685nfHDVu','from_pretrained','postMessage','102qyDnSl','complete','now','getInstance','fp32','message','size','supports_fp16','<CAPTION_TO_PHRASE_GROUNDING>','696964uGTYss','fromURL','generate','5ONddFp','667338gGWSuz','204384PjfzBH','fp16','loading','5659GUAdiL','construct_prompts','tokenizer','all','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','model_id','run','data','model','load','reset','webgpu','processor'];a0_0x7cf0=function(){return _0x2becba;};return a0_0x7cf0();}function a0_0x4f3b(_0x5c00d9,_0x1fbc90){const _0x7cf07f=a0_0x7cf0();return a0_0x4f3b=function(_0x4f3b9a,_0x1477b8){_0x4f3b9a=_0x4f3b9a-0x95;let _0x5172b8=_0x7cf07f[_0x4f3b9a];return _0x5172b8;},a0_0x4f3b(_0x5c00d9,_0x1fbc90);}(function(_0x1689df,_0x1791d6){const _0x10e47d=a0_0x4f3b,_0x469c04=_0x1689df();while(!![]){try{const _0x345633=parseInt(_0x10e47d(0xac))/0x1*(-parseInt(_0x10e47d(0x9b))/0x2)+parseInt(_0x10e47d(0x98))/0x3+parseInt(_0x10e47d(0xa4))/0x4+-parseInt(_0x10e47d(0xa7))/0x5*(parseInt(_0x10e47d(0x97))/0x6)+parseInt(_0x10e47d(0xa8))/0x7+parseInt(_0x10e47d(0xa9))/0x8+parseInt(_0x10e47d(0x96))/0x9;if(_0x345633===_0x1791d6)break;else _0x469c04['push'](_0x469c04['shift']());}catch(_0x29cf5c){_0x469c04['push'](_0x469c04['shift']());}}}(a0_0x7cf0,0x26c69));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x186924=a0_0x4f3b;try{return(await navigator['gpu'][_0x186924(0xbc)]())[_0x186924(0xbd)]['has'](_0x186924(0xba));}catch(_0x114c3c){return!0x1;}}class Florence2Singleton{static [a0_0x7234a6(0xb1)]=a0_0x7234a6(0xb9);static async[a0_0x7234a6(0x9e)](_0x1fe9c9=null){const _0x43944d=a0_0x7234a6;return this[_0x43944d(0xb8)]??=AutoProcessor[_0x43944d(0x99)](this[_0x43944d(0xb1)]),this['tokenizer']??=AutoTokenizer[_0x43944d(0x99)](this[_0x43944d(0xb1)]),this['supports_fp16']??=await hasFp16(),this[_0x43944d(0xb4)]??=Florence2ForConditionalGeneration[_0x43944d(0x99)](this[_0x43944d(0xb1)],{'dtype':{'embed_tokens':this['supports_fp16']?'fp16':'fp32','vision_encoder':this[_0x43944d(0xa2)]?_0x43944d(0xaa):_0x43944d(0x9f),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x43944d(0xb7),'progress_callback':_0x1fe9c9}),Promise[_0x43944d(0xaf)]([this[_0x43944d(0xb4)],this[_0x43944d(0xae)],this[_0x43944d(0xb8)]]);}}async function load(){const _0x33e2fc=a0_0x7234a6;self[_0x33e2fc(0x9a)]({'status':_0x33e2fc(0xab),'data':'Loading\x20model...'});const [_0x587de3,_0x3e4f60,_0x51d2bd]=await Florence2Singleton[_0x33e2fc(0x9e)](_0x15599b=>{const _0x26cd6b=_0x33e2fc;self[_0x26cd6b(0x9a)](_0x15599b);});self['postMessage']({'status':_0x33e2fc(0xab),'data':_0x33e2fc(0xb0)});const _0x1a1e5c=_0x3e4f60('a'),_0xba644f=full([0x1,0x3,0x300,0x300],0x0);await _0x587de3[_0x33e2fc(0xa6)]({..._0x1a1e5c,'pixel_values':_0xba644f,'max_new_tokens':0x1}),self[_0x33e2fc(0x9a)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x7234a6(0xa3)];let vision_inputs,image_size;async function run({text:_0xd600fa,url:_0x4d529e,task:_0x4d5d89}){const _0x77385d=a0_0x7234a6,[_0xe0c8c7,_0x49af85,_0x1bff51]=await Florence2Singleton[_0x77385d(0x9e)](),_0x42df54=performance[_0x77385d(0x9d)]();if(!vision_inputs){const _0x180457=await RawImage[_0x77385d(0xa5)](_0x4d529e);image_size=_0x180457[_0x77385d(0xa1)],vision_inputs=await _0x1bff51(_0x180457);}let _0x495aea=_0x4d5d89;TASKS_WITH_INPUTS['includes'](_0x4d5d89)&&_0xd600fa&&(_0x495aea+=_0xd600fa);const _0x2c5f2e=_0x49af85(_0x1bff51[_0x77385d(0xad)](_0x495aea)),_0x821ba1=await _0xe0c8c7[_0x77385d(0xa6)]({..._0x2c5f2e,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x467d2b=_0x49af85['batch_decode'](_0x821ba1,{'skip_special_tokens':!0x1})[0x0],_0xa7b045=_0x1bff51[_0x77385d(0x95)](_0x467d2b,_0x4d5d89,image_size),_0x2c2d58=performance[_0x77385d(0x9d)]();self[_0x77385d(0x9a)]({'status':_0x77385d(0x9c),'result':_0xa7b045,'time':_0x2c2d58-_0x42df54});}self[a0_0x7234a6(0xbb)](a0_0x7234a6(0xa0),async _0x2bd409=>{const _0x383a75=a0_0x7234a6,{type:_0x59935d,data:_0x20a0bd}=_0x2bd409[_0x383a75(0xb3)];switch(_0x59935d){case _0x383a75(0xb5):load();break;case _0x383a75(0xb2):run(_0x20a0bd);break;case _0x383a75(0xb6):vision_inputs=image_size=null;}});