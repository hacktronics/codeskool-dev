const a0_0x429021=a0_0x2864;(function(_0x35cc3c,_0x47a710){const _0x4a850f=a0_0x2864,_0x142d4c=_0x35cc3c();while(!![]){try{const _0x129cf9=-parseInt(_0x4a850f(0x1bf))/0x1*(-parseInt(_0x4a850f(0x1c5))/0x2)+-parseInt(_0x4a850f(0x1c0))/0x3+-parseInt(_0x4a850f(0x1af))/0x4+-parseInt(_0x4a850f(0x1cc))/0x5+-parseInt(_0x4a850f(0x1d6))/0x6*(-parseInt(_0x4a850f(0x1b6))/0x7)+-parseInt(_0x4a850f(0x1b3))/0x8*(parseInt(_0x4a850f(0x1ae))/0x9)+parseInt(_0x4a850f(0x1ca))/0xa;if(_0x129cf9===_0x47a710)break;else _0x142d4c['push'](_0x142d4c['shift']());}catch(_0x4110c6){_0x142d4c['push'](_0x142d4c['shift']());}}}(a0_0x3c6e,0x646c6));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x48d443=a0_0x2864;try{return(await navigator[_0x48d443(0x1cf)][_0x48d443(0x1ba)]())[_0x48d443(0x1b5)][_0x48d443(0x1d5)](_0x48d443(0x1d0));}catch(_0x591fd3){return!0x1;}}class Florence2Singleton{static [a0_0x429021(0x1cb)]=a0_0x429021(0x1d4);static async['getInstance'](_0x3318f7=null){const _0x2f24aa=a0_0x429021;return this[_0x2f24aa(0x1b0)]??=AutoProcessor[_0x2f24aa(0x1d1)](this['model_id']),this['tokenizer']??=AutoTokenizer[_0x2f24aa(0x1d1)](this[_0x2f24aa(0x1cb)]),this[_0x2f24aa(0x1c7)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x2f24aa(0x1d1)](this[_0x2f24aa(0x1cb)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x2f24aa(0x1d9):_0x2f24aa(0x1b8),'vision_encoder':this[_0x2f24aa(0x1c7)]?_0x2f24aa(0x1d9):_0x2f24aa(0x1b8),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x2f24aa(0x1b1),'progress_callback':_0x3318f7}),Promise['all']([this['model'],this[_0x2f24aa(0x1c2)],this['processor']]);}}async function load(){const _0x4fd356=a0_0x429021;self[_0x4fd356(0x1b9)]({'status':_0x4fd356(0x1bd),'data':_0x4fd356(0x1c3)});const [_0x4403,_0x2b477b,_0x5965df]=await Florence2Singleton['getInstance'](_0x49eb1b=>{const _0x3f2911=_0x4fd356;self[_0x3f2911(0x1b9)](_0x49eb1b);});self['postMessage']({'status':_0x4fd356(0x1bd),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0x41d66b=_0x2b477b('a'),_0x1b7836=full([0x1,0x3,0x300,0x300],0x0);await _0x4403[_0x4fd356(0x1d2)]({..._0x41d66b,'pixel_values':_0x1b7836,'max_new_tokens':0x1}),self['postMessage']({'status':_0x4fd356(0x1c9)});}const TASKS_WITH_INPUTS=[a0_0x429021(0x1b7)];let vision_inputs,image_size;function a0_0x3c6e(){const _0x3ae688=['complete','tokenizer','Loading\x20model...','construct_prompts','290LMcuHk','addEventListener','supports_fp16','data','ready','12250430DrdxId','model_id','2323275FmZGNb','post_process_generation','load','gpu','shader-f16','from_pretrained','generate','now','onnx-community/Florence-2-base-ft','has','350364eJHEwo','run','size','fp16','9nzjehK','3199820ypMKPL','processor','webgpu','fromURL','1376176ZMSlTt','getInstance','features','35KZkIsT','<CAPTION_TO_PHRASE_GROUNDING>','fp32','postMessage','requestAdapter','message','includes','loading','reset','3175iEIliG','388266MuVooP'];a0_0x3c6e=function(){return _0x3ae688;};return a0_0x3c6e();}async function run({text:_0x1a2c8e,url:_0x516f08,task:_0x2c4f58}){const _0x3635d7=a0_0x429021,[_0x408f76,_0x34d5f7,_0x234407]=await Florence2Singleton[_0x3635d7(0x1b4)](),_0x1c9974=performance[_0x3635d7(0x1d3)]();if(!vision_inputs){const _0x26363f=await RawImage[_0x3635d7(0x1b2)](_0x516f08);image_size=_0x26363f[_0x3635d7(0x1d8)],vision_inputs=await _0x234407(_0x26363f);}let _0x2fd2d6=_0x2c4f58;TASKS_WITH_INPUTS[_0x3635d7(0x1bc)](_0x2c4f58)&&_0x1a2c8e&&(_0x2fd2d6+=_0x1a2c8e);const _0xba3860=_0x34d5f7(_0x234407[_0x3635d7(0x1c4)](_0x2fd2d6)),_0x2f0f5b=await _0x408f76[_0x3635d7(0x1d2)]({..._0xba3860,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x280344=_0x34d5f7['batch_decode'](_0x2f0f5b,{'skip_special_tokens':!0x1})[0x0],_0x33bdf6=_0x234407[_0x3635d7(0x1cd)](_0x280344,_0x2c4f58,image_size),_0x57528d=performance['now']();self[_0x3635d7(0x1b9)]({'status':_0x3635d7(0x1c1),'result':_0x33bdf6,'time':_0x57528d-_0x1c9974});}function a0_0x2864(_0x18c857,_0xae3271){const _0x3c6e9a=a0_0x3c6e();return a0_0x2864=function(_0x2864a6,_0x4ba48a){_0x2864a6=_0x2864a6-0x1ae;let _0x12b469=_0x3c6e9a[_0x2864a6];return _0x12b469;},a0_0x2864(_0x18c857,_0xae3271);}self[a0_0x429021(0x1c6)](a0_0x429021(0x1bb),async _0x20b841=>{const _0x587f81=a0_0x429021,{type:_0x56a199,data:_0x306693}=_0x20b841[_0x587f81(0x1c8)];switch(_0x56a199){case _0x587f81(0x1ce):load();break;case _0x587f81(0x1d7):run(_0x306693);break;case _0x587f81(0x1be):vision_inputs=image_size=null;}});