const a0_0x203f31=a0_0x3a03;(function(_0x2afaf5,_0x5dd91e){const _0x7be437=a0_0x3a03,_0x52c9a1=_0x2afaf5();while(!![]){try{const _0x5dd7e0=-parseInt(_0x7be437(0x20e))/0x1+-parseInt(_0x7be437(0x1f3))/0x2+-parseInt(_0x7be437(0x1f2))/0x3+-parseInt(_0x7be437(0x1fb))/0x4*(parseInt(_0x7be437(0x204))/0x5)+parseInt(_0x7be437(0x1fc))/0x6+-parseInt(_0x7be437(0x20c))/0x7+parseInt(_0x7be437(0x1f5))/0x8;if(_0x5dd7e0===_0x5dd91e)break;else _0x52c9a1['push'](_0x52c9a1['shift']());}catch(_0x3b2a51){_0x52c9a1['push'](_0x52c9a1['shift']());}}}(a0_0x53d8,0xdc5f6));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x55544=a0_0x3a03;try{return(await navigator[_0x55544(0x1e8)]['requestAdapter']())[_0x55544(0x1f7)][_0x55544(0x206)]('shader-f16');}catch(_0x174713){return!0x1;}}function a0_0x53d8(){const _0x4b364b=['1561314NEPKPK','loading','19600608KiVIZb','tokenizer','features','addEventListener','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','getInstance','44ELMpkt','243456NpRaeB','message','batch_decode','model','webgpu','onnx-community/Florence-2-base-ft','postMessage','ready','85010rlqdAe','processor','has','now','includes','load','Loading\x20model...','construct_prompts','1003310TgUUZq','run','365632INkWWp','gpu','generate','model_id','supports_fp16','from_pretrained','complete','fp32','fp16','size','post_process_generation','334095KbJAbU'];a0_0x53d8=function(){return _0x4b364b;};return a0_0x53d8();}function a0_0x3a03(_0x4aec30,_0x423fb9){const _0x53d8b7=a0_0x53d8();return a0_0x3a03=function(_0x3a03bc,_0x6cbd54){_0x3a03bc=_0x3a03bc-0x1e8;let _0x4a37b5=_0x53d8b7[_0x3a03bc];return _0x4a37b5;},a0_0x3a03(_0x4aec30,_0x423fb9);}class Florence2Singleton{static ['model_id']=a0_0x203f31(0x201);static async['getInstance'](_0x34d118=null){const _0x32233c=a0_0x203f31;return this[_0x32233c(0x205)]??=AutoProcessor['from_pretrained'](this['model_id']),this[_0x32233c(0x1f6)]??=AutoTokenizer[_0x32233c(0x1ec)](this[_0x32233c(0x1ea)]),this[_0x32233c(0x1eb)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x32233c(0x1ea)],{'dtype':{'embed_tokens':this['supports_fp16']?_0x32233c(0x1ef):_0x32233c(0x1ee),'vision_encoder':this[_0x32233c(0x1eb)]?_0x32233c(0x1ef):_0x32233c(0x1ee),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x32233c(0x200),'progress_callback':_0x34d118}),Promise['all']([this[_0x32233c(0x1ff)],this[_0x32233c(0x1f6)],this['processor']]);}}async function load(){const _0x4eb26c=a0_0x203f31;self[_0x4eb26c(0x202)]({'status':_0x4eb26c(0x1f4),'data':_0x4eb26c(0x20a)});const [_0x3660f3,_0x261310,_0x144357]=await Florence2Singleton[_0x4eb26c(0x1fa)](_0x5765c4=>{const _0xcc6bad=_0x4eb26c;self[_0xcc6bad(0x202)](_0x5765c4);});self[_0x4eb26c(0x202)]({'status':_0x4eb26c(0x1f4),'data':_0x4eb26c(0x1f9)});const _0x665a4a=_0x261310('a'),_0x24120b=full([0x1,0x3,0x300,0x300],0x0);await _0x3660f3[_0x4eb26c(0x1e9)]({..._0x665a4a,'pixel_values':_0x24120b,'max_new_tokens':0x1}),self[_0x4eb26c(0x202)]({'status':_0x4eb26c(0x203)});}const TASKS_WITH_INPUTS=['<CAPTION_TO_PHRASE_GROUNDING>'];let vision_inputs,image_size;async function run({text:_0x147f82,url:_0x3b90d3,task:_0x123c33}){const _0x50e405=a0_0x203f31,[_0x271853,_0x7c7a18,_0x5759bc]=await Florence2Singleton[_0x50e405(0x1fa)](),_0x30253c=performance[_0x50e405(0x207)]();if(!vision_inputs){const _0x202333=await RawImage['fromURL'](_0x3b90d3);image_size=_0x202333[_0x50e405(0x1f0)],vision_inputs=await _0x5759bc(_0x202333);}let _0x591e02=_0x123c33;TASKS_WITH_INPUTS[_0x50e405(0x208)](_0x123c33)&&_0x147f82&&(_0x591e02+=_0x147f82);const _0x105be9=_0x7c7a18(_0x5759bc[_0x50e405(0x20b)](_0x591e02)),_0x4a4f21=await _0x271853[_0x50e405(0x1e9)]({..._0x105be9,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3a066e=_0x7c7a18[_0x50e405(0x1fe)](_0x4a4f21,{'skip_special_tokens':!0x1})[0x0],_0xfb9daa=_0x5759bc[_0x50e405(0x1f1)](_0x3a066e,_0x123c33,image_size),_0x13ce09=performance[_0x50e405(0x207)]();self[_0x50e405(0x202)]({'status':_0x50e405(0x1ed),'result':_0xfb9daa,'time':_0x13ce09-_0x30253c});}self[a0_0x203f31(0x1f8)](a0_0x203f31(0x1fd),async _0x2e3b1d=>{const _0x53cd54=a0_0x203f31,{type:_0x274763,data:_0x55a714}=_0x2e3b1d['data'];switch(_0x274763){case _0x53cd54(0x209):load();break;case _0x53cd54(0x20d):run(_0x55a714);break;case'reset':vision_inputs=image_size=null;}});