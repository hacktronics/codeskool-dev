const a0_0x2862ed=a0_0x39e9;function a0_0x39e9(_0x577222,_0x52842a){const _0x5ee4a2=a0_0x5ee4();return a0_0x39e9=function(_0x39e972,_0x33dfed){_0x39e972=_0x39e972-0x1bc;let _0x5a7fc7=_0x5ee4a2[_0x39e972];return _0x5a7fc7;},a0_0x39e9(_0x577222,_0x52842a);}(function(_0xdd154c,_0xe358ab){const _0x4614a7=a0_0x39e9,_0x4f7982=_0xdd154c();while(!![]){try{const _0x2c1cca=parseInt(_0x4614a7(0x1de))/0x1*(-parseInt(_0x4614a7(0x1e0))/0x2)+-parseInt(_0x4614a7(0x1bf))/0x3+-parseInt(_0x4614a7(0x1bd))/0x4*(-parseInt(_0x4614a7(0x1c7))/0x5)+parseInt(_0x4614a7(0x1be))/0x6*(parseInt(_0x4614a7(0x1d1))/0x7)+-parseInt(_0x4614a7(0x1c4))/0x8+parseInt(_0x4614a7(0x1dc))/0x9+-parseInt(_0x4614a7(0x1ce))/0xa*(parseInt(_0x4614a7(0x1d7))/0xb);if(_0x2c1cca===_0xe358ab)break;else _0x4f7982['push'](_0x4f7982['shift']());}catch(_0x2e1935){_0x4f7982['push'](_0x4f7982['shift']());}}}(a0_0x5ee4,0x30b75));function a0_0x5ee4(){const _0x59c2e6=['features','ready','100ezXUdQ','18gLmlYq','410556QEGVJC','supports_fp16','construct_prompts','addEventListener','Loading\x20model...','333520ivtjds','now','complete','37385CPhYij','includes','all','requestAdapter','fp16','webgpu','postMessage','10pFpnyd','model_id','batch_decode','645701rtXuIG','size','model','tokenizer','getInstance','fp32','1457764TrJTJr','has','from_pretrained','loading','run','2784825eWZhFL','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','109CXihFL','processor','4816MbqycK','load','<CAPTION_TO_PHRASE_GROUNDING>','generate'];a0_0x5ee4=function(){return _0x59c2e6;};return a0_0x5ee4();}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x6d8aeb=a0_0x39e9;try{return(await navigator['gpu'][_0x6d8aeb(0x1ca)]())[_0x6d8aeb(0x1e4)][_0x6d8aeb(0x1d8)]('shader-f16');}catch(_0x4d12b9){return!0x1;}}class Florence2Singleton{static [a0_0x2862ed(0x1cf)]='onnx-community/Florence-2-base-ft';static async[a0_0x2862ed(0x1d5)](_0x9ecf2c=null){const _0x5dc6f2=a0_0x2862ed;return this[_0x5dc6f2(0x1df)]??=AutoProcessor[_0x5dc6f2(0x1d9)](this[_0x5dc6f2(0x1cf)]),this[_0x5dc6f2(0x1d4)]??=AutoTokenizer[_0x5dc6f2(0x1d9)](this[_0x5dc6f2(0x1cf)]),this[_0x5dc6f2(0x1c0)]??=await hasFp16(),this[_0x5dc6f2(0x1d3)]??=Florence2ForConditionalGeneration[_0x5dc6f2(0x1d9)](this[_0x5dc6f2(0x1cf)],{'dtype':{'embed_tokens':this[_0x5dc6f2(0x1c0)]?'fp16':_0x5dc6f2(0x1d6),'vision_encoder':this['supports_fp16']?_0x5dc6f2(0x1cb):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x5dc6f2(0x1cc),'progress_callback':_0x9ecf2c}),Promise[_0x5dc6f2(0x1c9)]([this['model'],this[_0x5dc6f2(0x1d4)],this['processor']]);}}async function load(){const _0x3d999b=a0_0x2862ed;self['postMessage']({'status':_0x3d999b(0x1da),'data':_0x3d999b(0x1c3)});const [_0x1e32b6,_0x3f1a18,_0x10f94e]=await Florence2Singleton[_0x3d999b(0x1d5)](_0x2be98b=>{const _0x3392f0=_0x3d999b;self[_0x3392f0(0x1cd)](_0x2be98b);});self[_0x3d999b(0x1cd)]({'status':_0x3d999b(0x1da),'data':_0x3d999b(0x1dd)});const _0x5a861b=_0x3f1a18('a'),_0x686ab4=full([0x1,0x3,0x300,0x300],0x0);await _0x1e32b6[_0x3d999b(0x1e3)]({..._0x5a861b,'pixel_values':_0x686ab4,'max_new_tokens':0x1}),self[_0x3d999b(0x1cd)]({'status':_0x3d999b(0x1bc)});}const TASKS_WITH_INPUTS=[a0_0x2862ed(0x1e2)];let vision_inputs,image_size;async function run({text:_0x1af186,url:_0x156598,task:_0x2ca948}){const _0x463399=a0_0x2862ed,[_0x349771,_0x2b3e24,_0x4ed943]=await Florence2Singleton[_0x463399(0x1d5)](),_0x42c8c1=performance['now']();if(!vision_inputs){const _0x2cb85c=await RawImage['fromURL'](_0x156598);image_size=_0x2cb85c[_0x463399(0x1d2)],vision_inputs=await _0x4ed943(_0x2cb85c);}let _0x210a7=_0x2ca948;TASKS_WITH_INPUTS[_0x463399(0x1c8)](_0x2ca948)&&_0x1af186&&(_0x210a7+=_0x1af186);const _0x837063=_0x2b3e24(_0x4ed943[_0x463399(0x1c1)](_0x210a7)),_0x337412=await _0x349771[_0x463399(0x1e3)]({..._0x837063,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x3b412a=_0x2b3e24[_0x463399(0x1d0)](_0x337412,{'skip_special_tokens':!0x1})[0x0],_0x41af01=_0x4ed943['post_process_generation'](_0x3b412a,_0x2ca948,image_size),_0x4cdbca=performance[_0x463399(0x1c5)]();self[_0x463399(0x1cd)]({'status':_0x463399(0x1c6),'result':_0x41af01,'time':_0x4cdbca-_0x42c8c1});}self[a0_0x2862ed(0x1c2)]('message',async _0x28299c=>{const _0x4ab48f=a0_0x2862ed,{type:_0x1b3b7a,data:_0x2e2e74}=_0x28299c['data'];switch(_0x1b3b7a){case _0x4ab48f(0x1e1):load();break;case _0x4ab48f(0x1db):run(_0x2e2e74);break;case'reset':vision_inputs=image_size=null;}});