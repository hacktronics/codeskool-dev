const a0_0x56194a=a0_0x50e8;(function(_0x13c442,_0x2878fd){const _0x4e1a03=a0_0x50e8,_0x35443f=_0x13c442();while(!![]){try{const _0x975833=-parseInt(_0x4e1a03(0x164))/0x1+parseInt(_0x4e1a03(0x17c))/0x2*(-parseInt(_0x4e1a03(0x163))/0x3)+parseInt(_0x4e1a03(0x172))/0x4*(parseInt(_0x4e1a03(0x16f))/0x5)+-parseInt(_0x4e1a03(0x169))/0x6+-parseInt(_0x4e1a03(0x170))/0x7+-parseInt(_0x4e1a03(0x17b))/0x8+parseInt(_0x4e1a03(0x183))/0x9;if(_0x975833===_0x2878fd)break;else _0x35443f['push'](_0x35443f['shift']());}catch(_0x971c83){_0x35443f['push'](_0x35443f['shift']());}}}(a0_0x5d84,0x628cf));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x25a467=a0_0x50e8;try{return(await navigator[_0x25a467(0x179)]['requestAdapter']())[_0x25a467(0x16c)][_0x25a467(0x166)](_0x25a467(0x185));}catch(_0xa7663){return!0x1;}}function a0_0x50e8(_0x31fb1d,_0x37f156){const _0x5d84ce=a0_0x5d84();return a0_0x50e8=function(_0x50e8a4,_0x5e9426){_0x50e8a4=_0x50e8a4-0x162;let _0x3fbccb=_0x5d84ce[_0x50e8a4];return _0x3fbccb;},a0_0x50e8(_0x31fb1d,_0x37f156);}class Florence2Singleton{static [a0_0x56194a(0x184)]=a0_0x56194a(0x181);static async[a0_0x56194a(0x162)](_0x35d3a5=null){const _0x128a10=a0_0x56194a;return this[_0x128a10(0x167)]??=AutoProcessor['from_pretrained'](this[_0x128a10(0x184)]),this[_0x128a10(0x17e)]??=AutoTokenizer[_0x128a10(0x177)](this[_0x128a10(0x184)]),this[_0x128a10(0x168)]??=await hasFp16(),this[_0x128a10(0x176)]??=Florence2ForConditionalGeneration[_0x128a10(0x177)](this[_0x128a10(0x184)],{'dtype':{'embed_tokens':this[_0x128a10(0x168)]?'fp16':_0x128a10(0x16e),'vision_encoder':this[_0x128a10(0x168)]?'fp16':_0x128a10(0x16e),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x35d3a5}),Promise[_0x128a10(0x178)]([this[_0x128a10(0x176)],this[_0x128a10(0x17e)],this[_0x128a10(0x167)]]);}}async function load(){const _0x4d4f3e=a0_0x56194a;self[_0x4d4f3e(0x186)]({'status':_0x4d4f3e(0x17f),'data':'Loading\x20model...'});const [_0x422f89,_0x3f5d24,_0x4ce5d9]=await Florence2Singleton[_0x4d4f3e(0x162)](_0xece41d=>{const _0xfece01=_0x4d4f3e;self[_0xfece01(0x186)](_0xece41d);});self[_0x4d4f3e(0x186)]({'status':_0x4d4f3e(0x17f),'data':_0x4d4f3e(0x16b)});const _0x30de9d=_0x3f5d24('a'),_0x5d545b=full([0x1,0x3,0x300,0x300],0x0);await _0x422f89[_0x4d4f3e(0x174)]({..._0x30de9d,'pixel_values':_0x5d545b,'max_new_tokens':0x1}),self[_0x4d4f3e(0x186)]({'status':_0x4d4f3e(0x173)});}const TASKS_WITH_INPUTS=[a0_0x56194a(0x175)];let vision_inputs,image_size;function a0_0x5d84(){const _0x132d39=['generate','<CAPTION_TO_PHRASE_GROUNDING>','model','from_pretrained','all','gpu','load','2049968cTwZcH','184506aTlpqt','includes','tokenizer','loading','data','onnx-community/Florence-2-base-ft','addEventListener','16783227DyfSbC','model_id','shader-f16','postMessage','getInstance','9BTgukg','503786iKBetS','fromURL','has','processor','supports_fp16','838812lILklZ','complete','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','features','run','fp32','192815TnITEH','4961180xWjDxV','construct_prompts','44oSdNlk','ready'];a0_0x5d84=function(){return _0x132d39;};return a0_0x5d84();}async function run({text:_0x89b6f1,url:_0x1458b5,task:_0x4826b4}){const _0x781584=a0_0x56194a,[_0x404bbf,_0x1473f3,_0x303f32]=await Florence2Singleton[_0x781584(0x162)](),_0x3fe644=performance['now']();if(!vision_inputs){const _0x24d16c=await RawImage[_0x781584(0x165)](_0x1458b5);image_size=_0x24d16c['size'],vision_inputs=await _0x303f32(_0x24d16c);}let _0x373ad4=_0x4826b4;TASKS_WITH_INPUTS[_0x781584(0x17d)](_0x4826b4)&&_0x89b6f1&&(_0x373ad4+=_0x89b6f1);const _0x15ec3c=_0x1473f3(_0x303f32[_0x781584(0x171)](_0x373ad4)),_0x1ce74e=await _0x404bbf[_0x781584(0x174)]({..._0x15ec3c,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x273072=_0x1473f3['batch_decode'](_0x1ce74e,{'skip_special_tokens':!0x1})[0x0],_0x57d618=_0x303f32['post_process_generation'](_0x273072,_0x4826b4,image_size),_0x2d66d4=performance['now']();self[_0x781584(0x186)]({'status':_0x781584(0x16a),'result':_0x57d618,'time':_0x2d66d4-_0x3fe644});}self[a0_0x56194a(0x182)]('message',async _0x87a761=>{const _0x4d4341=a0_0x56194a,{type:_0x1db7f3,data:_0x3360b9}=_0x87a761[_0x4d4341(0x180)];switch(_0x1db7f3){case _0x4d4341(0x17a):load();break;case _0x4d4341(0x16d):run(_0x3360b9);break;case'reset':vision_inputs=image_size=null;}});