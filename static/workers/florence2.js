const a0_0x3c9f6c=a0_0x1b71;(function(_0x35e581,_0x41ec0b){const _0x46b4d0=a0_0x1b71,_0x50c954=_0x35e581();while(!![]){try{const _0x1f5981=parseInt(_0x46b4d0(0x9a))/0x1*(parseInt(_0x46b4d0(0x9c))/0x2)+parseInt(_0x46b4d0(0xac))/0x3*(-parseInt(_0x46b4d0(0xb0))/0x4)+-parseInt(_0x46b4d0(0xa5))/0x5*(-parseInt(_0x46b4d0(0x9d))/0x6)+-parseInt(_0x46b4d0(0xb3))/0x7+parseInt(_0x46b4d0(0xaf))/0x8*(-parseInt(_0x46b4d0(0x97))/0x9)+-parseInt(_0x46b4d0(0xa4))/0xa+-parseInt(_0x46b4d0(0x9f))/0xb*(-parseInt(_0x46b4d0(0xab))/0xc);if(_0x1f5981===_0x41ec0b)break;else _0x50c954['push'](_0x50c954['shift']());}catch(_0x4311d6){_0x50c954['push'](_0x50c954['shift']());}}}(a0_0x18f6,0xebd2e));function a0_0x18f6(){const _0x25a51a=['data','reset','gpu','3692724PFNYEc','1360677FHNNOE','model_id','now','5186632IdiziZ','4cRXDKY','batch_decode','model','9775535ybXhyg','processor','postMessage','post_process_generation','fromURL','run','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','message','tokenizer','Loading\x20model...','construct_prompts','requestAdapter','loading','18JPkifx','supports_fp16','all','22874cHQSaH','size','58ZMaBsC','45690uJbFFR','getInstance','77kdDwvY','generate','webgpu','<CAPTION_TO_PHRASE_GROUNDING>','fp32','3420040pRLfmt','1075LSjmmM','ready','from_pretrained'];a0_0x18f6=function(){return _0x25a51a;};return a0_0x18f6();}import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x422909=a0_0x1b71;try{return(await navigator[_0x422909(0xaa)][_0x422909(0x95)]())['features']['has']('shader-f16');}catch(_0x5cdfe3){return!0x1;}}class Florence2Singleton{static [a0_0x3c9f6c(0xad)]='onnx-community/Florence-2-base-ft';static async[a0_0x3c9f6c(0x9e)](_0x2b5189=null){const _0x585877=a0_0x3c9f6c;return this['processor']??=AutoProcessor['from_pretrained'](this[_0x585877(0xad)]),this[_0x585877(0xbb)]??=AutoTokenizer[_0x585877(0xa7)](this[_0x585877(0xad)]),this[_0x585877(0x98)]??=await hasFp16(),this[_0x585877(0xb2)]??=Florence2ForConditionalGeneration[_0x585877(0xa7)](this[_0x585877(0xad)],{'dtype':{'embed_tokens':this[_0x585877(0x98)]?'fp16':_0x585877(0xa3),'vision_encoder':this[_0x585877(0x98)]?'fp16':_0x585877(0xa3),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x585877(0xa1),'progress_callback':_0x2b5189}),Promise[_0x585877(0x99)]([this[_0x585877(0xb2)],this['tokenizer'],this[_0x585877(0xb4)]]);}}async function load(){const _0x445711=a0_0x3c9f6c;self[_0x445711(0xb5)]({'status':_0x445711(0x96),'data':_0x445711(0xbc)});const [_0x481376,_0x491166,_0x1efa81]=await Florence2Singleton[_0x445711(0x9e)](_0xbdbefd=>{const _0x233d87=_0x445711;self[_0x233d87(0xb5)](_0xbdbefd);});self[_0x445711(0xb5)]({'status':'loading','data':_0x445711(0xb9)});const _0x2f7bab=_0x491166('a'),_0x136835=full([0x1,0x3,0x300,0x300],0x0);await _0x481376[_0x445711(0xa0)]({..._0x2f7bab,'pixel_values':_0x136835,'max_new_tokens':0x1}),self[_0x445711(0xb5)]({'status':_0x445711(0xa6)});}const TASKS_WITH_INPUTS=[a0_0x3c9f6c(0xa2)];function a0_0x1b71(_0x30722c,_0x3310f3){const _0x18f607=a0_0x18f6();return a0_0x1b71=function(_0x1b7128,_0x266cad){_0x1b7128=_0x1b7128-0x94;let _0x5ab7f5=_0x18f607[_0x1b7128];return _0x5ab7f5;},a0_0x1b71(_0x30722c,_0x3310f3);}let vision_inputs,image_size;async function run({text:_0x5d2684,url:_0x49fbdf,task:_0x17c2d4}){const _0xe6b726=a0_0x3c9f6c,[_0x3bab19,_0x138567,_0x1dfe00]=await Florence2Singleton['getInstance'](),_0x4a4164=performance[_0xe6b726(0xae)]();if(!vision_inputs){const _0x1cb1a2=await RawImage[_0xe6b726(0xb7)](_0x49fbdf);image_size=_0x1cb1a2[_0xe6b726(0x9b)],vision_inputs=await _0x1dfe00(_0x1cb1a2);}let _0x1e262c=_0x17c2d4;TASKS_WITH_INPUTS['includes'](_0x17c2d4)&&_0x5d2684&&(_0x1e262c+=_0x5d2684);const _0x189ca0=_0x138567(_0x1dfe00[_0xe6b726(0x94)](_0x1e262c)),_0x4bd210=await _0x3bab19[_0xe6b726(0xa0)]({..._0x189ca0,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x2dad0a=_0x138567[_0xe6b726(0xb1)](_0x4bd210,{'skip_special_tokens':!0x1})[0x0],_0x506b13=_0x1dfe00[_0xe6b726(0xb6)](_0x2dad0a,_0x17c2d4,image_size),_0x316ebe=performance[_0xe6b726(0xae)]();self[_0xe6b726(0xb5)]({'status':'complete','result':_0x506b13,'time':_0x316ebe-_0x4a4164});}self['addEventListener'](a0_0x3c9f6c(0xba),async _0x5d41ca=>{const _0x511d4b=a0_0x3c9f6c,{type:_0x5a27c7,data:_0x437756}=_0x5d41ca[_0x511d4b(0xa8)];switch(_0x5a27c7){case'load':load();break;case _0x511d4b(0xb8):run(_0x437756);break;case _0x511d4b(0xa9):vision_inputs=image_size=null;}});