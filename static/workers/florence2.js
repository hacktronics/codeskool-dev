const a0_0x33fae7=a0_0x25c4;(function(_0x11f65a,_0xb5b95a){const _0x45c0f9=a0_0x25c4,_0x50d428=_0x11f65a();while(!![]){try{const _0xb6b480=parseInt(_0x45c0f9(0xfa))/0x1+-parseInt(_0x45c0f9(0xdf))/0x2+parseInt(_0x45c0f9(0xff))/0x3+parseInt(_0x45c0f9(0xe3))/0x4+parseInt(_0x45c0f9(0xdb))/0x5+parseInt(_0x45c0f9(0xec))/0x6*(-parseInt(_0x45c0f9(0xeb))/0x7)+-parseInt(_0x45c0f9(0xde))/0x8;if(_0xb6b480===_0xb5b95a)break;else _0x50d428['push'](_0x50d428['shift']());}catch(_0x4eb626){_0x50d428['push'](_0x50d428['shift']());}}}(a0_0xaef9,0xe5ec5));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3/dist/transformers.min.js';async function hasFp16(){const _0x18e34b=a0_0x25c4;try{return(await navigator['gpu']['requestAdapter']())[_0x18e34b(0xdd)][_0x18e34b(0xf5)]('shader-f16');}catch(_0x56dc8d){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x33fae7(0xf1);static async['getInstance'](_0x291a3d=null){const _0x382755=a0_0x33fae7;return this[_0x382755(0xe5)]??=AutoProcessor[_0x382755(0xfe)](this['model_id']),this[_0x382755(0xdc)]??=AutoTokenizer['from_pretrained'](this[_0x382755(0xe8)]),this[_0x382755(0xfb)]??=await hasFp16(),this[_0x382755(0xf7)]??=Florence2ForConditionalGeneration['from_pretrained'](this[_0x382755(0xe8)],{'dtype':{'embed_tokens':this[_0x382755(0xfb)]?'fp16':'fp32','vision_encoder':this[_0x382755(0xfb)]?_0x382755(0x100):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x382755(0xf4),'progress_callback':_0x291a3d}),Promise[_0x382755(0xe1)]([this[_0x382755(0xf7)],this['tokenizer'],this[_0x382755(0xe5)]]);}}function a0_0xaef9(){const _0x1cc529=['fp16','2683280SlXLqO','tokenizer','features','7337616pZMMSs','78ynztJw','complete','all','generate','2280504eeBwZC','run','processor','message','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','model_id','reset','includes','9047143TIJstG','6QbYVdX','batch_decode','size','Loading\x20model...','postMessage','onnx-community/Florence-2-base-ft','loading','ready','webgpu','has','getInstance','model','fromURL','load','1063355NqRcDf','supports_fp16','now','<CAPTION_TO_PHRASE_GROUNDING>','from_pretrained','2943954TvFVPN'];a0_0xaef9=function(){return _0x1cc529;};return a0_0xaef9();}async function load(){const _0x49fc44=a0_0x33fae7;self['postMessage']({'status':_0x49fc44(0xf2),'data':_0x49fc44(0xef)});const [_0x450071,_0x24a5c5,_0x5e5cdb]=await Florence2Singleton[_0x49fc44(0xf6)](_0x2643f5=>{const _0x45519d=_0x49fc44;self[_0x45519d(0xf0)](_0x2643f5);});self[_0x49fc44(0xf0)]({'status':_0x49fc44(0xf2),'data':_0x49fc44(0xe7)});const _0x204e8e=_0x24a5c5('a'),_0xba5bae=full([0x1,0x3,0x300,0x300],0x0);await _0x450071[_0x49fc44(0xe2)]({..._0x204e8e,'pixel_values':_0xba5bae,'max_new_tokens':0x1}),self[_0x49fc44(0xf0)]({'status':_0x49fc44(0xf3)});}function a0_0x25c4(_0x3f3fc8,_0x132ceb){const _0xaef9c3=a0_0xaef9();return a0_0x25c4=function(_0x25c413,_0xc8b6ed){_0x25c413=_0x25c413-0xdb;let _0x3a51a8=_0xaef9c3[_0x25c413];return _0x3a51a8;},a0_0x25c4(_0x3f3fc8,_0x132ceb);}const TASKS_WITH_INPUTS=[a0_0x33fae7(0xfd)];let vision_inputs,image_size;async function run({text:_0x3abc91,url:_0x19150b,task:_0x40498f}){const _0x2efaf1=a0_0x33fae7,[_0x214406,_0x23a443,_0x2bba6e]=await Florence2Singleton[_0x2efaf1(0xf6)](),_0x1d5406=performance[_0x2efaf1(0xfc)]();if(!vision_inputs){const _0x4178e0=await RawImage[_0x2efaf1(0xf8)](_0x19150b);image_size=_0x4178e0[_0x2efaf1(0xee)],vision_inputs=await _0x2bba6e(_0x4178e0);}let _0x5a4ed2=_0x40498f;TASKS_WITH_INPUTS[_0x2efaf1(0xea)](_0x40498f)&&_0x3abc91&&(_0x5a4ed2+=_0x3abc91);const _0x2292fc=_0x23a443(_0x2bba6e['construct_prompts'](_0x5a4ed2)),_0x3d20db=await _0x214406[_0x2efaf1(0xe2)]({..._0x2292fc,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x2f299c=_0x23a443[_0x2efaf1(0xed)](_0x3d20db,{'skip_special_tokens':!0x1})[0x0],_0x4e3f0e=_0x2bba6e['post_process_generation'](_0x2f299c,_0x40498f,image_size),_0x5405e8=performance[_0x2efaf1(0xfc)]();self['postMessage']({'status':_0x2efaf1(0xe0),'result':_0x4e3f0e,'time':_0x5405e8-_0x1d5406});}self['addEventListener'](a0_0x33fae7(0xe6),async _0x140174=>{const _0x49c61d=a0_0x33fae7,{type:_0x2bc65e,data:_0x53ae9d}=_0x140174['data'];switch(_0x2bc65e){case _0x49c61d(0xf9):load();break;case _0x49c61d(0xe4):run(_0x53ae9d);break;case _0x49c61d(0xe9):vision_inputs=image_size=null;}});