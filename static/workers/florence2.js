const a0_0x5dea40=a0_0x4252;(function(_0x2c6545,_0x339400){const _0x5e29ab=a0_0x4252,_0x18f6ff=_0x2c6545();while(!![]){try{const _0x4a67c9=-parseInt(_0x5e29ab(0x159))/0x1+parseInt(_0x5e29ab(0x17b))/0x2*(parseInt(_0x5e29ab(0x162))/0x3)+-parseInt(_0x5e29ab(0x177))/0x4+parseInt(_0x5e29ab(0x170))/0x5*(parseInt(_0x5e29ab(0x156))/0x6)+parseInt(_0x5e29ab(0x157))/0x7*(parseInt(_0x5e29ab(0x167))/0x8)+-parseInt(_0x5e29ab(0x164))/0x9*(parseInt(_0x5e29ab(0x169))/0xa)+parseInt(_0x5e29ab(0x174))/0xb;if(_0x4a67c9===_0x339400)break;else _0x18f6ff['push'](_0x18f6ff['shift']());}catch(_0xca3a99){_0x18f6ff['push'](_0x18f6ff['shift']());}}}(a0_0x180b,0xa9e1e));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x5cfc8d=a0_0x4252;try{return(await navigator[_0x5cfc8d(0x171)]['requestAdapter']())['features'][_0x5cfc8d(0x178)]('shader-f16');}catch(_0x250f34){return!0x1;}}class Florence2Singleton{static [a0_0x5dea40(0x16f)]=a0_0x5dea40(0x16e);static async['getInstance'](_0x591ba6=null){const _0x4bff18=a0_0x5dea40;return this[_0x4bff18(0x166)]??=AutoProcessor[_0x4bff18(0x160)](this['model_id']),this[_0x4bff18(0x16c)]??=AutoTokenizer[_0x4bff18(0x160)](this[_0x4bff18(0x16f)]),this[_0x4bff18(0x163)]??=await hasFp16(),this[_0x4bff18(0x175)]??=Florence2ForConditionalGeneration[_0x4bff18(0x160)](this[_0x4bff18(0x16f)],{'dtype':{'embed_tokens':this[_0x4bff18(0x163)]?_0x4bff18(0x16a):_0x4bff18(0x176),'vision_encoder':this[_0x4bff18(0x163)]?_0x4bff18(0x16a):_0x4bff18(0x176),'encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x591ba6}),Promise['all']([this['model'],this['tokenizer'],this[_0x4bff18(0x166)]]);}}async function load(){const _0x3c76a5=a0_0x5dea40;self['postMessage']({'status':_0x3c76a5(0x15c),'data':_0x3c76a5(0x15d)});const [_0x44b442,_0x266144,_0x4ada58]=await Florence2Singleton[_0x3c76a5(0x161)](_0x1a92bd=>{const _0x2ceced=_0x3c76a5;self[_0x2ceced(0x165)](_0x1a92bd);});self['postMessage']({'status':_0x3c76a5(0x15c),'data':_0x3c76a5(0x16d)});const _0x5c5d5e=_0x266144('a'),_0x40e848=full([0x1,0x3,0x300,0x300],0x0);await _0x44b442[_0x3c76a5(0x15b)]({..._0x5c5d5e,'pixel_values':_0x40e848,'max_new_tokens':0x1}),self[_0x3c76a5(0x165)]({'status':_0x3c76a5(0x16b)});}const TASKS_WITH_INPUTS=[a0_0x5dea40(0x15f)];let vision_inputs,image_size;function a0_0x180b(){const _0x5ac741=['has','reset','fromURL','184civeYd','6gnUgoV','4989355sXEhQS','run','1010895RtANAL','data','generate','loading','Loading\x20model...','message','<CAPTION_TO_PHRASE_GROUNDING>','from_pretrained','getInstance','4809tjlpXf','supports_fp16','36lcfnoe','postMessage','processor','8GKxDbz','addEventListener','648490AjpmdR','fp16','ready','tokenizer','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','onnx-community/Florence-2-base-ft','model_id','5258860pZdGCk','gpu','post_process_generation','now','14581710DMKFSd','model','fp32','5085976lcjSYE'];a0_0x180b=function(){return _0x5ac741;};return a0_0x180b();}function a0_0x4252(_0x18f5d1,_0x892d23){const _0x180bde=a0_0x180b();return a0_0x4252=function(_0x425238,_0x34ca83){_0x425238=_0x425238-0x156;let _0x3e4c9e=_0x180bde[_0x425238];return _0x3e4c9e;},a0_0x4252(_0x18f5d1,_0x892d23);}async function run({text:_0xa3ac0f,url:_0x4f19c9,task:_0x4485c9}){const _0xae36ad=a0_0x5dea40,[_0x291904,_0x5e4b97,_0x5cc893]=await Florence2Singleton[_0xae36ad(0x161)](),_0x5b8f31=performance[_0xae36ad(0x173)]();if(!vision_inputs){const _0x5df5f1=await RawImage[_0xae36ad(0x17a)](_0x4f19c9);image_size=_0x5df5f1['size'],vision_inputs=await _0x5cc893(_0x5df5f1);}let _0x3d729d=_0x4485c9;TASKS_WITH_INPUTS['includes'](_0x4485c9)&&_0xa3ac0f&&(_0x3d729d+=_0xa3ac0f);const _0x2640a1=_0x5e4b97(_0x5cc893['construct_prompts'](_0x3d729d)),_0x2cb425=await _0x291904[_0xae36ad(0x15b)]({..._0x2640a1,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0xbffea7=_0x5e4b97['batch_decode'](_0x2cb425,{'skip_special_tokens':!0x1})[0x0],_0x3ad273=_0x5cc893[_0xae36ad(0x172)](_0xbffea7,_0x4485c9,image_size),_0x20d85b=performance[_0xae36ad(0x173)]();self[_0xae36ad(0x165)]({'status':'complete','result':_0x3ad273,'time':_0x20d85b-_0x5b8f31});}self[a0_0x5dea40(0x168)](a0_0x5dea40(0x15e),async _0xf482f=>{const _0x128780=a0_0x5dea40,{type:_0x3b0208,data:_0x1825b5}=_0xf482f[_0x128780(0x15a)];switch(_0x3b0208){case'load':load();break;case _0x128780(0x158):run(_0x1825b5);break;case _0x128780(0x179):vision_inputs=image_size=null;}});