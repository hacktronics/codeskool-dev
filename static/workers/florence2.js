const a0_0x3e6236=a0_0x1615;(function(_0x291cc6,_0x4d0b71){const _0x55f080=a0_0x1615,_0x55b161=_0x291cc6();while(!![]){try{const _0x1a8a7a=parseInt(_0x55f080(0xa3))/0x1*(-parseInt(_0x55f080(0x8e))/0x2)+-parseInt(_0x55f080(0x99))/0x3*(-parseInt(_0x55f080(0x92))/0x4)+-parseInt(_0x55f080(0x91))/0x5*(-parseInt(_0x55f080(0x89))/0x6)+-parseInt(_0x55f080(0x90))/0x7*(-parseInt(_0x55f080(0x85))/0x8)+parseInt(_0x55f080(0x8f))/0x9*(parseInt(_0x55f080(0xa4))/0xa)+-parseInt(_0x55f080(0x9b))/0xb+-parseInt(_0x55f080(0x93))/0xc*(parseInt(_0x55f080(0xa5))/0xd);if(_0x1a8a7a===_0x4d0b71)break;else _0x55b161['push'](_0x55b161['shift']());}catch(_0x18dadf){_0x55b161['push'](_0x55b161['shift']());}}}(a0_0x5600,0xc3fc6));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';async function hasFp16(){const _0x227619=a0_0x1615;try{return(await navigator[_0x227619(0x83)][_0x227619(0x9c)]())['features'][_0x227619(0xa7)](_0x227619(0x9e));}catch(_0x5649f8){return!0x1;}}class Florence2Singleton{static ['model_id']=a0_0x3e6236(0x9a);static async[a0_0x3e6236(0x86)](_0x529f30=null){const _0x4a4677=a0_0x3e6236;return this[_0x4a4677(0x81)]??=AutoProcessor['from_pretrained'](this[_0x4a4677(0x8d)]),this[_0x4a4677(0x95)]??=AutoTokenizer[_0x4a4677(0x98)](this['model_id']),this[_0x4a4677(0xa1)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration[_0x4a4677(0x98)](this['model_id'],{'dtype':{'embed_tokens':this[_0x4a4677(0xa1)]?'fp16':'fp32','vision_encoder':this[_0x4a4677(0xa1)]?_0x4a4677(0x82):'fp32','encoder_model':'q4','decoder_model_merged':'q4'},'device':'webgpu','progress_callback':_0x529f30}),Promise['all']([this[_0x4a4677(0x8c)],this[_0x4a4677(0x95)],this[_0x4a4677(0x81)]]);}}function a0_0x1615(_0xc69772,_0x409103){const _0x560086=a0_0x5600();return a0_0x1615=function(_0x161585,_0x1378cd){_0x161585=_0x161585-0x80;let _0x2f9ad6=_0x560086[_0x161585];return _0x2f9ad6;},a0_0x1615(_0xc69772,_0x409103);}async function load(){const _0x137ddc=a0_0x3e6236;self[_0x137ddc(0xa2)]({'status':'loading','data':'Loading\x20model...'});const [_0x19554e,_0x376576,_0x490c99]=await Florence2Singleton[_0x137ddc(0x86)](_0x5d6b14=>{const _0x354812=_0x137ddc;self[_0x354812(0xa2)](_0x5d6b14);});self['postMessage']({'status':_0x137ddc(0xa8),'data':_0x137ddc(0x84)});const _0x31b943=_0x376576('a'),_0x4715d4=full([0x1,0x3,0x300,0x300],0x0);await _0x19554e[_0x137ddc(0x9f)]({..._0x31b943,'pixel_values':_0x4715d4,'max_new_tokens':0x1}),self['postMessage']({'status':_0x137ddc(0x8b)});}const TASKS_WITH_INPUTS=[a0_0x3e6236(0x88)];let vision_inputs,image_size;function a0_0x5600(){const _0x46459e=['183tcvVcK','onnx-community/Florence-2-base-ft','304359oyxQbo','requestAdapter','construct_prompts','shader-f16','generate','includes','supports_fp16','postMessage','107631OyoYLc','89530pgvwaX','1687153uXLtap','message','has','loading','run','processor','fp16','gpu','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','15088izQVpU','getInstance','load','<CAPTION_TO_PHRASE_GROUNDING>','1217082UCHCBL','data','ready','model','model_id','10bebcdi','1341MsURjP','3668BrfpBw','10nnSLTH','30004FYfuRE','168dRvjMQ','now','tokenizer','post_process_generation','complete','from_pretrained'];a0_0x5600=function(){return _0x46459e;};return a0_0x5600();}async function run({text:_0x2f008d,url:_0x52c8de,task:_0x27a4a1}){const _0x23d9d7=a0_0x3e6236,[_0x4d5ef6,_0x1d0f05,_0x3d222b]=await Florence2Singleton[_0x23d9d7(0x86)](),_0x24d335=performance[_0x23d9d7(0x94)]();if(!vision_inputs){const _0x2c4aac=await RawImage['fromURL'](_0x52c8de);image_size=_0x2c4aac['size'],vision_inputs=await _0x3d222b(_0x2c4aac);}let _0x58017b=_0x27a4a1;TASKS_WITH_INPUTS[_0x23d9d7(0xa0)](_0x27a4a1)&&_0x2f008d&&(_0x58017b+=_0x2f008d);const _0x310a75=_0x1d0f05(_0x3d222b[_0x23d9d7(0x9d)](_0x58017b)),_0x6fec91=await _0x4d5ef6['generate']({..._0x310a75,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x185107=_0x1d0f05['batch_decode'](_0x6fec91,{'skip_special_tokens':!0x1})[0x0],_0x4dd02c=_0x3d222b[_0x23d9d7(0x96)](_0x185107,_0x27a4a1,image_size),_0x26c1f1=performance[_0x23d9d7(0x94)]();self['postMessage']({'status':_0x23d9d7(0x97),'result':_0x4dd02c,'time':_0x26c1f1-_0x24d335});}self['addEventListener'](a0_0x3e6236(0xa6),async _0x34417c=>{const _0x303312=a0_0x3e6236,{type:_0x275b3f,data:_0x58b5f8}=_0x34417c[_0x303312(0x8a)];switch(_0x275b3f){case _0x303312(0x87):load();break;case _0x303312(0x80):run(_0x58b5f8);break;case'reset':vision_inputs=image_size=null;}});