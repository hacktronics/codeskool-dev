const a0_0x29aea7=a0_0x272b;(function(_0x302388,_0x6e71ab){const _0x4e5ab8=a0_0x272b,_0x17cbab=_0x302388();while(!![]){try{const _0x19b5c3=-parseInt(_0x4e5ab8(0xcb))/0x1*(-parseInt(_0x4e5ab8(0xbb))/0x2)+parseInt(_0x4e5ab8(0xbf))/0x3+parseInt(_0x4e5ab8(0xc8))/0x4*(parseInt(_0x4e5ab8(0xce))/0x5)+-parseInt(_0x4e5ab8(0xc2))/0x6+parseInt(_0x4e5ab8(0xd7))/0x7*(parseInt(_0x4e5ab8(0xd8))/0x8)+parseInt(_0x4e5ab8(0xca))/0x9+-parseInt(_0x4e5ab8(0xd0))/0xa;if(_0x19b5c3===_0x6e71ab)break;else _0x17cbab['push'](_0x17cbab['shift']());}catch(_0x4db208){_0x17cbab['push'](_0x17cbab['shift']());}}}(a0_0x4b46,0x9f066));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x4b46(){const _0x4c07cc=['processor','Compiling\x20shaders\x20and\x20warming\x20up\x20model...','construct_prompts','all','gpu','fp32','from_pretrained','ready','reset','model','2vPMslu','message','load','onnx-community/Florence-2-base-ft','688866ctiQaH','Loading\x20model...','tokenizer','1247310VPdmVc','requestAdapter','<CAPTION_TO_PHRASE_GROUNDING>','webgpu','batch_decode','fp16','4KIRnqV','getInstance','5156334fqSczu','451949qAdRKS','features','postMessage','6297385MTFGjO','generate','16785440GimuDB','complete','supports_fp16','shader-f16','run','addEventListener','fromURL','166747lyiYYo','8KdOGPt','now','model_id'];a0_0x4b46=function(){return _0x4c07cc;};return a0_0x4b46();}async function hasFp16(){const _0x362a91=a0_0x272b;try{return(await navigator[_0x362a91(0xb5)][_0x362a91(0xc3)]())[_0x362a91(0xcc)]['has'](_0x362a91(0xd3));}catch(_0x19906b){return!0x1;}}function a0_0x272b(_0x14875b,_0x2769a5){const _0x4b468d=a0_0x4b46();return a0_0x272b=function(_0x272bf8,_0x17dcf8){_0x272bf8=_0x272bf8-0xb2;let _0x48e695=_0x4b468d[_0x272bf8];return _0x48e695;},a0_0x272b(_0x14875b,_0x2769a5);}class Florence2Singleton{static [a0_0x29aea7(0xda)]=a0_0x29aea7(0xbe);static async['getInstance'](_0xd01e=null){const _0x4bf54d=a0_0x29aea7;return this[_0x4bf54d(0xdb)]??=AutoProcessor[_0x4bf54d(0xb7)](this['model_id']),this[_0x4bf54d(0xc1)]??=AutoTokenizer[_0x4bf54d(0xb7)](this['model_id']),this[_0x4bf54d(0xd2)]??=await hasFp16(),this[_0x4bf54d(0xba)]??=Florence2ForConditionalGeneration[_0x4bf54d(0xb7)](this['model_id'],{'dtype':{'embed_tokens':this[_0x4bf54d(0xd2)]?_0x4bf54d(0xc7):'fp32','vision_encoder':this[_0x4bf54d(0xd2)]?_0x4bf54d(0xc7):_0x4bf54d(0xb6),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x4bf54d(0xc5),'progress_callback':_0xd01e}),Promise[_0x4bf54d(0xb4)]([this[_0x4bf54d(0xba)],this[_0x4bf54d(0xc1)],this['processor']]);}}async function load(){const _0x14a347=a0_0x29aea7;self[_0x14a347(0xcd)]({'status':'loading','data':_0x14a347(0xc0)});const [_0x1a62bd,_0x4d3e35,_0x5010a1]=await Florence2Singleton[_0x14a347(0xc9)](_0xda9697=>{self['postMessage'](_0xda9697);});self[_0x14a347(0xcd)]({'status':'loading','data':_0x14a347(0xb2)});const _0x4c8642=_0x4d3e35('a'),_0x59dd0b=full([0x1,0x3,0x300,0x300],0x0);await _0x1a62bd['generate']({..._0x4c8642,'pixel_values':_0x59dd0b,'max_new_tokens':0x1}),self[_0x14a347(0xcd)]({'status':_0x14a347(0xb8)});}const TASKS_WITH_INPUTS=[a0_0x29aea7(0xc4)];let vision_inputs,image_size;async function run({text:_0x2a91b0,url:_0x479a11,task:_0x22c76f}){const _0x5a5b2a=a0_0x29aea7,[_0x30f347,_0x34d3ca,_0x50b5df]=await Florence2Singleton['getInstance'](),_0x2d5ec1=performance[_0x5a5b2a(0xd9)]();if(!vision_inputs){const _0x3cf57a=await RawImage[_0x5a5b2a(0xd6)](_0x479a11);image_size=_0x3cf57a['size'],vision_inputs=await _0x50b5df(_0x3cf57a);}let _0x6870fa=_0x22c76f;TASKS_WITH_INPUTS['includes'](_0x22c76f)&&_0x2a91b0&&(_0x6870fa+=_0x2a91b0);const _0x25bf0f=_0x34d3ca(_0x50b5df[_0x5a5b2a(0xb3)](_0x6870fa)),_0x52f68f=await _0x30f347[_0x5a5b2a(0xcf)]({..._0x25bf0f,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0x1926a3=_0x34d3ca[_0x5a5b2a(0xc6)](_0x52f68f,{'skip_special_tokens':!0x1})[0x0],_0x5abdcb=_0x50b5df['post_process_generation'](_0x1926a3,_0x22c76f,image_size),_0x4dac46=performance['now']();self[_0x5a5b2a(0xcd)]({'status':_0x5a5b2a(0xd1),'result':_0x5abdcb,'time':_0x4dac46-_0x2d5ec1});}self[a0_0x29aea7(0xd5)](a0_0x29aea7(0xbc),async _0x30b62d=>{const _0x37c5a7=a0_0x29aea7,{type:_0x3e0176,data:_0x36709b}=_0x30b62d['data'];switch(_0x3e0176){case _0x37c5a7(0xbd):load();break;case _0x37c5a7(0xd4):run(_0x36709b);break;case _0x37c5a7(0xb9):vision_inputs=image_size=null;}});