const a0_0x2da410=a0_0x4123;(function(_0x38d83e,_0x552e77){const _0x4e0022=a0_0x4123,_0x3415a9=_0x38d83e();while(!![]){try{const _0x1d54bb=-parseInt(_0x4e0022(0x1e9))/0x1+parseInt(_0x4e0022(0x1e8))/0x2+-parseInt(_0x4e0022(0x1e5))/0x3+parseInt(_0x4e0022(0x1e3))/0x4+parseInt(_0x4e0022(0x1f6))/0x5*(parseInt(_0x4e0022(0x1fc))/0x6)+parseInt(_0x4e0022(0x1de))/0x7+-parseInt(_0x4e0022(0x1f4))/0x8;if(_0x1d54bb===_0x552e77)break;else _0x3415a9['push'](_0x3415a9['shift']());}catch(_0x884118){_0x3415a9['push'](_0x3415a9['shift']());}}}(a0_0x5611,0x5b205));import{Florence2ForConditionalGeneration,AutoProcessor,AutoTokenizer,RawImage,full}from'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.0/dist/transformers.min.js';function a0_0x5611(){const _0x1422c9=['tokenizer','Loading\x20model...','loading','5573552krKNWx','generate','104015JIUPxB','supports_fp16','run','requestAdapter','processor','now','204hdlLWt','webgpu','post_process_generation','fp16','size','getInstance','2232097gjGVNc','model','from_pretrained','addEventListener','shader-f16','2136600YlDhYu','complete','148137lGDFqf','all','fp32','335676VRaPvv','608835GuHcwP','fromURL','postMessage','data','<CAPTION_TO_PHRASE_GROUNDING>','construct_prompts','model_id','includes'];a0_0x5611=function(){return _0x1422c9;};return a0_0x5611();}async function hasFp16(){const _0xce324e=a0_0x4123;try{return(await navigator['gpu'][_0xce324e(0x1f9)]())['features']['has'](_0xce324e(0x1e2));}catch(_0x5a5391){return!0x1;}}class Florence2Singleton{static ['model_id']='onnx-community/Florence-2-base-ft';static async[a0_0x2da410(0x1dd)](_0x4be14d=null){const _0x1becb1=a0_0x2da410;return this[_0x1becb1(0x1fa)]??=AutoProcessor[_0x1becb1(0x1e0)](this['model_id']),this['tokenizer']??=AutoTokenizer['from_pretrained'](this[_0x1becb1(0x1ef)]),this[_0x1becb1(0x1f7)]??=await hasFp16(),this['model']??=Florence2ForConditionalGeneration['from_pretrained'](this['model_id'],{'dtype':{'embed_tokens':this[_0x1becb1(0x1f7)]?_0x1becb1(0x1db):_0x1becb1(0x1e7),'vision_encoder':this[_0x1becb1(0x1f7)]?_0x1becb1(0x1db):_0x1becb1(0x1e7),'encoder_model':'q4','decoder_model_merged':'q4'},'device':_0x1becb1(0x1fd),'progress_callback':_0x4be14d}),Promise[_0x1becb1(0x1e6)]([this[_0x1becb1(0x1df)],this[_0x1becb1(0x1f1)],this[_0x1becb1(0x1fa)]]);}}function a0_0x4123(_0x130ba5,_0x22ebe3){const _0x5611a0=a0_0x5611();return a0_0x4123=function(_0x4123ac,_0x473e9d){_0x4123ac=_0x4123ac-0x1da;let _0x5f73c4=_0x5611a0[_0x4123ac];return _0x5f73c4;},a0_0x4123(_0x130ba5,_0x22ebe3);}async function load(){const _0x30c189=a0_0x2da410;self[_0x30c189(0x1eb)]({'status':_0x30c189(0x1f3),'data':_0x30c189(0x1f2)});const [_0xcd8408,_0x1278cd,_0x2f3143]=await Florence2Singleton[_0x30c189(0x1dd)](_0x127f99=>{const _0x2eecc0=_0x30c189;self[_0x2eecc0(0x1eb)](_0x127f99);});self[_0x30c189(0x1eb)]({'status':_0x30c189(0x1f3),'data':'Compiling\x20shaders\x20and\x20warming\x20up\x20model...'});const _0xa82a64=_0x1278cd('a'),_0xe2a270=full([0x1,0x3,0x300,0x300],0x0);await _0xcd8408[_0x30c189(0x1f5)]({..._0xa82a64,'pixel_values':_0xe2a270,'max_new_tokens':0x1}),self[_0x30c189(0x1eb)]({'status':'ready'});}const TASKS_WITH_INPUTS=[a0_0x2da410(0x1ed)];let vision_inputs,image_size;async function run({text:_0x276a07,url:_0x51f102,task:_0x16f6a4}){const _0x563763=a0_0x2da410,[_0x3351f8,_0x59f2ca,_0x1222aa]=await Florence2Singleton[_0x563763(0x1dd)](),_0x4a45e9=performance[_0x563763(0x1fb)]();if(!vision_inputs){const _0x38cddc=await RawImage[_0x563763(0x1ea)](_0x51f102);image_size=_0x38cddc[_0x563763(0x1dc)],vision_inputs=await _0x1222aa(_0x38cddc);}let _0x58c63f=_0x16f6a4;TASKS_WITH_INPUTS[_0x563763(0x1f0)](_0x16f6a4)&&_0x276a07&&(_0x58c63f+=_0x276a07);const _0x16496a=_0x59f2ca(_0x1222aa[_0x563763(0x1ee)](_0x58c63f)),_0xcb0989=await _0x3351f8[_0x563763(0x1f5)]({..._0x16496a,...vision_inputs,'max_new_tokens':0x80,'num_beams':0x1,'do_sample':!0x1}),_0xc8c89=_0x59f2ca['batch_decode'](_0xcb0989,{'skip_special_tokens':!0x1})[0x0],_0x1cf30f=_0x1222aa[_0x563763(0x1da)](_0xc8c89,_0x16f6a4,image_size),_0x2ec744=performance[_0x563763(0x1fb)]();self[_0x563763(0x1eb)]({'status':_0x563763(0x1e4),'result':_0x1cf30f,'time':_0x2ec744-_0x4a45e9});}self[a0_0x2da410(0x1e1)]('message',async _0xb42521=>{const _0x255f02=a0_0x2da410,{type:_0x45032f,data:_0x1545c7}=_0xb42521[_0x255f02(0x1ec)];switch(_0x45032f){case'load':load();break;case _0x255f02(0x1f8):run(_0x1545c7);break;case'reset':vision_inputs=image_size=null;}});